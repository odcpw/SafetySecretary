{"id":"SafetySecretary-001","title":"Solution Design","description":"","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.668513483+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-01e","title":"Files to Modify","description":"- `src/services/tenantProvisioner.ts`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.663017946+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-02k","title":"Files to Modify","description":"- `frontend/src/components/RaEditor.tsx`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.701442899+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-03b","title":"Files to Modify","description":"- `frontend/src/components/IncidentEditor.tsx` (simplify to orchestrator)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.698110256+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-07n","title":"Testing","description":"1. Test that exceeding limit returns 429","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.674131288+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-0l9","title":"Backend demo login route + session creation","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T07:54:28.762395294+01:00","updated_at":"2025-12-21T08:16:32.639109738+01:00","closed_at":"2025-12-21T08:16:32.639111573+01:00","dependencies":[{"issue_id":"SafetySecretary-0l9","depends_on_id":"SafetySecretary-q46","type":"blocks","created_at":"2025-12-21T07:54:48.529397667+01:00","created_by":"oliver"}],"comments":[{"id":26,"issue_id":"SafetySecretary-0l9","author":"oliver","text":"Goal: implement a server-side demo login endpoint that mints a normal org session for the demo org/user without asking for credentials. This unlocks direct-page testing while keeping all writes inside the demo DB.\\n\\nKey behaviors: (1) endpoint only enabled if demo env vars are present; (2) creates or fetches demo org + demo user in the registry; (3) sets standard session cookie with TTL, remember-me optional; (4) returns user payload consistent with /api/auth/me; (5) logs a clear warning banner when demo login is used.\\n\\nReasoning: keeps auth flow consistent (cookie + sessionAuth), avoids client-stored secrets, and ensures all existing auth checks still apply.\\n\\nConsiderations: avoid creating admin/owner outside intended role (OWNER only), make idempotent across restarts, and ensure database connection string is always the demo DB from env.","created_at":"2025-12-21T06:54:39Z"},{"id":42,"issue_id":"SafetySecretary-0l9","author":"oliver","text":"Revision: define explicit endpoint name (e.g., POST /api/auth/demo-login) and ensure it returns the same payload as /api/auth/me after session is set. Include an audit log entry tagged DEMO_LOGIN so we can trace usage during testing.","created_at":"2025-12-21T07:05:27Z"}]}
{"id":"SafetySecretary-0y0","title":"Incident Investigation workflow (II)","description":"Epic: build a standalone incident investigation flow with separate data model, LLM-guided witness intake + timeline merge, deviation/cause/action tracking, consistency check, attachments, and one-page export. No gating; focus on clarity + auditability.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:14:53.633988472+01:00","updated_at":"2025-12-21T00:29:10.108435204+01:00","closed_at":"2025-12-21T00:29:10.108436951+01:00","comments":[{"id":11,"issue_id":"SafetySecretary-0y0","author":"oliver","text":"Background/intent: add a dedicated Incident Investigation (II) workflow alongside HIRA/JHA. Requirements: separate tables + attachments, API namespace /api/incident-cases, multi-witness accounts with merged timeline, LLM assists (extract facts + timelines, merge, consistency check), and one-page PDF. No gating between phases; users can edit freely. Keep UI simpler than HIRA, but ensure traceability from witness → timeline → deviations → causes → actions. Avoid hallucinations; LLM can structure + ask questions only.","created_at":"2025-12-20T22:15:04Z"}]}
{"id":"SafetySecretary-0y0.1","title":"II Prisma schema + migration","description":"Add IncidentCase/Person/Account/Fact/PersonalEvent/TimelineEvent/TimelineSource/Deviation/Cause/Action/IncidentAttachment models to prisma schema. Create SQL migration with indexes and cascades. Separate from HIRA/JHA tables.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:15:14.38080141+01:00","updated_at":"2025-12-20T23:26:45.133250147+01:00","closed_at":"2025-12-20T23:26:45.133255359+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.1","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:15:14.383821832+01:00","created_by":"oliver"}],"comments":[{"id":12,"issue_id":"SafetySecretary-0y0.1","author":"oliver","text":"Schema considerations: keep fields minimal but enough to show provenance. TimelineSource should link timeline rows back to account facts/events (so UI can show source chips). IncidentAttachment should reference case + optional timelineEventId. Use orderIndex for stable ordering. Use enums for incident type and confidence (Confirmed/Likely/Unclear).","created_at":"2025-12-20T22:15:24Z"}]}
{"id":"SafetySecretary-0y0.10","title":"Incident frontend types + context","description":"Add frontend incident types + IncidentContext similar to RaContext with actions to create/load cases, add witness accounts, run LLM extraction, save timeline/deviations/causes/actions, and manage attachments.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:17:04.913718267+01:00","updated_at":"2025-12-20T23:41:27.848041718+01:00","closed_at":"2025-12-20T23:41:27.848043571+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.10","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:17:04.914404345+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.10","depends_on_id":"SafetySecretary-0y0.6","type":"blocks","created_at":"2025-12-20T23:20:05.761994548+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.10","depends_on_id":"SafetySecretary-0y0.5","type":"blocks","created_at":"2025-12-20T23:20:15.905000819+01:00","created_by":"oliver"}],"comments":[{"id":19,"issue_id":"SafetySecretary-0y0.10","author":"oliver","text":"Context should mirror RaContext patterns to reduce frontend churn. Include actions for: create/load case, add person/account, run LLM extraction jobs, save timeline rows, save deviations/causes/actions, run consistency check, manage attachments, and export.","created_at":"2025-12-20T22:22:43Z"}]}
{"id":"SafetySecretary-0y0.11","title":"Incident landing (create/load/list)","description":"Build incident landing page with case metadata fields (title, date/time, location, type, coordinator role/name) and list of recent incidents. Simple copy and clear CTA.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:17:14.543538584+01:00","updated_at":"2025-12-20T23:42:56.705428061+01:00","closed_at":"2025-12-20T23:42:56.705429896+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.11","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:17:14.54427746+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.11","depends_on_id":"SafetySecretary-0y0.10","type":"blocks","created_at":"2025-12-20T23:20:23.744126775+01:00","created_by":"oliver"}],"comments":[{"id":20,"issue_id":"SafetySecretary-0y0.11","author":"oliver","text":"Landing should mirror HIRA/JHA patterns: create new incident + load existing ID + recent list. Keep fields minimal to reduce friction (title, date/time, location, type, coordinator role/name).","created_at":"2025-12-20T22:22:52Z"}]}
{"id":"SafetySecretary-0y0.12","title":"Incident editor (witnesses → timeline → deviations/causes/actions)","description":"Implement incident editor view with: witness intake panel (accounts), personal timeline view, merged timeline table with confidence tags + source chips, deviations + causes + actions tables, and the consistency-check UI for 'therefore/therefor' gaps.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:17:24.797297468+01:00","updated_at":"2025-12-20T23:46:36.469845621+01:00","closed_at":"2025-12-20T23:46:36.469847328+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.12","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:17:24.798023972+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.12","depends_on_id":"SafetySecretary-0y0.10","type":"blocks","created_at":"2025-12-20T23:20:31.549212105+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.12","depends_on_id":"SafetySecretary-0y0.5","type":"blocks","created_at":"2025-12-20T23:20:41.485199257+01:00","created_by":"oliver"}],"comments":[{"id":15,"issue_id":"SafetySecretary-0y0.12","author":"oliver","text":"UI intent: allow parallel witness intake, show merged timeline with editability and confidence tags, then deviations/causes/actions without gating. Provide 'run consistency check' action that flags contradictions or missing links. Keep table layouts compact and editable (Step/Hazard-style tables).","created_at":"2025-12-20T22:17:33Z"}]}
{"id":"SafetySecretary-0y0.13","title":"Incident attachments UI","description":"Add attachments panel for incident timeline events (photos/sketches). Use drag/drop reorder and attach to specific timeline rows.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:17:41.180527327+01:00","updated_at":"2025-12-20T23:48:10.207201021+01:00","closed_at":"2025-12-20T23:48:10.207203105+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.13","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:17:41.181240242+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.13","depends_on_id":"SafetySecretary-0y0.7","type":"blocks","created_at":"2025-12-20T23:20:50.234314297+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.13","depends_on_id":"SafetySecretary-0y0.12","type":"blocks","created_at":"2025-12-20T23:20:57.954921282+01:00","created_by":"oliver"}],"comments":[{"id":21,"issue_id":"SafetySecretary-0y0.13","author":"oliver","text":"UI should reuse attachment UX but bind to incident timeline events. If no timeline row selected, allow attaching to case-level (or prompt to select).","created_at":"2025-12-20T22:23:02Z"}]}
{"id":"SafetySecretary-0y0.14","title":"Incident export buttons wiring","description":"Add PDF export buttons in incident editor header, pointing to /api/incident-cases/:id/export/pdf (open in new tab).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:17:51.297114457+01:00","updated_at":"2025-12-20T23:48:19.23562052+01:00","closed_at":"2025-12-20T23:48:19.235622145+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.14","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:17:51.297873462+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.14","depends_on_id":"SafetySecretary-0y0.8","type":"blocks","created_at":"2025-12-20T23:21:07.599784412+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.14","depends_on_id":"SafetySecretary-0y0.12","type":"blocks","created_at":"2025-12-20T23:21:16.506572515+01:00","created_by":"oliver"}],"comments":[{"id":22,"issue_id":"SafetySecretary-0y0.14","author":"oliver","text":"Export buttons should be visible in the incident editor header to mirror HIRA/JHA ergonomics and minimize user confusion.","created_at":"2025-12-20T22:23:10Z"}]}
{"id":"SafetySecretary-0y0.15","title":"Incident backend tests","description":"Add Vitest coverage for incident routes (create/list/get/update, LLM job enqueue, attachments, export PDF) to prevent regressions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T23:18:00.797141144+01:00","updated_at":"2025-12-20T23:49:20.266411913+01:00","closed_at":"2025-12-20T23:49:20.266413781+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.15","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:18:00.79792207+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.15","depends_on_id":"SafetySecretary-0y0.6","type":"blocks","created_at":"2025-12-20T23:21:24.948995633+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.15","depends_on_id":"SafetySecretary-0y0.8","type":"blocks","created_at":"2025-12-20T23:21:33.405767738+01:00","created_by":"oliver"}],"comments":[{"id":23,"issue_id":"SafetySecretary-0y0.15","author":"oliver","text":"Tests focus on critical path: create case, add witness, run extraction job, save timeline, export PDF, upload attachment. Avoid overfitting to UI copy.","created_at":"2025-12-20T22:23:20Z"}]}
{"id":"SafetySecretary-0y0.16","title":"Incident frontend tests","description":"Add minimal frontend tests for incident landing + editor (smoke render, row add, LLM action wiring, consistency check action).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T23:18:10.998643232+01:00","updated_at":"2025-12-20T23:50:08.395320799+01:00","closed_at":"2025-12-20T23:50:08.395322959+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.16","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:18:10.999705977+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.16","depends_on_id":"SafetySecretary-0y0.12","type":"blocks","created_at":"2025-12-20T23:21:42.227269133+01:00","created_by":"oliver"}],"comments":[{"id":24,"issue_id":"SafetySecretary-0y0.16","author":"oliver","text":"Frontend tests should be small: smoke render + add account + save timeline row + trigger consistency check action. Align with existing Vitest + Testing Library patterns.","created_at":"2025-12-20T22:23:28Z"}]}
{"id":"SafetySecretary-0y0.17","title":"Docs/README updates for Incident","description":"Update README/quickstart with incident workflow, routes, LLM prompts, and export info.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T23:18:20.137462768+01:00","updated_at":"2025-12-20T23:50:29.896568214+01:00","closed_at":"2025-12-20T23:50:29.896569852+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.17","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:18:20.138185858+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.17","depends_on_id":"SafetySecretary-0y0.6","type":"blocks","created_at":"2025-12-20T23:21:50.103689306+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-0y0.2","title":"II backend types + DTOs","description":"Define backend types for incident inputs, summaries, and DTO shapes. Ensure date parsing rules (approx ok) and enums are explicit.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:15:32.609227+01:00","updated_at":"2025-12-20T23:27:24.725149705+01:00","closed_at":"2025-12-20T23:27:24.725151413+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.2","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:15:32.609950033+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-0y0.3","title":"IncidentService CRUD + ordering","description":"Implement IncidentService with CRUD for case/person/account/fact/personalEvent/timelineEvent/deviation/cause/action. Include helpers to normalize orderIndex after edits and to validate relationships (case ownership).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:15:41.199888696+01:00","updated_at":"2025-12-20T23:30:00.061739671+01:00","closed_at":"2025-12-20T23:30:00.061741344+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.3","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:15:41.201433937+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.3","depends_on_id":"SafetySecretary-0y0.1","type":"blocks","created_at":"2025-12-20T23:18:29.171860909+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.3","depends_on_id":"SafetySecretary-0y0.2","type":"blocks","created_at":"2025-12-20T23:18:37.971258452+01:00","created_by":"oliver"}],"comments":[{"id":13,"issue_id":"SafetySecretary-0y0.3","author":"oliver","text":"Service should expose methods to upsert witness accounts (raw text + parsed facts/events), save merged timeline rows with confidence, and maintain link tables for sources. Keep logic deterministic so UI can re-save without duplication.","created_at":"2025-12-20T22:15:51Z"}]}
{"id":"SafetySecretary-0y0.4","title":"II LLM prompts + extraction","description":"Add LLMService helpers for witness extraction (facts + personal timeline + questions), timeline merge, and consistency check (therefore/therefor). Provide strict non-hallucination prompts and deterministic fallback.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:15:59.595123543+01:00","updated_at":"2025-12-20T23:31:46.048265027+01:00","closed_at":"2025-12-20T23:31:46.048266693+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.4","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:15:59.595827284+01:00","created_by":"oliver"}],"comments":[{"id":14,"issue_id":"SafetySecretary-0y0.4","author":"oliver","text":"Prompt goals: extract only facts; avoid causes in facts/timeline phases; allow questions instead of assumptions. Consistency check should work backward ('therefore/therefor') to highlight missing steps or contradictions, never invent facts.","created_at":"2025-12-20T22:16:09Z"}]}
{"id":"SafetySecretary-0y0.5","title":"II LLM job pipeline","description":"Extend LlmJobManager to enqueue incident jobs (witness extract, merge timeline, consistency check). Jobs should call IncidentService to persist outputs and return job status for polling.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:16:17.626508923+01:00","updated_at":"2025-12-20T23:33:46.617131691+01:00","closed_at":"2025-12-20T23:33:46.617133479+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.5","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:16:17.627212373+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.5","depends_on_id":"SafetySecretary-0y0.4","type":"blocks","created_at":"2025-12-20T23:18:47.129204007+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.5","depends_on_id":"SafetySecretary-0y0.3","type":"blocks","created_at":"2025-12-20T23:18:56.148995243+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-0y0.6","title":"Incident API router","description":"Implement /api/incident-cases routes: create/list/get/update, add person/account, run LLM extraction (enqueue), save merged timeline + sources, deviations/causes/actions CRUD, and export endpoints. Mirror validation style of existing RA router.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:16:26.506056204+01:00","updated_at":"2025-12-20T23:35:46.665400385+01:00","closed_at":"2025-12-20T23:35:46.665402403+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.6","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:16:26.509107918+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.6","depends_on_id":"SafetySecretary-0y0.3","type":"blocks","created_at":"2025-12-20T23:19:05.351157231+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.6","depends_on_id":"SafetySecretary-0y0.5","type":"blocks","created_at":"2025-12-20T23:19:14.756925437+01:00","created_by":"oliver"}],"comments":[{"id":16,"issue_id":"SafetySecretary-0y0.6","author":"oliver","text":"API should expose simple CRUD and keep payloads flat to make frontend wiring easy. Provide endpoints for witness intake (account text + parse), merged timeline save, deviation/cause/action CRUD, and consistency-check trigger (LLM job enqueue). Mirror RA router validation style.","created_at":"2025-12-20T22:22:15Z"}]}
{"id":"SafetySecretary-0y0.7","title":"Incident attachments router + storage","description":"Add /api/incident-cases/:id/attachments router with list/upload/move/reorder/delete/download. Use separate IncidentAttachment table and storage key namespace per incident case.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:16:35.738029786+01:00","updated_at":"2025-12-20T23:36:48.975936174+01:00","closed_at":"2025-12-20T23:36:48.975938006+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.7","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:16:35.738789368+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.7","depends_on_id":"SafetySecretary-0y0.3","type":"blocks","created_at":"2025-12-20T23:19:23.852105105+01:00","created_by":"oliver"}],"comments":[{"id":17,"issue_id":"SafetySecretary-0y0.7","author":"oliver","text":"Attachments are incident-specific (separate table + storage key namespace). Attachments should be linkable to timeline events and reorderable within each event.","created_at":"2025-12-20T22:22:23Z"}]}
{"id":"SafetySecretary-0y0.8","title":"Incident PDF export (one-pager)","description":"Extend ReportService with incident one-page PDF summary (metadata, timeline table, deviations/causes/actions). Keep layout concise and readable for sharing.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:16:44.230570047+01:00","updated_at":"2025-12-20T23:37:36.679994363+01:00","closed_at":"2025-12-20T23:37:36.6799962+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.8","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:16:44.231288561+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.8","depends_on_id":"SafetySecretary-0y0.3","type":"blocks","created_at":"2025-12-20T23:19:31.590243403+01:00","created_by":"oliver"}],"comments":[{"id":18,"issue_id":"SafetySecretary-0y0.8","author":"oliver","text":"PDF should be one-page, readable on-site: incident metadata, merged timeline table with confidence tags, deviations/causes/actions summary, and coordinator sign-off info. Avoid overflow by truncating long rows or splitting into columns.","created_at":"2025-12-20T22:22:33Z"}]}
{"id":"SafetySecretary-0y0.9","title":"App wiring for incident services/routes","description":"Register IncidentService in app.locals and mount /api/incident-cases + /api/incident-cases/:id/attachments. Ensure server startup connects to DB using IncidentService if needed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:16:54.100914941+01:00","updated_at":"2025-12-20T23:39:18.044283335+01:00","closed_at":"2025-12-20T23:39:18.044285093+01:00","dependencies":[{"issue_id":"SafetySecretary-0y0.9","depends_on_id":"SafetySecretary-0y0","type":"parent-child","created_at":"2025-12-20T23:16:54.101703613+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.9","depends_on_id":"SafetySecretary-0y0.6","type":"blocks","created_at":"2025-12-20T23:19:40.160825964+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.9","depends_on_id":"SafetySecretary-0y0.7","type":"blocks","created_at":"2025-12-20T23:19:49.152224399+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-0y0.9","depends_on_id":"SafetySecretary-0y0.8","type":"blocks","created_at":"2025-12-20T23:19:56.881778912+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-17h","title":"Solution Design","description":"Batch operations:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.695740425+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-1ie","title":"Testing","description":"1. Unit tests for each validation function","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.683858015+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-1o7","title":"JHA assistant suggestions review + responsibility copy","description":"Add a lightweight review/apply step for assistant outputs (steps/hazards/controls) so users explicitly accept or reject each change. Include concise copy that the assistant is an aid and the user remains responsible for the final JHA.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:25:09.838425186+01:00","updated_at":"2025-12-21T22:25:09.838425186+01:00"}
{"id":"SafetySecretary-20c","title":"Why Type Safety Matters","description":"1. **Catch Bugs Early**: TypeScript can find issues before they reach production","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.681460051+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-20z","title":"Finalize beads team workflow","description":"Decide whether to commit .beads config, set sync.branch, and run bd doctor --fix so all work stays in beads.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:05:17.906084634+01:00","updated_at":"2025-12-18T21:19:43.164911344+01:00","closed_at":"2025-12-18T21:19:43.164912826+01:00"}
{"id":"SafetySecretary-27m","title":"Incident assistant API endpoints + job wiring","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T07:56:33.421770875+01:00","updated_at":"2025-12-21T08:22:53.123844825+01:00","closed_at":"2025-12-21T08:22:53.123846624+01:00","dependencies":[{"issue_id":"SafetySecretary-27m","depends_on_id":"SafetySecretary-nh3","type":"blocks","created_at":"2025-12-21T07:56:51.566109098+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-27m","depends_on_id":"SafetySecretary-3gx","type":"blocks","created_at":"2025-12-21T07:56:59.061634228+01:00","created_by":"oliver"}],"comments":[{"id":31,"issue_id":"SafetySecretary-27m","author":"oliver","text":"Goal: expose backend endpoints that run the narrative extraction job and persist outputs + clarification questions, without auto-applying changes to the canonical timeline until the user confirms.\\n\\nDeliverables: new routes on /api/incident-cases/:id for narrative extract and clarification updates; integrate with LlmJobManager for async jobs; store results in the new data model fields; return structured payloads for the UI.\\n\\nConsiderations: keep a clear ‘draft vs applied’ distinction to avoid overwriting user edits; include basic validation (non-empty narrative); handle LLM failures by returning fallback results.","created_at":"2025-12-21T06:56:43Z"},{"id":47,"issue_id":"SafetySecretary-27m","author":"oliver","text":"Revision: add an explicit ‘apply draft’ endpoint that writes the reviewed assistant output into the canonical timeline/facts only after user confirmation. Keep the extract endpoint read-only on canonical data.","created_at":"2025-12-21T07:06:33Z"}]}
{"id":"SafetySecretary-2f7","title":"Files to Modify","description":"- `frontend/src/contexts/RaContext.tsx`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.680496499+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-2mm","title":"Files to Modify","description":"- `src/services/llmJobManager.ts`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.67793155+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-2pp","title":"JHA LLM step amendments (append vs replace)","description":"Steps assistant must apply incremental patches, not full replacement. Support insertions between existing steps (e.g., add 'move ladder' before Step 3) while preserving step IDs, order, and user edits. Define allowed operations (add/insert/update/move/delete) and require explicit user intent before removing or rewriting steps.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T22:18:21.97643404+01:00","updated_at":"2025-12-21T22:23:17.707596092+01:00"}
{"id":"SafetySecretary-2py","title":"Solution Design","description":"Extract into:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.697162292+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-2q6","title":"Attack Vector Analysis","description":"The `safeName` escaping only handles double quotes. An attacker who can control the `slug` input to `provisionOrg()` could potentially:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.661422923+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-2tn","title":"Indexes to Add","description":"```prisma","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.69420795+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-3gx","title":"Incident assistant LLM extraction + fallbacks","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T07:56:06.240071799+01:00","updated_at":"2025-12-21T08:18:26.716341358+01:00","closed_at":"2025-12-21T08:18:26.716344065+01:00","dependencies":[{"issue_id":"SafetySecretary-3gx","depends_on_id":"SafetySecretary-nh3","type":"blocks","created_at":"2025-12-21T07:56:25.389680332+01:00","created_by":"oliver"}],"comments":[{"id":30,"issue_id":"SafetySecretary-3gx","author":"oliver","text":"Goal: add an LLM flow that takes a free-form incident narrative and returns (1) extracted facts, (2) a draft timeline, and (3) clarification questions when data is missing/ambiguous.\\n\\nReasoning: this enables the ‘layperson to professional’ flow where users narrate in natural language, and the system structures the investigation while prompting for gaps.\\n\\nDeliverables: extend llmService with a dedicated incident-narrative prompt and typed return shape. Implement deterministic fallbacks (heuristics) when LLM fails or key is missing. Ensure the result is structured enough to map to existing timeline/fact models (timeLabel, text, confidence) and questions (question, rationale, targetField).","created_at":"2025-12-21T06:56:16Z"}]}
{"id":"SafetySecretary-3ih","title":"Solution Design","description":"Move state update AFTER successful API response:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.679545985+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-3nw","title":"Files to Modify","description":"- `src/services/raService.ts`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.696213644+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-3zf","title":"Photo/attachment support per step","description":"Allow uploading pictures, associating them to steps/hazards, ordering, and showing in reports.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-12T00:03:45.094086047+01:00","updated_at":"2025-12-18T22:06:28.280385078+01:00","closed_at":"2025-12-18T22:06:28.280386683+01:00"}
{"id":"SafetySecretary-3zf.1","title":"Add Attachment model + migration","description":"Prisma model for images/attachments linked to case+optional step/hazard, with ordering.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:04:59.371626075+01:00","updated_at":"2025-12-18T20:39:16.348601112+01:00","closed_at":"2025-12-18T20:39:16.34860277+01:00","dependencies":[{"issue_id":"SafetySecretary-3zf.1","depends_on_id":"SafetySecretary-3zf","type":"parent-child","created_at":"2025-12-12T00:04:59.372259457+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-3zf.2","title":"Upload/download attachment API (local disk MVP)","description":"Implement POST /attachments with multer, serve /uploads, and endpoints to assign to steps/hazards.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:05:03.467479271+01:00","updated_at":"2025-12-18T21:07:58.552407834+01:00","closed_at":"2025-12-18T21:07:58.552409551+01:00","dependencies":[{"issue_id":"SafetySecretary-3zf.2","depends_on_id":"SafetySecretary-3zf","type":"parent-child","created_at":"2025-12-12T00:05:03.468294269+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-3zf.2","depends_on_id":"SafetySecretary-8u2.6","type":"blocks","created_at":"2025-12-18T19:17:51.798210106+01:00","created_by":"import"}]}
{"id":"SafetySecretary-3zf.3","title":"Frontend photos panel + drag assignment","description":"Per-step photo strip, upload button, drag/drop to steps, caption/order.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T00:05:07.252825288+01:00","updated_at":"2025-12-18T22:05:59.848129402+01:00","closed_at":"2025-12-18T22:05:59.848130952+01:00","dependencies":[{"issue_id":"SafetySecretary-3zf.3","depends_on_id":"SafetySecretary-3zf","type":"parent-child","created_at":"2025-12-12T00:05:07.253551149+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-41v","title":"Frontend tiles landing + routing updates","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:51:22.455270774+01:00","updated_at":"2025-12-21T00:28:40.605181115+01:00","closed_at":"2025-12-21T00:28:40.605183474+01:00","comments":[{"id":3,"issue_id":"SafetySecretary-41v","author":"oliver","text":"Replace root landing with tile-based navigation (HIRA/JHA/II), keep HIRA landing at a new route, update routes and navigation targets.","created_at":"2025-12-20T21:51:30Z"},{"id":7,"issue_id":"SafetySecretary-41v","author":"oliver","text":"Epic: Replace root landing with tile-based navigation for HIRA/JHA/II. Goal: give users a clear entry point to multiple safety workflows, keep HIRA landing reachable, and leave space for future II tile.","created_at":"2025-12-20T21:59:19Z"}]}
{"id":"SafetySecretary-41v.1","title":"Root landing tiles (HIRA/JHA/II)","description":"Replace / landing with tile-based entry (HIRA, JHA, II placeholder). Ensure clear copy, minimal fields, and mobile-friendly layout.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:01:18.000324164+01:00","updated_at":"2025-12-21T00:27:11.327849688+01:00","closed_at":"2025-12-21T00:27:11.327852359+01:00","dependencies":[{"issue_id":"SafetySecretary-41v.1","depends_on_id":"SafetySecretary-41v","type":"parent-child","created_at":"2025-12-20T23:01:18.001096087+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-41v.1","depends_on_id":"SafetySecretary-41v.2","type":"blocks","created_at":"2025-12-20T23:06:27.101366422+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-41v.1","depends_on_id":"SafetySecretary-7ka.2","type":"blocks","created_at":"2025-12-20T23:07:08.105143927+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-41v.1","depends_on_id":"SafetySecretary-0y0.11","type":"blocks","created_at":"2025-12-20T23:23:40.27365497+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-41v.2","title":"Move HIRA landing to /hira + update nav","description":"Keep existing HIRA create/load UI but move it off / to /hira (or /hira/start). Update navigation buttons (RaEditor New/Load) to point to the new HIRA landing.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:01:26.722380561+01:00","updated_at":"2025-12-21T00:27:20.835927316+01:00","closed_at":"2025-12-21T00:27:20.835929346+01:00","dependencies":[{"issue_id":"SafetySecretary-41v.2","depends_on_id":"SafetySecretary-41v","type":"parent-child","created_at":"2025-12-20T23:01:26.723092541+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-4if","title":"Configuration Considerations","description":"These values should potentially be configurable via environment:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.665982076+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-4uq","title":"Project memory: HIRA table-first vision + key decisions","description":"Use this issue as the living 'memory'/context log for the project so future sessions don't lose the north star. Update this bead when we make a structural decision.\\n\\nCurrent context (confirmed):\\n- The Excel HIRA template is the conceptual model: its column headers/structure drive the DB schema and UI views (not necessarily exporting back into the .xlsm).\\n- The product is a workflow to help users fill the HIRA table; the LLM assists with language processing (first typed, later voice/TTS), not a gatekeeper.\\n- Hazards are per-step rows (Teilprozess context). The same hazard family can appear in multiple steps, but each occurrence is a separate hazard row with its own controls/ratings/actions.\\n- Target relationships: 1 step → many hazards; 1 hazard(row) → many actions.\\n\\nHow we’ll use this:\\n- Add/append 'Decisions' with date + rationale.\\n- Add 'Open questions' that should become beads.\\n- Link to key docs/plan sections when relevant.","acceptance_criteria":"- This bead remains updated with major decisions\\n- New sessions can read it and regain context quickly","notes":"2025-12-12 — Ratings scales (from template):\\n\\nSeverity (5-level):\\n1) First aid\\n2) Medical treatment (no lost time)\\n3) Lost time injury\\n4) Irreversible injury\\n5) Death\\n\\nLikelihood (5-level, 1=highest likelihood → 5=lowest):\\n1) Certain to occur (common/repeating; occurs regularly)\\n2) Likely to occur (known to occur; happened \u003e1x)\\n3) Possible to occur (could occur; happened once)\\n4) Unlikely to occur (could occur but not likely; known in industry)\\n5) Extremely unlikely (practically impossible; exceptional; unknown locally but possible in industry)\\n\\nRisk evaluation uses template scheme for now, with acceptance bands and guidance:\\n- Extreme risk: Treat; approve Station Manager; stop immediately; mitigate now.\\n- High risk: Treat; approve Unit/Dpt Head/BL leader; mitigate 1–3 weeks.\\n- Moderate risk: Treat or tolerate based on review (ALARP); mitigate 1–3 months.\\n- Minor risk: Tolerate; approve Supervisors; monitor controls.\\n- Negligible risk: Tolerate; approve Supervisors; monitor controls.\\n\\nLikelihood estimation considerations: exposure, technique/environment, awareness/leadership.\n\n2025-12-18 — Decisions:\n- Hazards are step-scoped rows: DB uses `Hazard.stepId` + `Hazard.orderIndex` (legacy `HazardStep` removed); migration splits multi-step hazards into per-step rows. See `docs/hazard_row_model.md`.\n- Attachments MVP: `Attachment` model with local-disk storage (`SAFETYSECRETARY_ATTACHMENTS_DIR`, `SAFETYSECRETARY_ATTACHMENT_MAX_BYTES`); API under `/api/ra-cases/:id/attachments` and per-step photo upload + drag/reorder UI.\n- Exports: XLSX export better matches the template and includes a Photos sheet from attachments.\n- LLM UX: Global contextual input supports a clarification loop; voice dictation via Web Speech API.\n- Beads workflow: sync branch is `beads-sync`; `bd sync` requires network access.","status":"closed","priority":0,"issue_type":"chore","created_at":"2025-12-12T12:31:06.163726876+01:00","updated_at":"2025-12-18T22:09:06.969110485+01:00","closed_at":"2025-12-18T22:09:06.969112098+01:00"}
{"id":"SafetySecretary-4uq.1","title":"(Optional) Keep memory bead curated","description":"When major decisions occur, append to SafetySecretary-4uq. Convert open questions into beads.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T12:58:27.949665187+01:00","updated_at":"2025-12-18T22:08:56.834334756+01:00","closed_at":"2025-12-18T22:08:56.834336307+01:00","dependencies":[{"issue_id":"SafetySecretary-4uq.1","depends_on_id":"SafetySecretary-4uq","type":"parent-child","created_at":"2025-12-12T12:58:27.950221198+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-4vd","title":"Current Code Analysis","description":"```typescript","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.658333257+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-4w4","title":"Files to Modify","description":"- `src/middleware/rateLimiter.ts` (NEW)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.673663367+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-5ly","title":"Testing","description":"1. Inject error in processQueue and verify it's logged","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.678472656+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-5rf","title":"JHA API routes + LLM extraction + exports + attachments","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:51:04.723012808+01:00","updated_at":"2025-12-21T00:28:49.962291672+01:00","closed_at":"2025-12-21T00:28:49.962293401+01:00","dependencies":[{"issue_id":"SafetySecretary-5rf","depends_on_id":"SafetySecretary-8r4","type":"blocks","created_at":"2025-12-20T22:51:55.551101874+01:00","created_by":"oliver"}],"comments":[{"id":2,"issue_id":"SafetySecretary-5rf","author":"oliver","text":"Add /api/jha-cases router (CRUD, extract rows), hook into LLM service/job manager, add JHA PDF/XLSX export in ReportService, and JHA attachments router mirroring HIRA behavior.","created_at":"2025-12-20T21:51:14Z"},{"id":6,"issue_id":"SafetySecretary-5rf","author":"oliver","text":"Epic: JHA API + LLM + exports + attachments. Goal: expose CRUD + extract rows endpoints, wire LLM prompts/jobs, and add JHA-specific PDF/XLSX export and attachment endpoints (mirroring existing RA patterns). Depends on JHA data model/service foundation.","created_at":"2025-12-20T21:59:11Z"}]}
{"id":"SafetySecretary-5rf.1","title":"JHA LLM prompt + extractRows in LlmService","description":"Add a JHA-specific prompt to extract rows (step, hazard, consequence, controls) from user narrative. Implement LlmService.extractJhaRows with deterministic fallback (simple split heuristic) when no API key.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:00:20.56998399+01:00","updated_at":"2025-12-20T23:52:00.349987753+01:00","closed_at":"2025-12-20T23:52:00.349989672+01:00","dependencies":[{"issue_id":"SafetySecretary-5rf.1","depends_on_id":"SafetySecretary-5rf","type":"parent-child","created_at":"2025-12-20T23:00:20.571683556+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-5rf.2","title":"JHA LLM job pipeline","description":"Extend LlmJobManager to queue JHA row extraction jobs (e.g., type 'jha-rows') and update /api/llm-jobs to return status. Job should call JhaService.replaceRowsFromExtraction.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:00:30.60514785+01:00","updated_at":"2025-12-20T23:55:41.813216318+01:00","closed_at":"2025-12-20T23:55:41.813218033+01:00","dependencies":[{"issue_id":"SafetySecretary-5rf.2","depends_on_id":"SafetySecretary-5rf","type":"parent-child","created_at":"2025-12-20T23:00:30.605903666+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-5rf.2","depends_on_id":"SafetySecretary-5rf.1","type":"blocks","created_at":"2025-12-20T23:03:24.698119593+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-5rf.2","depends_on_id":"SafetySecretary-8r4.3","type":"blocks","created_at":"2025-12-20T23:03:34.717017383+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-5rf.3","title":"JHA cases API router","description":"Create /api/jha-cases router with CRUD, list (recent), update steps/hazards, and extract endpoint that enqueues JHA LLM job. Mirror RA router validation style; keep payloads simple (jobTitle, site, supervisor, workersInvolved, dates, revision, sign-off).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:00:40.639228052+01:00","updated_at":"2025-12-20T23:55:56.96758844+01:00","closed_at":"2025-12-20T23:55:56.967590359+01:00","dependencies":[{"issue_id":"SafetySecretary-5rf.3","depends_on_id":"SafetySecretary-5rf","type":"parent-child","created_at":"2025-12-20T23:00:40.640013534+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-5rf.3","depends_on_id":"SafetySecretary-8r4.3","type":"blocks","created_at":"2025-12-20T23:03:42.494902303+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-5rf.3","depends_on_id":"SafetySecretary-5rf.2","type":"blocks","created_at":"2025-12-20T23:03:50.206877404+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-5rf.4","title":"JHA PDF/XLSX export (one-pager)","description":"Extend ReportService with generatePdfForJhaCase and generateXlsxForJhaCase. Output a one-page PDF with metadata + table (Step/Hazard/Consequence/Controls) + sign-off. XLSX should mirror columns for downstream use.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:00:51.54105245+01:00","updated_at":"2025-12-20T23:56:28.418642018+01:00","closed_at":"2025-12-20T23:56:28.41864377+01:00","dependencies":[{"issue_id":"SafetySecretary-5rf.4","depends_on_id":"SafetySecretary-5rf","type":"parent-child","created_at":"2025-12-20T23:00:51.541764436+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-5rf.4","depends_on_id":"SafetySecretary-8r4.3","type":"blocks","created_at":"2025-12-20T23:03:59.273722614+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-5rf.5","title":"JHA attachments router + storage","description":"Add /api/jha-cases/:id/attachments router (list, upload to step/hazard, reorder, move, delete, download). Reuse attachments directory + storage key conventions with JHA case ids.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:01:00.900918816+01:00","updated_at":"2025-12-20T23:58:09.371188941+01:00","closed_at":"2025-12-20T23:58:09.371194077+01:00","dependencies":[{"issue_id":"SafetySecretary-5rf.5","depends_on_id":"SafetySecretary-5rf","type":"parent-child","created_at":"2025-12-20T23:01:00.901647897+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-5rf.5","depends_on_id":"SafetySecretary-8r4.3","type":"blocks","created_at":"2025-12-20T23:04:10.753957823+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-5rf.6","title":"App wiring for JHA services/routes","description":"Register JhaService in app.locals, mount /api/jha-cases routes + /api/jha-cases/:id/attachments, and ensure server startup connects to DB using the new service as needed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:01:09.538614217+01:00","updated_at":"2025-12-20T23:58:19.91796573+01:00","closed_at":"2025-12-20T23:58:19.917967308+01:00","dependencies":[{"issue_id":"SafetySecretary-5rf.6","depends_on_id":"SafetySecretary-5rf","type":"parent-child","created_at":"2025-12-20T23:01:09.539356122+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-5rf.6","depends_on_id":"SafetySecretary-5rf.3","type":"blocks","created_at":"2025-12-20T23:04:18.824836622+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-5rf.6","depends_on_id":"SafetySecretary-5rf.5","type":"blocks","created_at":"2025-12-20T23:04:28.705487344+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-5rf.6","depends_on_id":"SafetySecretary-5rf.4","type":"blocks","created_at":"2025-12-20T23:04:37.627416819+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-5rf.7","title":"JHA backend tests (routes + exports)","description":"Add/extend Vitest coverage for JHA routes, LLM job flow, and export endpoints to prevent regressions in core CRUD/extract/export paths.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T23:02:25.379189832+01:00","updated_at":"2025-12-21T00:28:06.810683384+01:00","closed_at":"2025-12-21T00:28:06.810685154+01:00","dependencies":[{"issue_id":"SafetySecretary-5rf.7","depends_on_id":"SafetySecretary-5rf","type":"parent-child","created_at":"2025-12-20T23:02:25.379870481+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-5rf.7","depends_on_id":"SafetySecretary-5rf.3","type":"blocks","created_at":"2025-12-20T23:06:08.547490214+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-5rf.7","depends_on_id":"SafetySecretary-5rf.4","type":"blocks","created_at":"2025-12-20T23:06:17.644959502+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-5ux","title":"Problem Statement","description":"**File:** `frontend/src/components/RaEditor.tsx:247-255`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.700492535+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-5vb","title":"Problem Statement","description":"**Files:**","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.667511708+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-5yx","title":"Demo mode docs + QA checklist","description":"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-21T08:00:43.51500543+01:00","updated_at":"2025-12-21T09:29:41.020408176+01:00","closed_at":"2025-12-21T09:29:41.020409864+01:00","dependencies":[{"issue_id":"SafetySecretary-5yx","depends_on_id":"SafetySecretary-dpp","type":"blocks","created_at":"2025-12-21T08:01:02.288103561+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-5yx","depends_on_id":"SafetySecretary-v9t","type":"blocks","created_at":"2025-12-21T08:01:09.86854793+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-5yx","depends_on_id":"SafetySecretary-chk","type":"blocks","created_at":"2025-12-21T08:01:18.061443+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-5yx","depends_on_id":"SafetySecretary-8a9","type":"blocks","created_at":"2025-12-21T08:07:36.435821585+01:00","created_by":"oliver"}],"comments":[{"id":40,"issue_id":"SafetySecretary-5yx","author":"oliver","text":"Goal: document how to enable demo mode, which env vars are required, and how to reset/clean demo data. Add a short QA checklist to verify demo login and the new incident/JHA flows.\\n\\nReasoning: future maintainers and testers need a clear path to run the system without guessing.\\n\\nConsiderations: keep instructions in README or docs/, and clearly warn that demo mode should never be enabled in production.","created_at":"2025-12-21T07:00:53Z"},{"id":52,"issue_id":"SafetySecretary-5yx","author":"oliver","text":"Revision: include the demo reset/seed workflow in docs, plus a quick ‘test flow’ checklist that walks through demo login -\u003e create/seed cases -\u003e export JHA PDF -\u003e reset demo data.","created_at":"2025-12-21T07:07:29Z"}]}
{"id":"SafetySecretary-628","title":"Files to Modify","description":"- `src/types/api.ts` (NEW - API request/response types)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.685305311+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-649","title":"Current Protection Analysis","description":"```typescript","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.671623889+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-653","title":"UX polish + clarity sweep","description":"Background:\n- Several UX polish items remain: category editing, label consistency, matrix settings propagation, and copy clarity.\n\nGoal:\n- Improve clarity and premium feel by removing small inconsistencies.\n\nScope:\n- Hazard category affordances, risk matrix settings propagation, landing page copy.\n\nAcceptance (epic-level):\n- Small polish items addressed without breaking core workflows.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-20T21:51:08.299371275+01:00","updated_at":"2025-12-21T03:46:55.027806609+01:00","closed_at":"2025-12-21T03:46:55.02780869+01:00"}
{"id":"SafetySecretary-653.1","title":"Hazard category UX: edit + label consistency","description":"Background:\n- Hazard identification phase shows category as read-only label.\n- Workspace table shows raw category codes instead of labels.\n\nGoal:\n- Allow category editing in hazard identification.\n- Display labels consistently across views.\n\nAcceptance:\n- Category is editable in hazard identification.\n- Workspace shows labels (optionally with code in tooltip).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T21:51:18.339082535+01:00","updated_at":"2025-12-21T03:46:13.314259596+01:00","closed_at":"2025-12-21T03:46:13.314262297+01:00","dependencies":[{"issue_id":"SafetySecretary-653.1","depends_on_id":"SafetySecretary-653","type":"parent-child","created_at":"2025-12-20T21:51:18.339833451+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-653.2","title":"Risk matrix settings propagation to workspace","description":"Background:\n- Workspace risk pills read matrix settings once and do not react to changes.\n\nGoal:\n- Make workspace risk color pills respond to settings changes (e.g., storage events).\n\nAcceptance:\n- Updating matrix settings updates workspace risk colors without reload.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T21:51:28.170156022+01:00","updated_at":"2025-12-21T03:46:22.481893864+01:00","closed_at":"2025-12-21T03:46:22.481895687+01:00","dependencies":[{"issue_id":"SafetySecretary-653.2","depends_on_id":"SafetySecretary-653","type":"parent-child","created_at":"2025-12-20T21:51:28.170935447+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-653.3","title":"Landing copy + recent cases semantics","description":"Background:\n- Landing page says \"These entries stay in your browser\" but data is server-backed.\n- Delete copy implies only local removal.\n\nGoal:\n- Clarify where cases are stored and what delete does.\n\nAcceptance:\n- Copy accurately reflects server-backed cases.\n- Delete confirmation warns about permanent removal.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T21:51:37.746661422+01:00","updated_at":"2025-12-21T03:46:34.818737888+01:00","closed_at":"2025-12-21T03:46:34.818739665+01:00","dependencies":[{"issue_id":"SafetySecretary-653.3","depends_on_id":"SafetySecretary-653","type":"parent-child","created_at":"2025-12-20T21:51:37.748165335+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-653.4","title":"Terminology/label consistency pass","description":"Background:\n- Save/Continue/Autosave wording varies by phase, sometimes conflicting with actual behavior.\n\nGoal:\n- Standardize terminology after persistence policy is set.\n\nAcceptance:\n- Consistent labels and helper text across phases.\n- Wording matches actual persistence behavior.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T21:51:47.7818813+01:00","updated_at":"2025-12-21T03:46:44.69187136+01:00","closed_at":"2025-12-21T03:46:44.691873069+01:00","dependencies":[{"issue_id":"SafetySecretary-653.4","depends_on_id":"SafetySecretary-653","type":"parent-child","created_at":"2025-12-20T21:51:47.782565083+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-653.4","depends_on_id":"SafetySecretary-hp8.1","type":"blocks","created_at":"2025-12-20T21:51:57.061136457+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-66a","title":"Dependencies","description":"Blocked by: High Priority Epic","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.681941641+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-6j7","title":"Problem Statement","description":"Several frequently-queried paths lack optimal indexes:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.693727522+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-6jb","title":"Problem Statement","description":"Three nearly identical attachment routers:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.685790556+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-6jz","title":"Current Code Pattern (Bad)","description":"```typescript","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.66800828+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-6wc","title":"Problem Statement","description":"**File:** `src/services/tenantDbManager.ts`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.664004641+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-72e","title":"Alternative: True Optimistic Updates","description":"If optimistic updates are desired for UX, implement properly with rollback:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.680027714+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-7cm","title":"Problem Statement","description":"Validation functions are duplicated across:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.682413343+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-7i9","title":"Problem Statement","description":"**File:** `frontend/src/contexts/RaContext.tsx:205-236`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.679070868+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-7ka","title":"JHA frontend landing + editor + attachments","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:51:38.442575119+01:00","updated_at":"2025-12-21T00:28:30.46826787+01:00","closed_at":"2025-12-21T00:28:30.468269731+01:00","dependencies":[{"issue_id":"SafetySecretary-7ka","depends_on_id":"SafetySecretary-5rf","type":"blocks","created_at":"2025-12-20T22:52:03.739804925+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-7ka","depends_on_id":"SafetySecretary-41v","type":"blocks","created_at":"2025-12-20T22:52:11.495326444+01:00","created_by":"oliver"}],"comments":[{"id":4,"issue_id":"SafetySecretary-7ka","author":"oliver","text":"Build JHA create/load page, JHA editor with LLM-assisted row generation and editable table (step/hazard/consequence/controls), sign-off fields, and photo uploads tied to JHA steps/hazards.","created_at":"2025-12-20T21:51:47Z"},{"id":8,"issue_id":"SafetySecretary-7ka","author":"oliver","text":"Epic: JHA frontend experience. Goal: create JHA create/load landing, JHA editor (steps/hazard/consequence/controls), LLM-assisted row generation, attachments, and export buttons. Should feel simpler than HIRA but reuse patterns where possible.","created_at":"2025-12-20T21:59:29Z"}]}
{"id":"SafetySecretary-7ka.1","title":"JHA frontend types + context","description":"Add frontend JHA types and a JhaContext (similar to RaContext) with actions: create/load, save steps/hazards, run LLM extraction, manage attachments, export. Keep API paths under /api/jha-cases.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:01:36.30522321+01:00","updated_at":"2025-12-20T23:59:22.411995974+01:00","closed_at":"2025-12-20T23:59:22.411997947+01:00","dependencies":[{"issue_id":"SafetySecretary-7ka.1","depends_on_id":"SafetySecretary-7ka","type":"parent-child","created_at":"2025-12-20T23:01:36.306006006+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-7ka.1","depends_on_id":"SafetySecretary-5rf.3","type":"blocks","created_at":"2025-12-20T23:04:46.677348259+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-7ka.1","depends_on_id":"SafetySecretary-5rf.2","type":"blocks","created_at":"2025-12-20T23:04:55.605797649+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-7ka.2","title":"JHA landing (create/load/list)","description":"Build JHA landing page with minimal metadata fields (job title, site, supervisor, workers, date, revision) and recent JHA cases list. Mirror HIRA landing behavior but keep copy/labels JHA-specific.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:01:45.142494863+01:00","updated_at":"2025-12-21T00:00:30.27445686+01:00","closed_at":"2025-12-21T00:00:30.274462625+01:00","dependencies":[{"issue_id":"SafetySecretary-7ka.2","depends_on_id":"SafetySecretary-7ka","type":"parent-child","created_at":"2025-12-20T23:01:45.143149435+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-7ka.2","depends_on_id":"SafetySecretary-7ka.1","type":"blocks","created_at":"2025-12-20T23:05:05.141265486+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-7ka.3","title":"JHA editor table + LLM assistant","description":"Create JHA editor view with a simple table (Step, Hazard, Consequence, Controls). Add AssistantPanel for LLM extraction from narrative, and allow manual row add/edit/reorder. Keep UI narrower than HIRA for readability.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:01:53.856536281+01:00","updated_at":"2025-12-21T00:27:30.509555275+01:00","closed_at":"2025-12-21T00:27:30.509556956+01:00","dependencies":[{"issue_id":"SafetySecretary-7ka.3","depends_on_id":"SafetySecretary-7ka","type":"parent-child","created_at":"2025-12-20T23:01:53.857214286+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-7ka.3","depends_on_id":"SafetySecretary-7ka.1","type":"blocks","created_at":"2025-12-20T23:05:14.94687985+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-7ka.4","title":"JHA attachments UI","description":"Reuse attachment upload UX for JHA steps/hazards (photos/sketches). Provide drag-and-drop reorder and move between steps. Ensure attachments show in JHA editor.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:02:03.642346199+01:00","updated_at":"2025-12-21T00:27:38.650098858+01:00","closed_at":"2025-12-21T00:27:38.65010066+01:00","dependencies":[{"issue_id":"SafetySecretary-7ka.4","depends_on_id":"SafetySecretary-7ka","type":"parent-child","created_at":"2025-12-20T23:02:03.644001385+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-7ka.4","depends_on_id":"SafetySecretary-5rf.5","type":"blocks","created_at":"2025-12-20T23:05:25.400907429+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-7ka.4","depends_on_id":"SafetySecretary-7ka.1","type":"blocks","created_at":"2025-12-20T23:05:34.93093568+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-7ka.4","depends_on_id":"SafetySecretary-7ka.3","type":"blocks","created_at":"2025-12-20T23:07:19.889736435+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-7ka.5","title":"JHA export buttons wiring","description":"Add export PDF/XLSX buttons to JHA editor header, pointing to /api/jha-cases/:id/export/pdf and /xlsx. Keep behavior consistent with HIRA (open in new tab).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:02:13.686997293+01:00","updated_at":"2025-12-21T00:27:46.957413815+01:00","closed_at":"2025-12-21T00:27:46.957415723+01:00","dependencies":[{"issue_id":"SafetySecretary-7ka.5","depends_on_id":"SafetySecretary-7ka","type":"parent-child","created_at":"2025-12-20T23:02:13.687715834+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-7ka.5","depends_on_id":"SafetySecretary-5rf.4","type":"blocks","created_at":"2025-12-20T23:05:43.370559981+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-7ka.5","depends_on_id":"SafetySecretary-7ka.3","type":"blocks","created_at":"2025-12-20T23:05:52.137812292+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-7ka.6","title":"JHA frontend tests","description":"Add minimal component tests for JHA landing + editor (smoke rendering, row add, LLM call action wiring) to match existing frontend test patterns.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T23:02:34.100660628+01:00","updated_at":"2025-12-21T00:27:56.265994687+01:00","closed_at":"2025-12-21T00:27:56.265996402+01:00","dependencies":[{"issue_id":"SafetySecretary-7ka.6","depends_on_id":"SafetySecretary-7ka","type":"parent-child","created_at":"2025-12-20T23:02:34.10497058+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-7ka.6","depends_on_id":"SafetySecretary-7ka.3","type":"blocks","created_at":"2025-12-20T23:06:00.186067084+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-7sh","title":"Solution Design","description":"Create a factory that generates attachment routers:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.686292697+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-7zz","title":"Meeting-room LLM assistant (written + spoken)","description":"Make it possible for a group to think out loud and have the HIRA table fill iteratively via text and voice.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-12T00:03:37.960141309+01:00","updated_at":"2025-12-18T21:20:51.915401695+01:00","closed_at":"2025-12-18T21:20:51.915403212+01:00"}
{"id":"SafetySecretary-7zz.1","title":"Refine prompts \u0026 command schemas","description":"Tighten LLM prompts for steps/hazards/controls/actions + contextual updates; ensure deterministic JSON.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T00:04:26.704139793+01:00","updated_at":"2025-12-18T20:35:47.591114535+01:00","closed_at":"2025-12-18T20:35:47.591116284+01:00","dependencies":[{"issue_id":"SafetySecretary-7zz.1","depends_on_id":"SafetySecretary-7zz","type":"parent-child","created_at":"2025-12-12T00:04:26.704890089+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-7zz.1","depends_on_id":"SafetySecretary-8u2.2","type":"blocks","created_at":"2025-12-12T00:05:39.427609256+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-7zz.2","title":"Clarification loop UX","description":"If parse returns needsClarification, capture follow-up and re-parse/apply cleanly.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:04:30.004781248+01:00","updated_at":"2025-12-18T20:32:23.788953567+01:00","closed_at":"2025-12-18T20:32:23.788955139+01:00","dependencies":[{"issue_id":"SafetySecretary-7zz.2","depends_on_id":"SafetySecretary-7zz","type":"parent-child","created_at":"2025-12-12T00:04:30.005468673+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-7zz.3","title":"Voice input MVP → contextual updates","description":"Add mic controls using browser STT, stream transcript into GlobalLLMInput/phase notes, parse/apply iteratively.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:04:33.156399667+01:00","updated_at":"2025-12-18T20:52:10.695793238+01:00","closed_at":"2025-12-18T20:52:10.695810672+01:00","dependencies":[{"issue_id":"SafetySecretary-7zz.3","depends_on_id":"SafetySecretary-7zz","type":"parent-child","created_at":"2025-12-12T00:04:33.157108914+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-7zz.4","title":"Decide realtime multi-user scope","description":"Confirm whether v1 needs WebSocket multi-device editing or facilitator-only editing.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T00:04:36.436788141+01:00","updated_at":"2025-12-18T20:48:11.9697027+01:00","closed_at":"2025-12-18T20:48:11.969704295+01:00","dependencies":[{"issue_id":"SafetySecretary-7zz.4","depends_on_id":"SafetySecretary-7zz","type":"parent-child","created_at":"2025-12-12T00:04:36.437590354+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-8a9","title":"Demo data reset + seed helpers","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T08:05:53.111097147+01:00","updated_at":"2025-12-21T09:16:39.674699196+01:00","closed_at":"2025-12-21T09:16:39.674700997+01:00","dependencies":[{"issue_id":"SafetySecretary-8a9","depends_on_id":"SafetySecretary-0l9","type":"blocks","created_at":"2025-12-21T08:06:09.375857949+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-8a9","depends_on_id":"SafetySecretary-q46","type":"blocks","created_at":"2025-12-21T08:06:16.662853377+01:00","created_by":"oliver"}],"comments":[{"id":45,"issue_id":"SafetySecretary-8a9","author":"oliver","text":"Goal: provide a simple way to reset and reseed demo data so testing stays clean and fast.\\n\\nDeliverables: a protected demo-only endpoint or CLI command that clears demo org cases and re-seeds a few example HIRA/JHA/II cases with representative data. Optionally expose a UI action in demo banner.\\n\\nReasoning: shared demo org quickly becomes cluttered; a reset improves tester experience and keeps screenshots consistent.\\n\\nSafety: only available in demo mode; double-confirm in UI; never available to real orgs.","created_at":"2025-12-21T07:06:02Z"}]}
{"id":"SafetySecretary-8r4","title":"JHA data model + service foundation","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:50:43.808138879+01:00","updated_at":"2025-12-21T00:29:00.57475843+01:00","closed_at":"2025-12-21T00:29:00.574760377+01:00","comments":[{"id":1,"issue_id":"SafetySecretary-8r4","author":"oliver","text":"Add Prisma models for JHA (case/step/hazard/attachment), migration SQL, backend types, and JhaService CRUD helpers. Keep schema separate from HIRA but reuse patterns (orderIndex, cascades).","created_at":"2025-12-20T21:50:57Z"},{"id":5,"issue_id":"SafetySecretary-8r4","author":"oliver","text":"Epic: JHA data model + service foundation. Goal: introduce separate JHA tables and service layer without touching HIRA schema. Child tasks will cover schema/migration, backend types, service CRUD, and attachment ordering utilities so API/UI can build safely on top.","created_at":"2025-12-20T21:59:02Z"}]}
{"id":"SafetySecretary-8r4.1","title":"JHA Prisma schema + migration","description":"Add JhaCase/JhaStep/JhaHazard/JhaAttachment to prisma/schema.prisma with separate tables and cascades. Create SQL migration with indexes, arrays for controls, and sign-off/date fields. Keep schema independent from HIRA to avoid regressions.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:59:49.531782988+01:00","updated_at":"2025-12-20T23:51:40.863717415+01:00","closed_at":"2025-12-20T23:51:40.863719166+01:00","dependencies":[{"issue_id":"SafetySecretary-8r4.1","depends_on_id":"SafetySecretary-8r4","type":"parent-child","created_at":"2025-12-20T22:59:49.53258296+01:00","created_by":"oliver"}],"comments":[{"id":9,"issue_id":"SafetySecretary-8r4.1","author":"oliver","text":"Progress note: working tree already includes JHA models appended to prisma/schema.prisma and a draft migration at prisma/migrations/20260109120000_add_jha_models/migration.sql. Review/adjust before finalizing.","created_at":"2025-12-20T22:06:40Z"}]}
{"id":"SafetySecretary-8r4.2","title":"JHA backend types + DTOs","description":"Define backend JHA types (inputs, summaries) in src/types/jha.ts and any shared DTO helpers. Ensure date parsing rules are explicit and match API payloads.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:00:00.494901061+01:00","updated_at":"2025-12-20T23:51:51.613810847+01:00","closed_at":"2025-12-20T23:51:51.613812519+01:00","dependencies":[{"issue_id":"SafetySecretary-8r4.2","depends_on_id":"SafetySecretary-8r4","type":"parent-child","created_at":"2025-12-20T23:00:00.495568954+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-8r4.3","title":"JhaService CRUD + attachment ordering","description":"Implement JhaService with CRUD for cases, steps, hazards, and attachment helpers (add/move/reorder/delete) mirroring RiskAssessmentService patterns. Validate step ownership and keep orderIndex consistent when rows are added/removed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T23:00:10.630935699+01:00","updated_at":"2025-12-20T23:53:00.735362335+01:00","closed_at":"2025-12-20T23:53:00.735364098+01:00","dependencies":[{"issue_id":"SafetySecretary-8r4.3","depends_on_id":"SafetySecretary-8r4","type":"parent-child","created_at":"2025-12-20T23:00:10.631617935+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-8r4.3","depends_on_id":"SafetySecretary-8r4.1","type":"blocks","created_at":"2025-12-20T23:03:07.281111441+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-8r4.3","depends_on_id":"SafetySecretary-8r4.2","type":"blocks","created_at":"2025-12-20T23:03:14.956933727+01:00","created_by":"oliver"}],"comments":[{"id":10,"issue_id":"SafetySecretary-8r4.3","author":"oliver","text":"Progress note: draft src/services/jhaService.ts created with CRUD + attachments, but attachment ordering/move logic still needs alignment with RiskAssessmentService patterns.","created_at":"2025-12-20T22:06:49Z"}]}
{"id":"SafetySecretary-8u2","title":"Core stabilization \u0026 ratings correctness","description":"Stabilize DB/model and fix rating persistence/mapping before bigger features.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-12T00:03:33.518113166+01:00","updated_at":"2025-12-18T22:26:20.897002435+01:00","closed_at":"2025-12-18T22:26:20.897003835+01:00"}
{"id":"SafetySecretary-8u2.1","title":"Add strict severity/likelihood validation","description":"Enforce allowed values end-to-end. Prefer Prisma enums + migration, or Zod validation if migration risk is high.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T00:04:05.400955488+01:00","updated_at":"2025-12-12T11:48:11.094269945+01:00","closed_at":"2025-12-12T11:48:11.094273125+01:00","dependencies":[{"issue_id":"SafetySecretary-8u2.1","depends_on_id":"SafetySecretary-8u2","type":"parent-child","created_at":"2025-12-12T00:04:05.401593325+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-8u2.2","title":"Fix LLM contextual state to include ratings","description":"Frontend and backend tableState should include baseline/residual snapshots so updates like 'make that high' work.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-12T00:04:10.021655415+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","dependencies":[{"issue_id":"SafetySecretary-8u2.2","depends_on_id":"SafetySecretary-8u2","type":"parent-child","created_at":"2025-12-12T00:04:10.022310571+01:00","created_by":"daemon"}],"deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-8u2.3","title":"Harden contextual apply endpoint","description":"Normalize/validate action status, category codes, step indices; return clear errors instead of silent no-ops.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T00:04:14.723537292+01:00","updated_at":"2025-12-12T11:48:15.792138266+01:00","closed_at":"2025-12-12T11:48:15.792140607+01:00","dependencies":[{"issue_id":"SafetySecretary-8u2.3","depends_on_id":"SafetySecretary-8u2","type":"parent-child","created_at":"2025-12-12T00:04:14.724333801+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-8u2.4","title":"Standardize baseline/residual naming","description":"Remove duplicate baselineAssessment/residualAssessment fields; keep one canonical name across backend+frontend.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:04:18.929065435+01:00","updated_at":"2025-12-18T20:28:25.937216656+01:00","closed_at":"2025-12-18T20:28:25.937218492+01:00","dependencies":[{"issue_id":"SafetySecretary-8u2.4","depends_on_id":"SafetySecretary-8u2","type":"parent-child","created_at":"2025-12-12T00:04:18.929985507+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-8u2.5","title":"Regression tests for ratings persistence","description":"Add backend+frontend tests to ensure severity/likelihood save/load and matrix counts match hazards.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:04:22.713917222+01:00","updated_at":"2025-12-18T19:50:44.857931992+01:00","closed_at":"2025-12-18T19:50:44.857933783+01:00","dependencies":[{"issue_id":"SafetySecretary-8u2.5","depends_on_id":"SafetySecretary-8u2","type":"parent-child","created_at":"2025-12-12T00:04:22.71460826+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-8u2.5","depends_on_id":"SafetySecretary-8u2.1","type":"blocks","created_at":"2025-12-12T00:05:39.414228607+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-8u2.6","title":"Backend: case-scoped write hardening","description":"Audit and fix backend write paths so every mutation is scoped to the case. Validate that step/hazard/control/action IDs belong to the case before updating/deleting; avoid cross-case updates via guessed IDs.","acceptance_criteria":"- All write operations verify case ownership for nested IDs\\n- Attempted cross-case mutations return 400/404\\n- Add/extend tests to cover at least one cross-case attempt","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T19:14:18.056570417+01:00","updated_at":"2025-12-18T20:22:24.918848461+01:00","closed_at":"2025-12-18T20:22:24.918850302+01:00","dependencies":[{"issue_id":"SafetySecretary-8u2.6","depends_on_id":"SafetySecretary-8u2","type":"parent-child","created_at":"2025-12-18T19:17:51.799702161+01:00","created_by":"import"}]}
{"id":"SafetySecretary-8u2.7","title":"Frontend: align LLM job typing with backend","description":"Update frontend LlmJobResponse typing to match backend job types (steps/hazards/controls/actions) and ensure polling code tolerates unknown types.","acceptance_criteria":"- frontend/src/lib/jobs.ts type union matches backend\\n- No TS type lies around controls/actions jobs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T19:14:18.08937659+01:00","updated_at":"2025-12-18T20:24:53.659147565+01:00","closed_at":"2025-12-18T20:24:53.659149025+01:00","dependencies":[{"issue_id":"SafetySecretary-8u2.7","depends_on_id":"SafetySecretary-8u2","type":"parent-child","created_at":"2025-12-18T19:17:51.80049166+01:00","created_by":"import"}]}
{"id":"SafetySecretary-8u2.8","title":"Backend: make LLM jobs durable (or explicitly ephemeral)","description":"Decide and implement a durable job strategy for LLM extractions. Options: persist job state/results in DB, or keep in-memory but make UI/UX explicitly resilient to restarts (clear messaging + retry).","acceptance_criteria":"- Behavior on server restart is defined and acceptable\\n- If durable: job state persists and /api/llm-jobs/:id survives restart\\n- If ephemeral: frontend handles missing jobs gracefully and can re-run","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T19:14:18.122189698+01:00","updated_at":"2025-12-18T22:25:57.127474702+01:00","closed_at":"2025-12-18T22:25:57.127476468+01:00","dependencies":[{"issue_id":"SafetySecretary-8u2.8","depends_on_id":"SafetySecretary-8u2","type":"parent-child","created_at":"2025-12-18T19:17:51.801276399+01:00","created_by":"import"},{"issue_id":"SafetySecretary-8u2.8","depends_on_id":"SafetySecretary-91x.5","type":"blocks","created_at":"2025-12-18T19:17:51.802039331+01:00","created_by":"import"}]}
{"id":"SafetySecretary-8v3","title":"Why This Design","description":"1. **Defense in Depth**: Validation PLUS safe quoting","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.662496526+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-8vh","title":"Why This Design","description":"1. **MAX_CLIENTS**: Hard limit prevents unbounded growth (50 is reasonable for most deployments)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.665478998+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-8wg","title":"Testing","description":"1. Test that valid slugs create databases","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.663517334+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-909","title":"Files to Modify","description":"- `src/middleware/globalErrorHandler.ts` (NEW)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.659905801+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-91x","title":"Model: hazards are per-step HIRA rows","description":"Decision: hazards are not global. Each hazard record represents one HIRA table row in a specific process step (Teilprozess). Same hazard family can appear in multiple steps, but those are separate hazard rows with different controls/ratings/actions.\\n\\nImplication: current multi-step hazard linking (HazardStep join + hazard.stepIds) is the wrong abstraction; controls/ratings should not be shared across steps.\\n\\nGoal: enforce 1 step → many hazards, and 1 hazard → many actions.\\n\\nOut of scope for this epic: global hazard taxonomy/entities beyond category codes.","acceptance_criteria":"- Data model enforces hazard belongs to exactly one step\\n- Existing controls and baseline/residual ratings are unambiguous per hazard row\\n- UI/LLM flows operate on hazard rows without cross-step coupling\\n- Exports reflect per-step hazard rows","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-12T12:27:09.499884224+01:00","updated_at":"2025-12-18T22:22:53.00557038+01:00","closed_at":"2025-12-18T22:22:53.005571835+01:00"}
{"id":"SafetySecretary-91x.1","title":"Exports: ensure table rows match step-scoped hazards","description":"Confirm PDF/XLSX export iterates hazards per step (row semantics) and includes correct controls/ratings/actions.","acceptance_criteria":"- Export output reflects per-step hazard rows","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T12:27:26.908706792+01:00","updated_at":"2025-12-18T22:22:44.224041172+01:00","closed_at":"2025-12-18T22:22:44.224042872+01:00","dependencies":[{"issue_id":"SafetySecretary-91x.1","depends_on_id":"SafetySecretary-91x","type":"parent-child","created_at":"2025-12-12T12:27:26.909462939+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-91x.2","title":"Schema design: hazard belongs to one step","description":"Propose Prisma schema changes to make hazards step-scoped rows. Likely remove HazardStep join and add hazard.stepId + hazard.orderIndex (within step) to support reorder. Clarify how actions link (remain action.hazardId).","acceptance_criteria":"- Chosen schema supports reorder within step\\n- No remaining way for a single hazard row to span multiple steps","notes":"Schema must support:\\n- hazard rows belong to exactly one step but can be moved/copied to another step\\n- hazard row stores: categoryCode (SUVA taxonomy), short label, hazard description, consequences, persons at risk\\n- separate fields for mandatory requirements vs other recommended measures vs effectiveness/contributing factors narrative\\n- baseline assessment separate from residual; residual optional until mitigations defined\\n- actions can be hazard-linked or global (hazardId nullable)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T12:27:26.957142556+01:00","updated_at":"2025-12-18T21:53:43.001432838+01:00","closed_at":"2025-12-18T21:53:43.001434399+01:00","dependencies":[{"issue_id":"SafetySecretary-91x.2","depends_on_id":"SafetySecretary-91x","type":"parent-child","created_at":"2025-12-12T12:27:26.957920005+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-91x.3","title":"Frontend updates: hazards per step (row model)","description":"Update UI state/types to treat hazards as step-scoped rows. Remove any UI paths that assign one hazard to multiple steps. Keep grouping-by-step behavior.","acceptance_criteria":"- UI can add multiple hazards per step\\n- No UI flow links one hazard to multiple steps","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:27:27.004681613+01:00","updated_at":"2025-12-18T22:22:06.728180441+01:00","closed_at":"2025-12-18T22:22:06.72818213+01:00","dependencies":[{"issue_id":"SafetySecretary-91x.3","depends_on_id":"SafetySecretary-91x","type":"parent-child","created_at":"2025-12-12T12:27:27.005334493+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-91x.4","title":"Migration plan: convert existing multi-step hazards","description":"Define data migration strategy for existing cases: if a hazard is linked to multiple steps, split into multiple hazard rows (one per step) copying label/description/category/existingControls and duplicating assessments/actions appropriately (or prompting user).","acceptance_criteria":"- Migration rules documented for splitting hazards\\n- No data loss or silent merging","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T12:27:27.060886888+01:00","updated_at":"2025-12-18T21:55:32.997658027+01:00","closed_at":"2025-12-18T21:55:32.997659513+01:00","dependencies":[{"issue_id":"SafetySecretary-91x.4","depends_on_id":"SafetySecretary-91x","type":"parent-child","created_at":"2025-12-12T12:27:27.061987298+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-91x.5","title":"Backend updates: services/routes to new hazard model","description":"Update RiskAssessmentService and API routes to create/update/delete/reorder hazards within a single step without hazard.stepIds/HazardStep. Ensure validation stays strict.","acceptance_criteria":"- API supports add/edit/delete/reorder hazards per step\\n- Ratings/actions still work","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:27:27.108029072+01:00","updated_at":"2025-12-18T22:21:57.901231647+01:00","closed_at":"2025-12-18T22:21:57.901233343+01:00","dependencies":[{"issue_id":"SafetySecretary-91x.5","depends_on_id":"SafetySecretary-91x","type":"parent-child","created_at":"2025-12-12T12:27:27.108802058+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-91x.5","depends_on_id":"SafetySecretary-8u2.6","type":"blocks","created_at":"2025-12-18T19:17:51.803041883+01:00","created_by":"import"}]}
{"id":"SafetySecretary-91x.6","title":"LLM/contextual update: operate on hazard rows","description":"Update contextual parse/apply schema and prompts so commands reference hazard rows (which already imply a step). Remove/ignore commands that try to set hazard.stepIds.","acceptance_criteria":"- Natural-language updates never reassign a hazard row across steps\\n- Commands can add hazard to a specified step","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:27:27.157127552+01:00","updated_at":"2025-12-18T22:22:22.723854651+01:00","closed_at":"2025-12-18T22:22:22.723860166+01:00","dependencies":[{"issue_id":"SafetySecretary-91x.6","depends_on_id":"SafetySecretary-91x","type":"parent-child","created_at":"2025-12-12T12:27:27.157803206+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-96y","title":"Why This Matters","description":"SafetySecretary is a multi-tenant safety management platform handling sensitive workplace safety data including:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.650950576+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-9jn","title":"Solution Design","description":"```typescript","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.664989504+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-9nc","title":"Files to Create","description":"- `frontend/src/components/incident/WitnessAccountPanel.tsx`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.697638448+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-9q3","title":"Docs/README updates for JHA","description":"Update README/quickstart to mention JHA workflow, new routes, and export endpoints. Add any short notes on LLM prompt behavior and JHA data model.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T23:02:43.708907756+01:00","updated_at":"2025-12-21T00:28:16.234873214+01:00","closed_at":"2025-12-21T00:28:16.234874957+01:00"}
{"id":"SafetySecretary-9q7","title":"Solution Design","description":"Create `src/lib/validation.ts`:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.682894655+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-a4r","title":"Considerations","description":"1. **Redis Backend**: For production scale, use `rate-limit-redis` for distributed limiting","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.673163514+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-a8g","title":"Review Methodology","description":"Three parallel exploration agents examined:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.65524109+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-agw","title":"Issues","description":"1. Icon buttons using `^` and `v` symbols","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.702937942+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-aib","title":"Problem Statement","description":"**File:** `src/app.ts:31-32`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.674599857+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-az5","title":"Direct page testability (self-start cases)","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T07:55:22.297226042+01:00","updated_at":"2025-12-21T09:29:29.495519927+01:00","closed_at":"2025-12-21T09:29:29.49552253+01:00","dependencies":[{"issue_id":"SafetySecretary-az5","depends_on_id":"SafetySecretary-dpp","type":"blocks","created_at":"2025-12-21T07:55:40.240291334+01:00","created_by":"oliver"}],"comments":[{"id":28,"issue_id":"SafetySecretary-az5","author":"oliver","text":"Goal: allow every case shell route (/cases/:id, /incidents/:id, /jha/:id) to be directly testable even when the ID is missing or invalid. In demo mode, provide a small ‘Create test case’ CTA that creates a fresh case and redirects to it.\\n\\nReasoning: this matches the request that each subsystem can be tested in isolation without navigating through the landing pages every time.\\n\\nConsiderations: only show auto-create in demo mode to avoid unintended case creation in real orgs; keep error state for non-demo logins; ensure the create endpoint returns a fully formed case so the editor can load cleanly.","created_at":"2025-12-21T06:55:32Z"},{"id":44,"issue_id":"SafetySecretary-az5","author":"oliver","text":"Revision: in demo mode, offer an optional ‘Seed sample case’ action so each subsystem is immediately populated with realistic content (better UX for first-time testers). Keep explicit user action—no silent auto-create in non-demo mode.","created_at":"2025-12-21T07:05:45Z"}]}
{"id":"SafetySecretary-b3n","title":"Files to Modify","description":"- `src/services/tenantDbManager.ts`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.666502411+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-bnc","title":"JHA staged flow tests","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T07:58:46.411428015+01:00","updated_at":"2025-12-21T09:16:48.174139666+01:00","closed_at":"2025-12-21T09:16:48.17414139+01:00","dependencies":[{"issue_id":"SafetySecretary-bnc","depends_on_id":"SafetySecretary-chk","type":"blocks","created_at":"2025-12-21T07:59:05.552856345+01:00","created_by":"oliver"}],"comments":[{"id":36,"issue_id":"SafetySecretary-bnc","author":"oliver","text":"Goal: add frontend tests for the staged JHA flow to ensure navigation, validation, and save actions behave correctly.\\n\\nDeliverables: tests for each stage render, moving between stages, and saving steps/hazards/controls.\\n\\nConsiderations: use stable mocks in JhaContext; keep tests focused on user-visible behavior.","created_at":"2025-12-21T06:58:56Z"}]}
{"id":"SafetySecretary-buf","title":"Files to Modify","description":"- `src/app.ts`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.676035759+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-cb4","title":"Files to Modify","description":"- All route files (replace console.error with logger)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.700023628+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-cfh","title":"Files to Modify","description":"**New:**","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.669049227+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-chk","title":"Implement JHA staged flow in editor","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T07:58:21.726221448+01:00","updated_at":"2025-12-21T08:45:43.04107949+01:00","closed_at":"2025-12-21T08:45:43.04108127+01:00","dependencies":[{"issue_id":"SafetySecretary-chk","depends_on_id":"SafetySecretary-e00","type":"blocks","created_at":"2025-12-21T07:58:38.708023776+01:00","created_by":"oliver"}],"comments":[{"id":35,"issue_id":"SafetySecretary-chk","author":"oliver","text":"Goal: rework JhaEditor into a staged flow that guides users through steps, hazards, controls, then review/edit. The user drives content at each stage and can still reorder, edit, and delete entries.\\n\\nDeliverables: stage navigation controls (similar to HIRA phases), stage-specific inputs, and a final review table that matches export output. Preserve existing attachments panel.\\n\\nConsiderations: maintain stable IDs across stage transitions; avoid auto-creation outside demo mode; ensure the flow supports partial saves so users can stop and resume.","created_at":"2025-12-21T06:58:31Z"},{"id":50,"issue_id":"SafetySecretary-chk","author":"oliver","text":"Revision: persist current stage in case metadata so users can resume where they left off. Show stage completion status and guard against advancing without required fields.","created_at":"2025-12-21T07:07:12Z"}]}
{"id":"SafetySecretary-cxf","title":"Testing","description":"1. Add test that throws error in route and verifies 500 response","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.660419458+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-cz0","title":"Specific Fixes Needed","description":"","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.669547041+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-d0k","title":"Problem Statement","description":"45+ uses of `any` in backend code. Key locations:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.684328796+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-d5j","title":"Problem Statement","description":"Inconsistent logging across codebase:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.698579033+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-dm9","title":"Files to Modify","description":"- `src/routes/shared/attachmentRouterFactory.ts` (NEW)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.692821916+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-dpp","title":"Frontend demo login UI + demo banner","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T07:54:56.415124318+01:00","updated_at":"2025-12-21T09:16:30.25381349+01:00","closed_at":"2025-12-21T09:16:30.253815417+01:00","dependencies":[{"issue_id":"SafetySecretary-dpp","depends_on_id":"SafetySecretary-0l9","type":"blocks","created_at":"2025-12-21T07:55:14.391587204+01:00","created_by":"oliver"}],"comments":[{"id":27,"issue_id":"SafetySecretary-dpp","author":"oliver","text":"Goal: add a clear ‘Login as test user’ affordance on the login page that calls the demo-login endpoint and then routes into the app. Also show a persistent demo-mode banner so testers always know they are writing to the test DB.\\n\\nReasoning: avoids confusion, makes test flow explicit, and prevents accidental assumption that auth is real.\\n\\nConsiderations: banner should be visible across all protected routes (AuthGate wrapper), and the login button should show errors if demo login is disabled or fails. Keep copy in i18n for EN/FR/DE.","created_at":"2025-12-21T06:55:06Z"},{"id":43,"issue_id":"SafetySecretary-dpp","author":"oliver","text":"Revision: demo banner should persist across all protected routes and include a quick link to clear demo data (if we add that helper). Provide a short explanation: ‘You are in demo mode; data lives in the test database.’","created_at":"2025-12-21T07:05:35Z"}]}
{"id":"SafetySecretary-dpt","title":"Problem Statement","description":"**File:** `src/services/tenantProvisioner.ts:96`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.660926854+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-e00","title":"JHA guided flow UX spec (steps → hazards → controls → review)","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T07:58:03.297058563+01:00","updated_at":"2025-12-21T08:12:28.571634011+01:00","closed_at":"2025-12-21T08:12:28.571635724+01:00","comments":[{"id":34,"issue_id":"SafetySecretary-e00","author":"oliver","text":"Goal: document the staged JHA authoring flow so implementation is consistent and user-driven. The flow should mimic the HIRA phase navigation: users define steps, then add hazards per step, then controls per hazard, then review/edit the combined JHA table.\\n\\nReasoning: users want a guided experience that reveals structure gradually, not an auto-generated document. This reduces cognitive load and matches how JHAs are performed in the field.\\n\\nDeliverables: a short UX blueprint outlining stage order, required fields, navigation rules, and how to handle incomplete steps. Include copy guidance for EN/FR/DE.","created_at":"2025-12-21T06:58:13Z"},{"id":49,"issue_id":"SafetySecretary-e00","author":"oliver","text":"Revision: spec should clarify that LLM assistance is optional and never auto-finalizes. Include guidance on stage persistence (resume last stage), validation rules per stage, and UX for incomplete steps/hazards.","created_at":"2025-12-21T07:06:50Z"}]}
{"id":"SafetySecretary-e1c","title":"UI i18n updates for demo login + incident assistant + JHA flow","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T08:00:00.92429944+01:00","updated_at":"2025-12-21T09:16:57.18457218+01:00","closed_at":"2025-12-21T09:16:57.184573906+01:00","dependencies":[{"issue_id":"SafetySecretary-e1c","depends_on_id":"SafetySecretary-dpp","type":"blocks","created_at":"2025-12-21T08:00:19.282438082+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-e1c","depends_on_id":"SafetySecretary-v9t","type":"blocks","created_at":"2025-12-21T08:00:27.067014205+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-e1c","depends_on_id":"SafetySecretary-chk","type":"blocks","created_at":"2025-12-21T08:00:34.709964456+01:00","created_by":"oliver"}],"comments":[{"id":39,"issue_id":"SafetySecretary-e1c","author":"oliver","text":"Goal: ensure all new user-facing copy added for demo login, incident assistant, and JHA staged flow is localized (EN/FR/DE).\\n\\nReasoning: language switcher is user-facing and must stay consistent with new flows.\\n\\nConsiderations: keep backend strings in English; UI copy should be concise and consistent with existing tone.","created_at":"2025-12-21T07:00:10Z"}]}
{"id":"SafetySecretary-e1n","title":"JHA hazards phase LLM scope + step numbering UX","description":"Hazards stage assistant must be phase-scoped: it only adds/amends hazards and never touches steps/controls. Show step numbering in the hazards UI (table and step picker) so users can reference 'Step 1/2/3' in the assistant input. The assistant should parse step-number references to attach hazards to the right step and never auto-fill hazards unless the user submits input.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T22:19:05.90854919+01:00","updated_at":"2025-12-21T22:23:32.784104361+01:00"}
{"id":"SafetySecretary-edg","title":"Action management parity across views","description":"Background:\n- Actions are split across Action Plan and Workspace views with different editing capabilities.\n- Action Plan shows description read-only; Workspace lacks due/status editing and delete.\n\nGoal:\n- Make action editing consistent and complete in at least one primary view.\n- Reduce confusion and make action maintenance fast and predictable.\n\nScope:\n- Editing description/owner/due/status, delete, reorder, add actions.\n- RaContext and API support for these edits.\n\nAcceptance (epic-level):\n- Users can fully manage actions in a single consistent pattern.\n- No essential field is locked in one view and editable in another.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-20T21:48:04.905503504+01:00","updated_at":"2025-12-21T03:37:02.398210827+01:00","closed_at":"2025-12-21T03:37:02.398212608+01:00"}
{"id":"SafetySecretary-edg.1","title":"Define canonical action editing behavior","description":"Background:\n- Action fields are editable in different ways in different places.\n\nGoal:\n- Define a canonical action editing pattern (fields, autosave vs explicit, delete/reorder behavior).\n\nDeliverable:\n- A short spec that names the canonical view and the exact interaction model.\n\nAcceptance:\n- Spec published in repo (doc or issue comment).\n- Clear decisions on edit fields, autosave, delete confirmation/undo, and reorder.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T21:48:16.070765087+01:00","updated_at":"2025-12-20T23:21:56.685318382+01:00","closed_at":"2025-12-20T23:21:56.685320409+01:00","dependencies":[{"issue_id":"SafetySecretary-edg.1","depends_on_id":"SafetySecretary-edg","type":"parent-child","created_at":"2025-12-20T21:48:16.071531944+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-edg.2","title":"RaContext/API support for action delete + field coverage","description":"Background:\n- UI cannot delete actions today; RaContext lacks a delete action.\n\nGoal:\n- Ensure RaContext and API support full CRUD for actions as per the canonical spec.\n\nScope:\n- Add delete action API usage if missing.\n- Confirm update supports status/owner/due/description across views.\n\nAcceptance:\n- RaContext exposes add/update/delete/reorder actions.\n- UI can call delete with proper confirmation and error handling.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T21:48:27.02399179+01:00","updated_at":"2025-12-21T00:04:57.888304614+01:00","closed_at":"2025-12-21T00:04:57.888306287+01:00","dependencies":[{"issue_id":"SafetySecretary-edg.2","depends_on_id":"SafetySecretary-edg","type":"parent-child","created_at":"2025-12-20T21:48:27.024798209+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-edg.2","depends_on_id":"SafetySecretary-edg.1","type":"blocks","created_at":"2025-12-20T21:48:57.995293776+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-edg.3","title":"Action Plan view: full CRUD + reorder UX","description":"Background:\n- Action Plan view shows action description read-only and has no delete.\n\nGoal:\n- Enable full CRUD in the Action Plan view using the canonical editing pattern.\n\nScope:\n- Inline editing of description, owner, due date, status.\n- Delete with confirm/undo (per spec).\n- Reorder remains consistent with other views.\n\nAcceptance:\n- All action fields are editable in Action Plan.\n- Delete is available and safe.\n- Save/error feedback is consistent with the global pattern.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T21:48:37.988115369+01:00","updated_at":"2025-12-21T00:21:08.096935109+01:00","closed_at":"2025-12-21T00:21:08.09693682+01:00","dependencies":[{"issue_id":"SafetySecretary-edg.3","depends_on_id":"SafetySecretary-edg","type":"parent-child","created_at":"2025-12-20T21:48:37.988892408+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-edg.3","depends_on_id":"SafetySecretary-edg.1","type":"blocks","created_at":"2025-12-20T21:49:06.140450303+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-edg.3","depends_on_id":"SafetySecretary-edg.2","type":"blocks","created_at":"2025-12-20T21:49:14.687021819+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-edg.4","title":"Workspace table: action editor parity","description":"Background:\n- Workspace table lacks due/status edits and delete for actions.\n\nGoal:\n- Bring Workspace action editing to parity with the canonical pattern.\n\nScope:\n- Edit description, owner, due date, status.\n- Delete with confirmation/undo.\n- Keep add-action flow consistent with the Action Plan view.\n\nAcceptance:\n- Workspace supports full action editing with clear feedback.\n- No action fields are locked only in one view.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T21:48:47.730041503+01:00","updated_at":"2025-12-21T00:47:20.483148354+01:00","closed_at":"2025-12-21T00:47:20.483150067+01:00","dependencies":[{"issue_id":"SafetySecretary-edg.4","depends_on_id":"SafetySecretary-edg","type":"parent-child","created_at":"2025-12-20T21:48:47.730708088+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-edg.4","depends_on_id":"SafetySecretary-edg.1","type":"blocks","created_at":"2025-12-20T21:49:23.18758712+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-edg.4","depends_on_id":"SafetySecretary-edg.2","type":"blocks","created_at":"2025-12-20T21:49:30.971067871+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-edg.5","title":"Action Plan: show hazards without actions + inline add","description":"Background:\n- Action Plan currently hides hazards with zero actions and shows only a global add form, which obscures coverage gaps.\n\nGoal:\n- Make the Action Plan view reveal hazards with no actions and support quick, in-context add.\n\nScope:\n- Show empty hazards within step groups.\n- Provide inline \"Add action\" row per hazard (or equivalent shortcut) aligned with canonical editing behavior.\n\nAcceptance:\n- Users can see which hazards have no actions without switching views.\n- Adding an action from the hazard context requires minimal clicks and preserves hazard context.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T21:55:58.195202384+01:00","updated_at":"2025-12-21T01:28:20.054341779+01:00","closed_at":"2025-12-21T01:28:20.054347717+01:00","dependencies":[{"issue_id":"SafetySecretary-edg.5","depends_on_id":"SafetySecretary-edg","type":"parent-child","created_at":"2025-12-20T21:55:58.195891028+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-edg.5","depends_on_id":"SafetySecretary-edg.3","type":"blocks","created_at":"2025-12-20T21:56:06.408041614+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-eea","title":"Solution Design","description":"Require explicit CORS configuration in production:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.675085421+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-fv5","title":"Problem","description":"Some forms support Enter-to-submit, others don't.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.703895719+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-fxw","title":"Solution Design","description":"```typescript","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.699062494+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-gf5","title":"Files to Modify","description":"- `src/lib/validation.ts` (NEW)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.683374337+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-guf","title":"Business Impact","description":"Without these fixes:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.656832633+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-gyr","title":"Solution Design","description":"Add proper error handling:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.677447098+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-h76","title":"Fix","description":"Add `t` to dependency array:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.700968159+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-h7i","title":"Problem Statement","description":"**File:** `frontend/src/components/IncidentEditor.tsx`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.696690047+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-h7m","title":"JHA assistant patch protocol + merge engine","description":"Define a structured LLM response format for JHA updates (steps/hazards/controls) that supports add/insert/update/move without full replacement. Implement phase-specific job types/endpoints that apply patches non-destructively, preserve IDs/user edits, and reject ambiguous instructions with clear errors.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T22:24:56.060818234+01:00","updated_at":"2025-12-21T22:24:56.060818234+01:00"}
{"id":"SafetySecretary-hjy","title":"Problem Statement","description":"**File:** `src/routes/authRouter.ts`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.671093157+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-ho0","title":"Testing","description":"1. Mount component, trigger action with timeout, unmount before timeout fires","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.670063389+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-hp8","title":"Workflow save semantics + data integrity","description":"Background:\n- The workflow currently mixes draft-only editing (steps) with autosave (hazards/ratings), and the top-bar \"Save\" only refreshes.\n- This creates silent data-loss risk and breaks user trust in what is actually persisted.\n\nGoal:\n- Establish a single, explicit persistence policy and enforce it across phases.\n- Ensure users never lose edits when navigating or advancing phases.\n\nScope:\n- Steps, hazards, ratings, controls, actions.\n- Navigation/phase advance, view switching, and the top-bar Save/Refresh affordance.\n\nOut of scope:\n- Large UI re-skinning or new editor components.\n\nWhy this matters:\n- The product promise is \"premium and reliable\"; data loss and ambiguous save states undermine that.\n- Consistent persistence rules reduce cognitive load and support faster, keyboard-first work.\n\nAcceptance (epic-level):\n- Unified persistence policy defined and applied in the product.\n- No edits are lost when moving between phases or views.\n- Save/Refresh affordances match actual behavior.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-20T21:44:19.751012872+01:00","updated_at":"2025-12-21T03:36:12.890063542+01:00","closed_at":"2025-12-21T03:36:12.890069726+01:00"}
{"id":"SafetySecretary-hp8.1","title":"Define unified persistence + dirty-state policy","description":"Background:\n- Steps are edited as drafts with a manual Save; other entities autosave on blur/change.\n- Users can advance phases or switch views without saving steps, losing edits.\n- The top-bar \"Save\" button performs a refresh, not a save.\n\nDecision points:\n- Autosave vs explicit Save/Cancel for steps (and any other remaining drafts).\n- Dirty state signals (global + per-row) and what counts as \"dirty\".\n- Navigation guards: when to block, warn, or allow discard.\n- How \"Save\" in the top bar should behave and be labeled.\n\nDeliverable:\n- A short written policy (1-2 pages) that maps each entity and phase to the chosen interaction model.\n- A checklist for UI updates to enforce the policy.\n\nConsiderations:\n- Align with docs/ui_interaction_model.md unless there is a deliberate reason to diverge.\n- Prefer consistency over per-view customization.\n\nAcceptance:\n- Policy written and shared in repo (doc or issue comment).\n- Clear decisions for steps, hazards, actions, ratings, controls, and navigation.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T21:45:14.058966845+01:00","updated_at":"2025-12-20T23:21:01.052130319+01:00","closed_at":"2025-12-20T23:21:01.052133105+01:00","dependencies":[{"issue_id":"SafetySecretary-hp8.1","depends_on_id":"SafetySecretary-hp8","type":"parent-child","created_at":"2025-12-20T21:45:14.062020264+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-hp8.2","title":"Process steps persistence + navigation guard","description":"Background:\n- PhaseProcessSteps stores edits only in local state until \"Save steps\".\n- \"Continue\" does not persist, and view switching can drop edits.\n\nGoal:\n- Make step edits durable per the policy (autosave or explicit Save with guard).\n- Prevent silent loss when advancing or changing views.\n\nScope:\n- PhaseProcessSteps editing, reorder, and add/remove actions.\n- Step persistence endpoint usage and error handling.\n- Navigation guard behavior in this phase.\n\nAcceptance:\n- Step edits are persisted according to policy.\n- Reordering is persisted or clearly indicated as unsaved.\n- Users are warned or blocked from losing unsaved edits.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T21:45:19.169600683+01:00","updated_at":"2025-12-20T23:36:53.885072558+01:00","closed_at":"2025-12-20T23:36:53.885074792+01:00","dependencies":[{"issue_id":"SafetySecretary-hp8.2","depends_on_id":"SafetySecretary-hp8","type":"parent-child","created_at":"2025-12-20T21:45:19.170294851+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-hp8.2","depends_on_id":"SafetySecretary-hp8.1","type":"blocks","created_at":"2025-12-20T21:46:50.35836068+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-hp8.2.1","title":"Steps: dirty tracking + navigation guard","description":"Background:\n- Steps are draft-only; no dirty-state indicator exists.\n\nGoal:\n- Add explicit dirty tracking for steps so the user sees unsaved edits.\n- Ensure navigation/phase change behavior matches the unified policy.\n\nImplementation notes:\n- Track dirty state at row and phase level.\n- Use confirm dialog or inline banner before leaving with unsaved changes.\n\nAcceptance:\n- Dirty indicator visible when step edits are pending.\n- Navigation/phase advance follows the policy (warn/block/auto-save).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T21:45:24.271105391+01:00","updated_at":"2025-12-20T23:36:28.002591296+01:00","closed_at":"2025-12-20T23:36:28.002593406+01:00","dependencies":[{"issue_id":"SafetySecretary-hp8.2.1","depends_on_id":"SafetySecretary-hp8.2","type":"parent-child","created_at":"2025-12-20T21:45:24.271929153+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-hp8.2.2","title":"Steps: persist edits + reorder","description":"Background:\n- Step edits are not persisted until manual Save.\n\nGoal:\n- Persist step edits and reorders per policy.\n\nImplementation notes:\n- Autosave: persist on blur/debounce and on reorder.\n- Explicit save: retain draft but ensure Save is required and visible.\n\nAcceptance:\n- Step create/edit/reorder persists per policy.\n- Errors surface to the user with a retry path.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T21:46:16.360880622+01:00","updated_at":"2025-12-20T23:36:45.620581637+01:00","closed_at":"2025-12-20T23:36:45.620583283+01:00","dependencies":[{"issue_id":"SafetySecretary-hp8.2.2","depends_on_id":"SafetySecretary-hp8.2","type":"parent-child","created_at":"2025-12-20T21:46:16.362911558+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-hp8.3","title":"Top-bar Save semantics (refresh vs save-all)","description":"Background:\n- The top-bar \"Save\" button only calls refresh (GET), which is misleading.\n\nGoal:\n- Align label and behavior with the unified policy.\n\nOptions:\n- Rename to \"Refresh\" if autosave is the standard.\n- Or implement a true \"Save all drafts\" action if drafts remain.\n\nAcceptance:\n- Button label and behavior are consistent and unambiguous.\n- If any drafts exist, button reliably persists them.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T21:46:27.253958804+01:00","updated_at":"2025-12-21T00:04:40.474993191+01:00","closed_at":"2025-12-21T00:04:40.474995553+01:00","dependencies":[{"issue_id":"SafetySecretary-hp8.3","depends_on_id":"SafetySecretary-hp8","type":"parent-child","created_at":"2025-12-20T21:46:27.254634632+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-hp8.3","depends_on_id":"SafetySecretary-hp8.1","type":"blocks","created_at":"2025-12-20T21:47:43.314225037+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-hp8.4","title":"Unified save/error feedback pattern","description":"Background:\n- Autosave status messaging is inconsistent across phases and sometimes missing error handling.\n- Some flows show \"Saving...\" even when no request is sent, and failures can be silent.\n\nGoal:\n- Provide a shared save/error indicator pattern and apply it consistently.\n\nScope:\n- Autosave/edit flows in PhaseHazardNarrative, PhaseRiskRating, PhaseControls, PhaseControlsActions, and WorkspaceTableView.\n- Status messaging (Saving/Saved/Error), retry affordances, and cancel/undo copy.\n\nAcceptance:\n- All autosave paths surface errors and never show \"Saved\" without a real request.\n- Status messaging is consistent across phases/views and uses shared UI pattern.\n- Users have a clear recovery path (retry/undo) on failure.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T21:46:38.472542418+01:00","updated_at":"2025-12-21T03:36:03.737449826+01:00","closed_at":"2025-12-21T03:36:03.737451487+01:00","dependencies":[{"issue_id":"SafetySecretary-hp8.4","depends_on_id":"SafetySecretary-hp8","type":"parent-child","created_at":"2025-12-20T21:46:38.47423729+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-hp8.4","depends_on_id":"SafetySecretary-hp8.1","type":"blocks","created_at":"2025-12-20T21:47:52.434461035+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-hsc","title":"Exports polish toward 'good looks like' template","description":"Improve PDF/XLSX outputs to match the structure/clarity of HIRA Template SWP.xlsm (not exact ranges/macros).","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-12T00:03:49.433636781+01:00","updated_at":"2025-12-18T21:20:37.489178772+01:00","closed_at":"2025-12-18T21:20:37.489180549+01:00"}
{"id":"SafetySecretary-hsc.1","title":"Dissect HIRA template and map to data","description":"Review HIRA Template SWP.xlsm to lock target column/section structure and any missing fields.","notes":"Template column mapping extracted from user text (simplify Swissport/Airline wording, keep structure):\\n- Step: N°, Activity description (incl equipment/tools/materials/substances).\\n- Hazard ID: hazard code/category, hazard type/label, hazard description, potential consequences, person(s) at risk.\\n- Existing requirements \u0026 controls: mandatory H\u0026S requirements; other recommended preventive/control measures.\\n- Effectiveness (separate column): how effectively existing measures are implemented locally + frequent contributing factors.\\n- Baseline risk evaluation: likelihood, severity, risk level.\\n- Mitigation: action headlines / recommendations to mitigate (details live in Action Plan).\\n- Residual risk: likelihood, severity, risk level.\\n- Monitoring: measures to monitor/review residual risk + responsibility.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T00:05:11.247268008+01:00","updated_at":"2025-12-18T20:55:44.03160381+01:00","closed_at":"2025-12-18T20:55:44.031605342+01:00","dependencies":[{"issue_id":"SafetySecretary-hsc.1","depends_on_id":"SafetySecretary-hsc","type":"parent-child","created_at":"2025-12-12T00:05:11.247976855+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-hsc.2","title":"Improve XLSX/PDF outputs to match target structure","description":"Add missing columns/formatting, include photos when present, add UI Excel export button.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:05:14.638147711+01:00","updated_at":"2025-12-18T21:15:30.643909781+01:00","closed_at":"2025-12-18T21:15:30.643912336+01:00","dependencies":[{"issue_id":"SafetySecretary-hsc.2","depends_on_id":"SafetySecretary-hsc","type":"parent-child","created_at":"2025-12-12T00:05:14.638840595+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-hw3","title":"Solution Design","description":"Create proper type definitions for:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.684815562+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-i43","title":"Solution","description":"Create shared `useFormSubmit` hook that handles keyboard events consistently.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.704369368+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-i5n","title":"Memory Impact Analysis","description":"Each PrismaClient maintains:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.664494036+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-js4","title":"Acceptance Criteria","description":"- [ ] All critical issues resolved and verified","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.656313893+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-kdi","title":"Why These Limits","description":"| Endpoint | Limit | Rationale |","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.672688233+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-kel","title":"Solution Design","description":"Create a new middleware file `src/middleware/globalErrorHandler.ts` that:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.658849871+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-kxp","title":"Localization: EN/FR/DE + per-user language","description":"Background:\n- SafetySecretary will be used in Switzerland where English, French, and German are required.\n- Users need a language selector in Settings; language is per-user.\n- Exports (PDF/XLSX) must be localized to match the UI.\n- Backend error messages stay English (user-facing UI handles localization).\n\nGoal:\n- Deliver a localization framework that supports EN/FR/DE now and allows Italian later.\n- Ensure a coherent, professional UX across UI and exports.\n\nScope:\n- UI translation of all user-facing strings.\n- Settings-based language switcher, persisted per user.\n- Localized PDF/XLSX exports.\n- Locale-aware formatting (dates/times, numbers).\n\nOut of scope:\n- Backend error localization.\n- Full LLM output localization (decision pending).\n\nAcceptance (epic-level):\n- Users can switch language and see UI update consistently.\n- Exports render in the selected language.\n- Fallback to English is robust for missing keys.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-20T22:52:23.31941078+01:00","updated_at":"2025-12-21T03:34:48.66647214+01:00","closed_at":"2025-12-21T03:34:48.666474174+01:00"}
{"id":"SafetySecretary-kxp.1","title":"I18n approach decision (library, key conventions, fallback rules)","description":"Background:\n- We need a consistent i18n approach that scales from EN/FR/DE to future languages (IT).\n\nDecision points:\n- Library choice (e.g., react-i18next) and server-side access for exports.\n- Translation file format + key naming conventions.\n- Fallback behavior for missing keys.\n\nConsiderations:\n- Keep translations close to code but shareable with backend export layer.\n- Minimize overhead for contributors adding strings.\n\nAcceptance:\n- i18n approach documented and agreed.\n- Key conventions and fallback rules written down.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:52:35.114176409+01:00","updated_at":"2025-12-21T03:32:41.787334631+01:00","closed_at":"2025-12-21T03:32:41.787336428+01:00","dependencies":[{"issue_id":"SafetySecretary-kxp.1","depends_on_id":"SafetySecretary-kxp","type":"parent-child","created_at":"2025-12-20T22:52:35.114875974+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-kxp.10","title":"Translation workflow + QA","description":"Background:\n- Translation maintenance needs a low-friction workflow and coverage checks.\n\nScope:\n- Add missing-key logging in dev.\n- Define translation update process (how to add keys, how to request translations).\n- Create a basic QA checklist for EN/FR/DE.\n\nAcceptance:\n- Contributors have a clear process for adding/updating translations.\n- QA checklist exists for language review.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T22:54:08.392366916+01:00","updated_at":"2025-12-21T03:34:20.809012391+01:00","closed_at":"2025-12-21T03:34:20.809014112+01:00","dependencies":[{"issue_id":"SafetySecretary-kxp.10","depends_on_id":"SafetySecretary-kxp","type":"parent-child","created_at":"2025-12-20T22:54:08.393064773+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.10","depends_on_id":"SafetySecretary-kxp.1","type":"blocks","created_at":"2025-12-20T22:56:04.39916128+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.10","depends_on_id":"SafetySecretary-kxp.2","type":"blocks","created_at":"2025-12-20T22:58:51.877975763+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-kxp.11","title":"Backend: persist per-user locale in registry","description":"Background:\n- Language preference is per-user and must persist across sessions and devices.\n\nScope:\n- Add locale field to registry user profile (or user settings table).\n- Add API to read/update the user locale (used by settings UI).\n- Include locale in session or user bootstrap response for exports.\n\nConsiderations:\n- Depends on registry DB schema and auth session plumbing.\n\nAcceptance:\n- User locale is stored in registry DB and can be updated via API.\n- User bootstrap includes locale so UI can initialize correctly.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:56:56.787308454+01:00","updated_at":"2025-12-21T03:34:29.80659889+01:00","closed_at":"2025-12-21T03:34:29.80660394+01:00","dependencies":[{"issue_id":"SafetySecretary-kxp.11","depends_on_id":"SafetySecretary-kxp","type":"parent-child","created_at":"2025-12-20T22:56:56.788015744+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.11","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:57:52.47460889+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.11","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:57:57.582244804+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-kxp.12","title":"Localize domain dictionaries (phases, risk scales, categories)","description":"Background:\n- Many user-facing labels live in shared dictionaries (phases, risk scales, hazard categories).\n- If these remain hardcoded, the UI will feel partially translated.\n\nScope:\n- Move labels for phases, severity/likelihood options, risk band labels, hazard category labels into translation keys.\n- Ensure both UI and exports reference the same translated labels.\n\nAcceptance:\n- Domain dictionaries pull labels from i18n translations.\n- No mixed-language labels remain.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:57:29.990031089+01:00","updated_at":"2025-12-21T03:34:39.125591377+01:00","closed_at":"2025-12-21T03:34:39.1255931+01:00","dependencies":[{"issue_id":"SafetySecretary-kxp.12","depends_on_id":"SafetySecretary-kxp","type":"parent-child","created_at":"2025-12-20T22:57:29.99081384+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.12","depends_on_id":"SafetySecretary-kxp.3","type":"blocks","created_at":"2025-12-20T22:58:24.226321671+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.12","depends_on_id":"SafetySecretary-kxp.2","type":"blocks","created_at":"2025-12-20T22:58:33.590038824+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.12","depends_on_id":"SafetySecretary-kxp.1","type":"blocks","created_at":"2025-12-20T22:59:00.699864804+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-kxp.2","title":"Translation inventory + key map","description":"Background:\n- We need to migrate UI strings consistently, so we need a map of what must be translated.\n\nScope:\n- Identify all user-facing strings: login, landing, workspace top bar, phase headers, actions, menus, empty states, error banners.\n- Draft a key map that groups strings by feature.\n\nAcceptance:\n- Inventory list and key map documented.\n- Includes export labels to keep UI + export terminology aligned.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:52:45.394402546+01:00","updated_at":"2025-12-21T03:32:58.382812541+01:00","closed_at":"2025-12-21T03:32:58.382814732+01:00","dependencies":[{"issue_id":"SafetySecretary-kxp.2","depends_on_id":"SafetySecretary-kxp","type":"parent-child","created_at":"2025-12-20T22:52:45.395100442+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.2","depends_on_id":"SafetySecretary-kxp.1","type":"blocks","created_at":"2025-12-20T22:54:19.305096788+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-kxp.3","title":"Frontend i18n scaffolding","description":"Background:\n- The app currently has no localization framework.\n\nScope:\n- Add i18n provider and translation loader.\n- Add language switcher plumbing and locale state management.\n- Implement fallback to English.\n\nAcceptance:\n- App can switch languages without reload.\n- Missing keys fall back to English.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:52:55.462899577+01:00","updated_at":"2025-12-21T03:33:15.47932555+01:00","closed_at":"2025-12-21T03:33:15.479327437+01:00","dependencies":[{"issue_id":"SafetySecretary-kxp.3","depends_on_id":"SafetySecretary-kxp","type":"parent-child","created_at":"2025-12-20T22:52:55.46509668+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.3","depends_on_id":"SafetySecretary-kxp.1","type":"blocks","created_at":"2025-12-20T22:54:33.410626316+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-kxp.4","title":"Frontend: settings language selector (per-user)","description":"Background:\n- Users need a simple language selector in Settings, persisted per user.\n\nScope:\n- Add language selector UI in user menu/settings.\n- Persist language preference via backend user profile (registry DB).\n- Temporary localStorage fallback only before auth is live or if offline.\n\nAcceptance:\n- Users can change language in Settings.\n- Preference persists across sessions and devices.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:53:05.281098801+01:00","updated_at":"2025-12-21T03:33:24.897239695+01:00","closed_at":"2025-12-21T03:33:24.897245412+01:00","dependencies":[{"issue_id":"SafetySecretary-kxp.4","depends_on_id":"SafetySecretary-kxp","type":"parent-child","created_at":"2025-12-20T22:53:05.281779491+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.4","depends_on_id":"SafetySecretary-kxp.3","type":"blocks","created_at":"2025-12-20T22:54:42.418250361+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.4","depends_on_id":"SafetySecretary-kxp.11","type":"blocks","created_at":"2025-12-20T22:58:02.689406884+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-kxp.5","title":"Frontend string migration: core screens","description":"Background:\n- Core flows must be localized first to deliver value to testers.\n\nScope:\n- Migrate login, landing, workspace top bar, phase headers, action plan, common empty/error states.\n- Ensure translations for EN/FR/DE.\n\nAcceptance:\n- Core screens fully translated.\n- No hardcoded strings remain in those areas.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:53:15.207653539+01:00","updated_at":"2025-12-21T03:33:34.524972798+01:00","closed_at":"2025-12-21T03:33:34.524975655+01:00","dependencies":[{"issue_id":"SafetySecretary-kxp.5","depends_on_id":"SafetySecretary-kxp","type":"parent-child","created_at":"2025-12-20T22:53:15.208339846+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.5","depends_on_id":"SafetySecretary-kxp.3","type":"blocks","created_at":"2025-12-20T22:54:51.957798359+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-kxp.6","title":"Frontend string migration: remaining screens","description":"Background:\n- Secondary screens still contain user-facing strings.\n\nScope:\n- Migrate remaining components (risk matrix, TUI view, admin UI, settings stubs, tooltips).\n- Cover all remaining empty/error states.\n\nAcceptance:\n- No user-facing strings remain hardcoded.\n- Coverage verified via string inventory.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T22:53:24.714403695+01:00","updated_at":"2025-12-21T03:33:43.842344927+01:00","closed_at":"2025-12-21T03:33:43.842346946+01:00","dependencies":[{"issue_id":"SafetySecretary-kxp.6","depends_on_id":"SafetySecretary-kxp","type":"parent-child","created_at":"2025-12-20T22:53:24.715879797+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.6","depends_on_id":"SafetySecretary-kxp.3","type":"blocks","created_at":"2025-12-20T22:55:02.779326443+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.6","depends_on_id":"SafetySecretary-kxp.5","type":"blocks","created_at":"2025-12-20T22:58:42.813018813+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-kxp.7","title":"Locale-aware formatting (dates, numbers)","description":"Background:\n- Dates and numbers should match the user’s locale for clarity and trust.\n\nScope:\n- Use Intl.DateTimeFormat and Intl.NumberFormat with the active locale.\n- Apply to case lists, timestamps, and export metadata.\n\nAcceptance:\n- Dates/times are formatted per locale.\n- No manual formatting remains for user-facing dates.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:53:34.408616517+01:00","updated_at":"2025-12-21T03:33:53.368048758+01:00","closed_at":"2025-12-21T03:33:53.368050418+01:00","dependencies":[{"issue_id":"SafetySecretary-kxp.7","depends_on_id":"SafetySecretary-kxp","type":"parent-child","created_at":"2025-12-20T22:53:34.409392678+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.7","depends_on_id":"SafetySecretary-kxp.1","type":"blocks","created_at":"2025-12-20T22:55:11.86138993+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.7","depends_on_id":"SafetySecretary-kxp.2","type":"blocks","created_at":"2025-12-20T22:55:21.799284364+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-kxp.8","title":"Backend exports: localized labels (PDF/XLSX)","description":"Background:\n- Exports must match the UI language for user confidence and downstream sharing.\n\nScope:\n- Load translation dictionaries server-side.\n- Localize PDF headings, table headers, and risk matrix labels.\n- Localize XLSX sheet names and column headers.\n\nConsiderations:\n- Keep terminology aligned with UI keys to avoid drift.\n- Use English fallback if a key is missing.\n\nAcceptance:\n- Export labels follow user-selected language.\n- Fallback to English works for missing keys.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:53:46.432846777+01:00","updated_at":"2025-12-21T03:34:02.683478116+01:00","closed_at":"2025-12-21T03:34:02.6834801+01:00","dependencies":[{"issue_id":"SafetySecretary-kxp.8","depends_on_id":"SafetySecretary-kxp","type":"parent-child","created_at":"2025-12-20T22:53:46.433537646+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.8","depends_on_id":"SafetySecretary-kxp.4","type":"blocks","created_at":"2025-12-20T22:55:30.483822099+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.8","depends_on_id":"SafetySecretary-kxp.7","type":"blocks","created_at":"2025-12-20T22:55:43.53927372+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-kxp.9","title":"Backend: pass user locale to export endpoints","description":"Background:\n- Export services need to know which locale to use.\n\nScope:\n- Use locale from user profile/session for exports.\n- Allow an explicit locale param for admin/testing overrides.\n\nAcceptance:\n- Export endpoints render in the user-selected language by default.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:53:58.018424239+01:00","updated_at":"2025-12-21T03:34:11.752973663+01:00","closed_at":"2025-12-21T03:34:11.752975642+01:00","dependencies":[{"issue_id":"SafetySecretary-kxp.9","depends_on_id":"SafetySecretary-kxp","type":"parent-child","created_at":"2025-12-20T22:53:58.019074385+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.9","depends_on_id":"SafetySecretary-kxp.7","type":"blocks","created_at":"2025-12-20T22:55:55.579835667+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-kxp.9","depends_on_id":"SafetySecretary-kxp.11","type":"blocks","created_at":"2025-12-20T22:58:15.937455718+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-l7j","title":"Problem Statement","description":"**File:** `src/app.ts:91`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.657832254+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-m11","title":"Premium UX/UI overhaul (Stripe-level polish)","description":"Background\n- UX audit shows inconsistent visual system and workflow friction across HIRA/JHA/Incident/Admin.\n- Several components rely on Tailwind-like utility classes, but no utility framework is installed, so layout/typography often render as browser defaults.\n- Users are forced to load cases by opaque IDs and confirm critical actions via system dialogs, which feels non-premium and undermines trust.\n\nGoals\n- Deliver a cohesive, Stripe-level UI with a single design language, clear hierarchy, and confident feedback loops.\n- Remove workflow friction (load-by-ID prompts, inconsistent nav, unclear saving/export feedback).\n- Increase trust in automation (LLM changes, export status, save status) with previews and reversibility.\n- Improve accessibility and keyboard usability without sacrificing aesthetics.\n\nNon-goals\n- Feature expansion or new domain flows. This is a UX/UI and IA cleanup, not a new product scope.\n\nSuccess criteria\n- A single styling system is enforced and all major screens render as designed.\n- Navigation, headers, and primary actions are consistent across HIRA/JHA/Incident/Admin.\n- Users can discover and open work without copy/pasting IDs.\n- No window.confirm/prompt usage in UX-critical flows.\n- Clear, branded feedback for saving, exports, LLM actions, and error states.\n- Focus/keyboard and contrast meet baseline accessibility expectations.\n\nPrimary hotspots (current)\n- Utility-class usage without a utility framework (ex: frontend/src/components/phases/PhaseProcessSteps.tsx, frontend/src/components/common/AssistantPanel.tsx).\n- Load-by-ID prompts (frontend/src/components/RaEditor.tsx, landing pages).\n- System dialogs (frontend/src/pages/AdminPortal.tsx, frontend/src/components/common/StepPhotosPanel.tsx).\n\nApproach\n- Break into tracks: foundation (styles/tokens), navigation/IA, forms/data-entry, feedback/trust, visual polish/accessibility.\n- Each track has focused, testable tasks; dependencies ensure design-system work lands first.\n","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-21T21:39:37.374406927+01:00","updated_at":"2025-12-21T21:39:37.374406927+01:00","comments":[{"id":59,"issue_id":"SafetySecretary-m11","author":"oliver","text":"Audit context\n- Utility classes present without Tailwind/UnoCSS → spacing/typography silently broken, hurting trust.\n- Load-by-ID prompts and window.confirm/prompt create friction and low-end feel.\n- Top bars are overcrowded; inconsistent nav patterns across HIRA/JHA/Incident/Admin.\n- Feedback loops for save/export/LLM are weak, reducing confidence in automation.\n- Focus and a11y states are under-defined.\n\nThis epic scopes remediation into five tracks with dependencies so foundation work lands before screen-level polish.\n","created_at":"2025-12-21T20:50:30Z"}]}
{"id":"SafetySecretary-m11.1","title":"Foundation: styling system + design tokens","description":"Background\n- Many components use Tailwind-like utility classes (e.g., text-slate-900, rounded-lg), but Tailwind/UnoCSS is not installed, so UI degrades to default browser styling.\n- The current CSS variables are basic; typography, spacing, and motion feel generic.\n\nGoals\n- Resolve the styling system mismatch and establish a single, enforceable design system.\n- Define tokens for color, typography, spacing, radii, elevation, and motion.\n\nAcceptance\n- A single styling approach is documented and enforced (no mixed utility-class + custom CSS drift).\n- Tokens exist for colors, typography scale, spacing, radii, shadows, and motion.\n- Major pages render with consistent spacing/typography without relying on missing utilities.\n\nNotes\n- This task blocks all other UX polish work; do not proceed until resolved.\n","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:39:55.993234232+01:00","updated_at":"2025-12-21T21:39:55.993234232+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.1","depends_on_id":"SafetySecretary-m11","type":"parent-child","created_at":"2025-12-21T21:39:55.993934334+01:00","created_by":"oliver"}],"comments":[{"id":60,"issue_id":"SafetySecretary-m11.1","author":"oliver","text":"Implementation note\n- The fastest path is to resolve the utility mismatch first, then refactor styles iteratively.\n- If Tailwind is adopted, confirm design tokens are centralized (e.g., tailwind.config theme tokens) to avoid drift with CSS vars.\n- If migrating away from utilities, map common utility patterns to new semantic classes so developers don’t reintroduce ad-hoc styling.\n","created_at":"2025-12-21T20:50:45Z"},{"id":68,"issue_id":"SafetySecretary-m11.1","author":"oliver","text":"Update\n- Decision finalized: explicit CSS only. No utility framework will be introduced.\n- Any earlier references to Tailwind/UnoCSS are superseded by this decision.\n","created_at":"2025-12-21T21:06:32Z"}]}
{"id":"SafetySecretary-m11.1.1","title":"Resolve utility-class mismatch (install framework or migrate)","description":"Background\n- Components currently use Tailwind-like utility classes without a utility framework, causing missing spacing/typography and inconsistent visuals.\n\nGoals\n- Migrate all utility-style class usage to explicit, semantic CSS classes.\n- Keep styling simple and centralized (no build-time utility framework).\n\nApproach\n- Inventory utility-style classes in core screens and map them to semantic classnames.\n- Implement styles in frontend/src/index.css (or scoped CSS modules where needed).\n\nAcceptance\n- No unresolved utility-style classnames remain in core UI components.\n- A minimal set of semantic classes covers layout, spacing, and typography needs.\n- Core screens render consistently without relying on any external utility framework.\n\nFiles of concern\n- frontend/src/components/phases/PhaseProcessSteps.tsx\n- frontend/src/components/common/AssistantPanel.tsx\n- frontend/src/components/common/StepPhotosPanel.tsx\n- frontend/src/components/ui/SheetTable.tsx\n","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-21T21:40:14.670078154+01:00","updated_at":"2025-12-21T22:14:11.478373335+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.1.1","depends_on_id":"SafetySecretary-m11.1","type":"parent-child","created_at":"2025-12-21T21:40:14.670858245+01:00","created_by":"oliver"}],"comments":[{"id":65,"issue_id":"SafetySecretary-m11.1.1","author":"oliver","text":"Decision\n- Use explicit CSS (no Tailwind/UnoCSS). Migrate utility-like class usage to semantic classnames and update frontend/src/index.css or component-level CSS modules as needed.\n- Keep approach simple: no build-time utility framework.\n","created_at":"2025-12-21T20:59:58Z"}]}
{"id":"SafetySecretary-m11.1.2","title":"Define typography scale + font pairing","description":"Background\n- Current typography uses Inter/system defaults with minimal hierarchy. Premium feel comes from a clear, consistent scale.\n\nGoals\n- Define a simple, single-font typographic scale (display → body → labels).\n- Update tokens/base styles to reflect the scale and weights.\n\nAcceptance\n- A documented scale exists (sizes, weights, line-heights) mapped to CSS variables or classes.\n- Headings, body text, captions, and labels are visually distinct and consistent across screens.\n- Core components reference the scale instead of ad-hoc font sizes.\n\nConsiderations\n- Localization: ensure longer strings (DE/FR) fit comfortably.\n","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:40:31.79028904+01:00","updated_at":"2025-12-21T22:04:53.732502364+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.1.2","depends_on_id":"SafetySecretary-m11.1","type":"parent-child","created_at":"2025-12-21T21:40:31.791045693+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.1.2","depends_on_id":"SafetySecretary-m11.1.1","type":"blocks","created_at":"2025-12-21T21:47:08.095269439+01:00","created_by":"oliver"}],"comments":[{"id":66,"issue_id":"SafetySecretary-m11.1.2","author":"oliver","text":"Decision\n- Typography should stay simple. Use a single primary font with a clean scale; avoid adding a secondary display font.\n- Aim for clarity and consistency over flair; minimal but intentional hierarchy.\n","created_at":"2025-12-21T21:00:13Z"}]}
{"id":"SafetySecretary-m11.1.3","title":"Component state polish: buttons, inputs, focus/hover","description":"Background\n- Button/input styles are generic and inconsistent; focus-visible states are not defined, which hurts keyboard UX and perceived quality.\n\nGoals\n- Create a cohesive set of component states (default/hover/active/focus/disabled) for buttons, inputs, selects, and textareas.\n- Define a standard focus ring and hover motion tied to tokens.\n\nAcceptance\n- Buttons and inputs have consistent states across the app.\n- Focus-visible styling is clear and accessible (contrast \u0026 size).\n- No ad-hoc inline button styles remain in core flows.\n\nNotes\n- Replace system dialogs (confirm/prompt) with branded modal components here or in a later task that depends on these primitives.\n","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:40:47.66566728+01:00","updated_at":"2025-12-21T21:40:47.66566728+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.1.3","depends_on_id":"SafetySecretary-m11.1","type":"parent-child","created_at":"2025-12-21T21:40:47.666433001+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.1.3","depends_on_id":"SafetySecretary-m11.1.2","type":"blocks","created_at":"2025-12-21T21:47:18.231046424+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.1.4","title":"Layout primitives: panels, grids, spacing, elevation","description":"Background\n- Layout conventions are mixed (some rely on utility classes, others on app-panel). This makes spacing and rhythm inconsistent.\n\nGoals\n- Define layout primitives: panel, card, section header, grid, stack, and spacing scale.\n- Align margins/padding to tokens for consistent vertical rhythm.\n\nAcceptance\n- Reusable layout classes/components exist and are used in core screens.\n- Spacing feels consistent across landing pages and editors.\n\nConsiderations\n- Support responsive layouts without brittle breakpoint hacks.\n","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:41:03.193265249+01:00","updated_at":"2025-12-21T21:41:03.193265249+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.1.4","depends_on_id":"SafetySecretary-m11.1","type":"parent-child","created_at":"2025-12-21T21:41:03.194055306+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.1.4","depends_on_id":"SafetySecretary-m11.1.2","type":"blocks","created_at":"2025-12-21T21:47:28.378712721+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.2","title":"Navigation \u0026 information architecture refresh","description":"Background\n- Navigation patterns differ by module (HIRA/JHA/Incidents/Admin). Primary actions are scattered and load-by-ID prompts are common.\n\nGoals\n- Establish a consistent app shell with clear hierarchy and predictable navigation across modules.\n- Replace ID-based workflows with search/recent entry points.\n\nAcceptance\n- HIRA/JHA/Incidents share a common header/navigation pattern.\n- Users can open recent work without copying IDs.\n- Primary actions are visible without overwhelming the top bar.\n","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:41:20.515176121+01:00","updated_at":"2025-12-21T21:41:20.515176121+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.2","depends_on_id":"SafetySecretary-m11","type":"parent-child","created_at":"2025-12-21T21:41:20.516300239+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.2","depends_on_id":"SafetySecretary-m11.1.3","type":"blocks","created_at":"2025-12-21T21:47:38.502865938+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.2","depends_on_id":"SafetySecretary-m11.1.4","type":"blocks","created_at":"2025-12-21T21:47:48.632501793+01:00","created_by":"oliver"}],"comments":[{"id":61,"issue_id":"SafetySecretary-m11.2","author":"oliver","text":"UX rationale\n- Users should discover work via recents/search, not memorize IDs. This alone will make the product feel substantially more polished.\n- Consolidating nav + actions reduces topbar clutter and frees space for primary tasks.\n","created_at":"2025-12-21T20:51:01Z"}]}
{"id":"SafetySecretary-m11.2.1","title":"Unify workspace header \u0026 nav across HIRA/JHA/Incident","description":"Background\n- HIRA has a complex topbar with many actions; JHA uses a simpler header; Incident has its own layout. This inconsistency feels stitched together.\n\nGoals\n- Create a shared header pattern with consistent placement for identity, navigation, actions, and account menu.\n\nAcceptance\n- All three modules use a single shared layout component or consistent markup.\n- Primary navigation (Home/HIRA/JHA/Incidents) is always discoverable.\n- Actions are grouped (view mode, export, account) instead of a long button row.\n","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:41:37.308091327+01:00","updated_at":"2025-12-21T21:41:37.308091327+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.2.1","depends_on_id":"SafetySecretary-m11.2","type":"parent-child","created_at":"2025-12-21T21:41:37.308848028+01:00","created_by":"oliver"}],"comments":[{"id":67,"issue_id":"SafetySecretary-m11.2.1","author":"oliver","text":"Decision\n- Navigation pattern: top bar (no left sidebar). Ensure consistent top-bar layout across HIRA/JHA/Incident/Admin with grouped actions and overflow.\n","created_at":"2025-12-21T21:00:27Z"}]}
{"id":"SafetySecretary-m11.2.2","title":"Replace load-by-ID with search + recent modal","description":"Background\n- Current “Load” flows rely on raw case IDs via prompts. This is high friction and feels developer-centric.\n\nGoals\n- Provide a searchable recent-cases modal (by name/title, location, date) as the primary entry point.\n- Keep an advanced “load by ID” option but de-emphasize it.\n\nAcceptance\n- Users can open recent work without memorizing or pasting IDs.\n- The modal is available on landing pages and inside editors.\n- Canceling the modal preserves context (no jarring resets).\n","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:41:54.240708171+01:00","updated_at":"2025-12-21T22:05:24.038204675+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.2.2","depends_on_id":"SafetySecretary-m11.2","type":"parent-child","created_at":"2025-12-21T21:41:54.241499254+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.2.2","depends_on_id":"SafetySecretary-m11.2.1","type":"blocks","created_at":"2025-12-21T21:47:58.764912075+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.2.3","title":"Rebalance topbar actions + add overflow menu","description":"Background\n- HIRA topbar includes many buttons (view toggles, export, theme, focus, user menu), causing clutter and wrap on smaller screens.\n\nGoals\n- Introduce action grouping (segmented view toggle, export menu, settings).\n- Keep primary actions always visible while secondary actions move into an overflow menu.\n\nAcceptance\n- Topbar maintains a clean hierarchy on small and large screens.\n- View toggles are clearly grouped and don’t read as flat button spam.\n","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:42:10.877475246+01:00","updated_at":"2025-12-21T21:42:10.877475246+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.2.3","depends_on_id":"SafetySecretary-m11.2","type":"parent-child","created_at":"2025-12-21T21:42:10.878204386+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.2.3","depends_on_id":"SafetySecretary-m11.2.1","type":"blocks","created_at":"2025-12-21T21:48:08.889080424+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.2.4","title":"Add consistent breadcrumbs/home link + back patterns","description":"Background\n- App name in landing headers is static text and not a navigation affordance; back navigation differs between modules.\n\nGoals\n- Make brand/home link consistent across pages.\n- Define a shared breadcrumb/back pattern for editors.\n\nAcceptance\n- Users can always return to Home and module landing without guessing.\n- No module-specific back buttons that feel ad hoc.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:42:25.849085391+01:00","updated_at":"2025-12-21T21:42:25.849085391+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.2.4","depends_on_id":"SafetySecretary-m11.2","type":"parent-child","created_at":"2025-12-21T21:42:25.851142215+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.2.4","depends_on_id":"SafetySecretary-m11.2.1","type":"blocks","created_at":"2025-12-21T21:48:19.013998174+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.2.5","title":"Pin global LLM input inside top bar","description":"Background\n- The “Describe changes in natural language” box currently sits in a separate sticky area below the top bar. It should live inside the top bar and remain locked so it never scrolls with content.\n\nGoals\n- Move GlobalLLMInput into the top bar layout as a dedicated row/section.\n- Keep it sticky with the top bar and ensure it remains readable in focus mode.\n\nAcceptance\n- GlobalLLMInput is visually part of the top bar and does not scroll with the main content.\n- Layout remains stable across view modes and responsive breakpoints.\n","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T22:09:57.319038803+01:00","updated_at":"2025-12-21T22:14:01.359742315+01:00","closed_at":"2025-12-21T22:14:01.359744423+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.2.5","depends_on_id":"SafetySecretary-m11.2","type":"parent-child","created_at":"2025-12-21T22:09:57.320410812+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.2.5","depends_on_id":"SafetySecretary-m11.2.1","type":"blocks","created_at":"2025-12-21T22:10:10.860031218+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.3","title":"Forms \u0026 data-entry UX refinement","description":"Background\n- Long create forms (JHA/Incident) are flat and visually heavy; date/time inputs are inconsistent and validation feedback varies.\n\nGoals\n- Reduce cognitive load through grouping/progressive disclosure and consistent form components.\n- Standardize date/time inputs and validation messaging.\n\nAcceptance\n- Create flows feel guided and fast for first-time users.\n- All forms follow a consistent validation pattern and helper text style.\n","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:42:41.075710696+01:00","updated_at":"2025-12-21T21:42:41.075710696+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.3","depends_on_id":"SafetySecretary-m11","type":"parent-child","created_at":"2025-12-21T21:42:41.076409392+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.3","depends_on_id":"SafetySecretary-m11.1.3","type":"blocks","created_at":"2025-12-21T21:48:29.13314947+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.3","depends_on_id":"SafetySecretary-m11.1.4","type":"blocks","created_at":"2025-12-21T21:48:39.302396489+01:00","created_by":"oliver"}],"comments":[{"id":62,"issue_id":"SafetySecretary-m11.3","author":"oliver","text":"UX rationale\n- Create flows are the first impression for new users. Reducing visual density and clarifying required vs optional fields improves confidence and completion.\n- Consistent input types prevent downstream parsing issues and reduce support load.\n","created_at":"2025-12-21T20:51:17Z"}]}
{"id":"SafetySecretary-m11.3.1","title":"Standardize date/time inputs + parsing","description":"Background\n- Landing pages use free-text date fields while editors use date inputs (e.g., JHA and Incident). This causes inconsistent data entry and parsing errors.\n\nGoals\n- Use consistent date/time controls across landing and editor pages.\n- Provide locale-aware formatting and clear input hints.\n\nAcceptance\n- All date/time fields share a single input component or consistent configuration.\n- Parsing errors are handled gracefully with inline messaging.\n","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:42:57.67371328+01:00","updated_at":"2025-12-21T21:42:57.67371328+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.3.1","depends_on_id":"SafetySecretary-m11.3","type":"parent-child","created_at":"2025-12-21T21:42:57.674427525+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.3.2","title":"Progressive disclosure for long create forms","description":"Background\n- JHA/Incident create forms are long and visually dense, which can slow first-time users.\n\nGoals\n- Group optional fields into collapsible/secondary sections.\n- Keep a minimal “quick start” path with only required fields up front.\n\nAcceptance\n- Users can create a case quickly without scrolling through optional fields.\n- Optional metadata is clearly labeled and visually separated.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:43:14.061562525+01:00","updated_at":"2025-12-21T22:06:10.11861123+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.3.2","depends_on_id":"SafetySecretary-m11.3","type":"parent-child","created_at":"2025-12-21T21:43:14.062715665+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.3.3","title":"Replace system dialogs with branded modal UX","description":"Background\n- Critical flows still use window.confirm/prompt (e.g., delete case, reset password, delete photo), which breaks visual continuity and context.\n\nGoals\n- Build a lightweight modal/dialog system consistent with the design system.\n- Replace confirm/prompt usage in core flows.\n\nAcceptance\n- No window.confirm/prompt usage remains in user-facing flows.\n- Dialogs include contextual details (case name, action impact).\n\nFiles to target\n- frontend/src/pages/CaseLanding.tsx\n- frontend/src/components/common/StepPhotosPanel.tsx\n- frontend/src/pages/AdminPortal.tsx\n","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:43:29.95715966+01:00","updated_at":"2025-12-21T21:43:29.95715966+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.3.3","depends_on_id":"SafetySecretary-m11.3","type":"parent-child","created_at":"2025-12-21T21:43:29.95789107+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.3.3","depends_on_id":"SafetySecretary-m11.1.3","type":"blocks","created_at":"2025-12-21T21:48:49.423409059+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.3.4","title":"Unify inline validation + helper text patterns","description":"Background\n- Validation feedback is inconsistent across forms; some rely on default browser behavior, others show ad-hoc text.\n\nGoals\n- Standardize validation style (error states, helper text, success hints) and apply across forms.\n\nAcceptance\n- All forms use the same validation UI and message structure.\n- Error styling aligns with the design system states.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:43:45.915079316+01:00","updated_at":"2025-12-21T21:43:45.915079316+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.3.4","depends_on_id":"SafetySecretary-m11.3","type":"parent-child","created_at":"2025-12-21T21:43:45.91579987+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.4","title":"Feedback, trust \u0026 automation UX","description":"Background\n- LLM-driven actions lack diff/undo; exports and saves provide minimal feedback. This reduces trust and perceived reliability.\n\nGoals\n- Make automated actions transparent, reversible, and clearly communicated.\n\nAcceptance\n- LLM changes show previews and allow undo/rollback.\n- Export/saving states are visible and consistent.\n- Error messages are contextual and styled.\n","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:44:02.289531091+01:00","updated_at":"2025-12-21T21:44:02.289531091+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.4","depends_on_id":"SafetySecretary-m11","type":"parent-child","created_at":"2025-12-21T21:44:02.29024907+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.4","depends_on_id":"SafetySecretary-m11.1.3","type":"blocks","created_at":"2025-12-21T21:48:59.545825025+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.4","depends_on_id":"SafetySecretary-m11.1.4","type":"blocks","created_at":"2025-12-21T21:49:09.667173938+01:00","created_by":"oliver"}],"comments":[{"id":63,"issue_id":"SafetySecretary-m11.4","author":"oliver","text":"UX rationale\n- LLM automation must be predictable; a transparent diff and undo makes it feel safe and enterprise-grade.\n- Save/export feedback should feel reliable and consistent across modules, not scattered labels or silent new tabs.\n","created_at":"2025-12-21T20:51:31Z"}]}
{"id":"SafetySecretary-m11.4.1","title":"LLM preview + undo last apply","description":"Background\n- Global LLM input applies changes with minimal preview, which reduces confidence and increases risk.\n\nGoals\n- Present a clear preview of intended changes (summary + affected rows/fields).\n- Offer a simple “undo last apply” action for recovery.\n\nAcceptance\n- Users can review what will change before applying.\n- A single-step undo is available immediately after apply.\n- The flow remains lightweight and does not require full diff tooling.\n","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:44:18.643435329+01:00","updated_at":"2025-12-21T22:05:55.171034545+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.4.1","depends_on_id":"SafetySecretary-m11.4","type":"parent-child","created_at":"2025-12-21T21:44:18.644149705+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.4.2","title":"Unified save/export status toasts + progress","description":"Background\n- Save/export states are inconsistent and easy to miss. Export actions open new tabs with no local feedback.\n\nGoals\n- Introduce a unified toast/status system for save/export operations.\n- Provide success/error feedback and optional retry.\n\nAcceptance\n- Exports show “generating” → “ready” states and surface errors inline.\n- Saves in editors report status consistently (no mixed ad-hoc labels).\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:44:34.343154327+01:00","updated_at":"2025-12-21T21:44:34.343154327+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.4.2","depends_on_id":"SafetySecretary-m11.4","type":"parent-child","created_at":"2025-12-21T21:44:34.344190803+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.4.3","title":"Attachment UX polish (drag states, gallery, errors)","description":"Background\n- Attachment panels are functional but visually plain and rely on system dialogs for deletion.\n\nGoals\n- Improve drag/drop affordances, empty states, and error messaging.\n- Add lightbox/gallery preview for images where appropriate.\n\nAcceptance\n- Drag targets show clear hover/active states.\n- Delete confirmations use branded modal.\n- Image previews are consistent and do not break layout.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:44:49.085742046+01:00","updated_at":"2025-12-21T21:44:49.085742046+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.4.3","depends_on_id":"SafetySecretary-m11.4","type":"parent-child","created_at":"2025-12-21T21:44:49.08645818+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.4.3","depends_on_id":"SafetySecretary-m11.3.3","type":"blocks","created_at":"2025-12-21T21:49:19.794031937+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.4.4","title":"Incident assistant clarity (draft status + apply flow)","description":"Background\n- Incident assistant has many draft statuses but the UI feels dense and status messaging is scattered.\n\nGoals\n- Clarify the assistant states (draft generated, reviewed, applied).\n- Provide a simple “review then apply” flow with visible success feedback.\n\nAcceptance\n- Assistant area is easy to scan; status messaging is consistent and aligned with global save/toast patterns.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:45:05.118188062+01:00","updated_at":"2025-12-21T21:45:05.118188062+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.4.4","depends_on_id":"SafetySecretary-m11.4","type":"parent-child","created_at":"2025-12-21T21:45:05.118893785+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.5","title":"Visual polish + accessibility pass","description":"Background\n- Current UI feels generic and inconsistent. Accessibility states (focus, contrast) are not fully defined.\n\nGoals\n- Elevate visual design to premium feel and ensure baseline accessibility.\n\nAcceptance\n- Landing/workspace/admin screens look cohesive and intentional.\n- Focus-visible, contrast, and ARIA coverage meet basic a11y expectations.\n","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:45:19.830334662+01:00","updated_at":"2025-12-21T21:45:19.830334662+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.5","depends_on_id":"SafetySecretary-m11","type":"parent-child","created_at":"2025-12-21T21:45:19.831113333+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.5","depends_on_id":"SafetySecretary-m11.1.3","type":"blocks","created_at":"2025-12-21T21:49:29.917538597+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.5","depends_on_id":"SafetySecretary-m11.1.4","type":"blocks","created_at":"2025-12-21T21:49:40.039163857+01:00","created_by":"oliver"}],"comments":[{"id":64,"issue_id":"SafetySecretary-m11.5","author":"oliver","text":"UX rationale\n- Visual polish will only stick if built on consistent tokens and component states.\n- Accessibility improvements are part of “premium” polish: focus clarity and contrast improvements noticeably increase perceived quality.\n","created_at":"2025-12-21T20:51:45Z"}]}
{"id":"SafetySecretary-m11.5.1","title":"Landing page redesign (Home + HIRA/JHA/Incident)","description":"Background\n- Landing pages are functional but feel template-like; hero sections lack a premium feel and CTAs are visually flat.\n\nGoals\n- Redesign the landing layouts with a clearer hierarchy, richer visuals, and modern card treatments.\n- Ensure mobile and desktop layouts feel intentional.\n\nAcceptance\n- Home + module landings feel visually cohesive and higher-end.\n- Hero sections communicate value and primary actions clearly.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:45:36.671432372+01:00","updated_at":"2025-12-21T21:45:36.671432372+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.5.1","depends_on_id":"SafetySecretary-m11.5","type":"parent-child","created_at":"2025-12-21T21:45:36.672223101+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.5.2","title":"Workspace readability + hierarchy polish","description":"Background\n- Workspace views (guided/table/matrix/actions) are dense. Hierarchy between headings, instructions, and data tables is weak.\n\nGoals\n- Improve readability via spacing, typography, and section grouping.\n- Make the primary action in each view visually obvious.\n\nAcceptance\n- Each workspace view has a clear visual hierarchy and reduces scanning fatigue.\n- Primary actions stand out without overwhelming the content.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:45:51.97113359+01:00","updated_at":"2025-12-21T21:45:51.97113359+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.5.2","depends_on_id":"SafetySecretary-m11.5","type":"parent-child","created_at":"2025-12-21T21:45:51.971953345+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.5.3","title":"Admin portal redesign (structure + clarity)","description":"Background\n- Admin portal uses basic layouts and system prompts. Sensitive actions feel abrupt and unpolished.\n\nGoals\n- Redesign admin layout into clear sections (orgs, users, audit), add contextual actions and inline feedback.\n\nAcceptance\n- Admin portal feels consistent with the rest of the app design.\n- Sensitive actions use branded confirmation modals and show status feedback.\n","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:46:13.371220817+01:00","updated_at":"2025-12-21T21:46:13.371220817+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.5.3","depends_on_id":"SafetySecretary-m11.5","type":"parent-child","created_at":"2025-12-21T21:46:13.372063196+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-m11.5.4","title":"Accessibility pass (focus, contrast, ARIA)","description":"Background\n- Focus-visible styling and contrast rules are inconsistent. Some interactive elements lack ARIA labelling or accessible states.\n\nGoals\n- Ensure keyboard navigation clarity and minimum contrast ratios.\n- Add ARIA roles/labels for custom UI (menus, dialogs, toasts).\n\nAcceptance\n- Focus-visible is consistent across interactive elements.\n- Basic accessibility checklist passes (keyboard nav, contrast, role labels).\n","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:46:30.779973244+01:00","updated_at":"2025-12-21T21:46:30.779973244+01:00","dependencies":[{"issue_id":"SafetySecretary-m11.5.4","depends_on_id":"SafetySecretary-m11.5","type":"parent-child","created_at":"2025-12-21T21:46:30.780739097+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-m11.5.4","depends_on_id":"SafetySecretary-m11.1.3","type":"blocks","created_at":"2025-12-21T21:49:50.16340889+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-mmk","title":"Incident assistant tests (routes + UI)","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T07:57:37.668616522+01:00","updated_at":"2025-12-21T09:29:20.311781949+01:00","closed_at":"2025-12-21T09:29:20.311783821+01:00","dependencies":[{"issue_id":"SafetySecretary-mmk","depends_on_id":"SafetySecretary-v9t","type":"blocks","created_at":"2025-12-21T07:57:54.999640118+01:00","created_by":"oliver"}],"comments":[{"id":33,"issue_id":"SafetySecretary-mmk","author":"oliver","text":"Goal: add targeted tests for the new incident assistant endpoints and UI workflow.\\n\\nDeliverables: backend tests for narrative extraction endpoint + clarification updates; frontend tests for the narrative panel rendering and apply action.\\n\\nConsiderations: focus on deterministic behavior by stubbing LLM outputs; verify that drafts don’t overwrite existing timeline/facts without explicit apply.","created_at":"2025-12-21T06:57:46Z"}]}
{"id":"SafetySecretary-mzo","title":"Files to Modify","description":"- `prisma/schema.prisma`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.694698218+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-ngs","title":"Problem Statement","description":"**File:** `src/routes/adminRouter.ts:19`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.701922025+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-nh3","title":"Incident assistant data model (narrative + clarifications)","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T07:55:48.225821956+01:00","updated_at":"2025-12-21T08:11:47.42257197+01:00","closed_at":"2025-12-21T08:11:47.422574167+01:00","comments":[{"id":29,"issue_id":"SafetySecretary-nh3","author":"oliver","text":"Goal: persist the incident narrative input, extracted facts/timeline, and clarification Q/A in the database so the flow is recoverable, auditable, and shareable.\\n\\nRationale: keeping this only in UI state loses context on refresh and makes collaboration impossible. Persisting also supports later reporting and audit trails.\\n\\nOptions: (A) add fields on IncidentCase (narrative text + JSON blob for pending clarifications) or (B) introduce IncidentClarification model with question, answer, status, orderIndex. Prefer explicit model if we expect future workflows (assigning owners, tracking status), otherwise use JSON for faster MVP.\\n\\nDeliverables: update Prisma schema + migration; update incident DTOs/types to include new fields.","created_at":"2025-12-21T06:55:58Z"},{"id":46,"issue_id":"SafetySecretary-nh3","author":"oliver","text":"Revision: include persistence for assistant drafts (extracted facts/timeline + clarifications) separate from the canonical timeline so users can review before applying. This could be JSON fields on IncidentCase or a dedicated IncidentDraft table.","created_at":"2025-12-21T07:06:25Z"}]}
{"id":"SafetySecretary-nhd","title":"Fix JHA PDF export failing on server","description":"Reproduce and fix JHA PDF export failures on the server. Capture the error path (logs/stack), verify asset/font access and file permissions, and confirm /api/jha-cases/:id/export/pdf returns a valid PDF in production. Add minimal logging/tests if needed to prevent regressions.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T22:19:34.084906615+01:00","updated_at":"2025-12-21T22:24:34.233118535+01:00"}
{"id":"SafetySecretary-odh","title":"Dependency","description":"Blocked by: Critical Sweep Epic","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.670579932+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-ouu","title":"Align severity/likelihood scales + risk bands to HIRA template","description":"Replace current LOW/MEDIUM/HIGH/CRITICAL + RARE/UNLIKELY/... with the HIRA template's 5×5 severity/likelihood scales and risk acceptance bands (Extreme/High/Moderate/Minor/Negligible), including guidance metadata (treat/tolerate, approvals, timescales).","acceptance_criteria":"- UI dropdowns use template scales\\n- Backend validation/enums match template scales\\n- Risk band computed exactly per template\\n- Exports show the same labels as the template","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-12T12:58:28.008312196+01:00","updated_at":"2025-12-18T22:45:55.661469228+01:00","closed_at":"2025-12-18T22:45:55.661470853+01:00"}
{"id":"SafetySecretary-ouu.1","title":"Exports: show template risk bands + guidance","description":"Update PDF/XLSX outputs to show severity/likelihood labels and risk band, and optionally the treat/tolerate guidance.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T12:58:38.660943322+01:00","updated_at":"2025-12-18T22:45:50.567937211+01:00","closed_at":"2025-12-18T22:45:50.567938757+01:00","dependencies":[{"issue_id":"SafetySecretary-ouu.1","depends_on_id":"SafetySecretary-ouu","type":"parent-child","created_at":"2025-12-12T12:58:38.661418457+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-ouu.2","title":"Backend: update validation + types for new scales","description":"Update enums/types/validation so severity and likelihood values match the template scales, and store computed risk band. Keep baseline/residual separate.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:58:38.687416731+01:00","updated_at":"2025-12-18T22:45:40.383469148+01:00","closed_at":"2025-12-18T22:45:40.383470612+01:00","dependencies":[{"issue_id":"SafetySecretary-ouu.2","depends_on_id":"SafetySecretary-ouu","type":"parent-child","created_at":"2025-12-12T12:58:38.68790744+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-ouu.3","title":"Confirm risk matrix mapping (5x5)","description":"Extract or encode the exact mapping from (severity, likelihood) to risk band (Extreme/High/Moderate/Minor/Negligible) from the template. Decide whether it's a lookup table or formula + thresholds.","acceptance_criteria":"- Mapping is explicitly defined (table or formula)\\n- Unit tests cover all combinations or key thresholds","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T12:58:38.713519359+01:00","updated_at":"2025-12-18T22:12:19.43972485+01:00","closed_at":"2025-12-18T22:12:19.439726642+01:00","dependencies":[{"issue_id":"SafetySecretary-ouu.3","depends_on_id":"SafetySecretary-ouu","type":"parent-child","created_at":"2025-12-12T12:58:38.713985764+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-ouu.4","title":"Frontend: update risk rating UI to template scales","description":"Update dropdowns/labels and risk display (band + guidance) to use template scales. Ensure baseline can exist without residual.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:58:38.740755165+01:00","updated_at":"2025-12-18T22:45:45.473836946+01:00","closed_at":"2025-12-18T22:45:45.473838342+01:00","dependencies":[{"issue_id":"SafetySecretary-ouu.4","depends_on_id":"SafetySecretary-ouu","type":"parent-child","created_at":"2025-12-12T12:58:38.741232543+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-p2h","title":"Definition of Done","description":"- All 4 critical issues have PRs merged","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.657326664+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-pdj","title":"Pattern to Audit","description":"Check other context actions for same pattern:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.680989277+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-pgi","title":"Files to Create","description":"- `src/lib/logger.ts`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.699535991+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-q41","title":"Why This Design","description":"1. **Correlation ID**: Allows tracing errors between client reports and server logs","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.659374184+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-q46","title":"Preview auth env + demo org/test DB wiring","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T07:54:09.002956962+01:00","updated_at":"2025-12-21T08:09:54.060368399+01:00","closed_at":"2025-12-21T08:09:54.060370132+01:00","comments":[{"id":25,"issue_id":"SafetySecretary-q46","author":"oliver","text":"Background: we need a read/write preview mode for internal testing that never touches real customer org data. The safest path is a dedicated demo org + demo user whose DB connection string points to a separate test database. This task defines the env surface area and guard rails so later steps can rely on consistent inputs.\\n\\nDeliverables: define env keys (e.g., DEMO_LOGIN_ENABLED, DEMO_ORG_SLUG, DEMO_ORG_NAME, DEMO_DB_URL, DEMO_USER_USERNAME, DEMO_USER_EMAIL), validate at startup, and update .env.example with clear comments. Explicitly document that demo mode is disabled unless envs are set. Ensure the demo DB is isolated and never reuses production connection strings.","created_at":"2025-12-21T06:54:20Z"},{"id":41,"issue_id":"SafetySecretary-q46","author":"oliver","text":"Revision: include demo-only storage root and encryption key hygiene. Add env vars for DEMO_STORAGE_ROOT / DEMO_ATTACHMENTS_DIR (or equivalent) so attachments + exported files are isolated. Ensure registry ensures a unique encryption key for the demo org and never reuses prod key refs.","created_at":"2025-12-21T07:05:18Z"}]}
{"id":"SafetySecretary-q5l","title":"Multi-tenant auth + user management (beta)","description":"Background:\n- SafetySecretary is moving from single-user MVP to multi-org beta tests.\n- Users must be isolated by organization with no cross-contamination of data or attachments.\n- Login is org slug + username + password; admin creates accounts; no self-serve password yet.\n\nGoal:\n- Deliver a secure, reliable beta user management system aligned with the product vision: privacy, trust, and operational clarity for safety teams.\n\nScope:\n- Separate Postgres DB per org (strict isolation).\n- Registry (control-plane) DB for orgs/users/roles/session/audit.\n- Auth middleware + login/logout + rate limiting/lockout.\n- Admin UI + CLI for org provisioning and account management.\n- Login page + user menu + settings stubs.\n- Attachment encryption + per-org storage root.\n\nOut of scope:\n- Self-serve password reset.\n- SSO or enterprise IdP integration.\n- Fine-grained RBAC beyond owner/admin/member.\n\nAcceptance (epic-level):\n- Org data and attachments are isolated at DB and storage layers.\n- Users can log in with org slug + username + password and remain logged in with remember-me.\n- Admin can provision orgs and users via UI or CLI.\n- UI exposes user menu and settings stubs without breaking existing workflows.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-20T22:16:57.242072779+01:00","updated_at":"2025-12-21T03:35:54.271841439+01:00","closed_at":"2025-12-21T03:35:54.27184768+01:00"}
{"id":"SafetySecretary-q5l.1","title":"Auth decision log (lockout TTL, session TTL, slug rules, admin access)","description":"Background:\n- Final auth behavior depends on a few policy choices that affect user experience and security posture.\n\nDecisions needed:\n- Lockout duration after 5 failed attempts (time-based vs admin-only unlock).\n- Session TTL for non-remember sessions.\n- Org slug format rules (case, allowed characters).\n- Admin UI access policy (global platform admin vs IP allowlist).\n\nWhy now:\n- These choices drive backend behavior, validation, and frontend messaging.\n\nAcceptance:\n- Documented decisions and defaults.\n- Linked to implementation tasks that need the choices.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:17:08.825253249+01:00","updated_at":"2025-12-20T23:20:05.807692937+01:00","closed_at":"2025-12-20T23:20:05.807695201+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.1","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:17:08.826809216+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.10","title":"Admin CLI: org provisioning + migrations","description":"Background:\n- Beta needs a reliable out-of-band provisioning path for org DBs.\n\nScope:\n- CLI command to create org in registry and provision tenant DB.\n- CLI command to run tenant migrations and report status.\n- CLI command to reset user passwords and unlock accounts.\n\nAcceptance:\n- CLI can create orgs, provision DBs, and run migrations.\n- CLI can reset passwords/unlock users.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:18:47.436708331+01:00","updated_at":"2025-12-21T00:47:05.142562418+01:00","closed_at":"2025-12-21T00:47:05.14256412+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.10","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:18:47.437377007+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.10","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:22:57.256307842+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.10","depends_on_id":"SafetySecretary-q5l.3","type":"blocks","created_at":"2025-12-20T22:23:06.867242353+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.10","depends_on_id":"SafetySecretary-q5l.6","type":"blocks","created_at":"2025-12-20T22:23:15.689487459+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.10","depends_on_id":"SafetySecretary-q5l.20","type":"blocks","created_at":"2025-12-20T22:28:27.176175956+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.11","title":"Frontend: login page (org slug + username + password)","description":"Background:\n- Users require a dedicated login screen before accessing cases.\n\nScope:\n- Simple login page with org slug, username, password, remember-me checkbox.\n- Error messages for invalid credentials and remaining attempts.\n- Redirect to app after login.\n\nAcceptance:\n- Login page works end-to-end with backend auth.\n- Errors are user-friendly and include remaining attempts when relevant.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:18:59.080223278+01:00","updated_at":"2025-12-21T00:15:30.154659918+01:00","closed_at":"2025-12-21T00:15:30.154667271+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.11","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:18:59.081010685+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.11","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:23:26.965948194+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.11","depends_on_id":"SafetySecretary-q5l.7","type":"blocks","created_at":"2025-12-20T22:23:36.293543552+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.11","depends_on_id":"SafetySecretary-q5l.1","type":"blocks","created_at":"2025-12-20T22:28:36.103982912+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.12","title":"Frontend: route protection + auth bootstrap","description":"Background:\n- The app currently assumes unauthenticated access.\n\nScope:\n- Global auth check on app load.\n- Redirect unauthenticated users to login.\n- Store minimal user/org metadata for UI display.\n\nAcceptance:\n- All app routes require auth.\n- Users are redirected to login when session expires.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:19:12.081025196+01:00","updated_at":"2025-12-21T00:18:16.456949419+01:00","closed_at":"2025-12-21T00:18:16.45695145+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.12","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:19:12.081725678+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.12","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:23:44.473014798+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.12","depends_on_id":"SafetySecretary-q5l.4","type":"blocks","created_at":"2025-12-20T22:25:42.547215912+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.12","depends_on_id":"SafetySecretary-q5l.21","type":"blocks","created_at":"2025-12-20T22:29:03.039613143+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.13","title":"Frontend: user menu + settings stubs","description":"Background:\n- Users need a clear account entry point for settings and future features.\n\nScope:\n- User menu showing org + username + role.\n- Theme toggle (existing) surfaced here.\n- Stub sections for API key input and sub-accounts (disabled or informational).\n- Basic account info view (email, display name) with read-only fields for beta.\n- Guidance for contacting admin for account changes or lockouts.\n\nAcceptance:\n- User menu accessible on main app shell.\n- Settings stubs are visible but clearly marked as beta/inactive.\n- Users can find the correct escalation path (contact admin).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:19:24.01858017+01:00","updated_at":"2025-12-21T00:47:10.242139107+01:00","closed_at":"2025-12-21T00:47:10.242140693+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.13","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:19:24.019424251+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.13","depends_on_id":"SafetySecretary-q5l.12","type":"blocks","created_at":"2025-12-20T22:23:52.655385915+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.14","title":"Attachment isolation: per-org storage roots","description":"Background:\n- Photos must not be visible across orgs.\n\nScope:\n- Per-org storage root (directory) resolved from registry.\n- Ensure all attachment upload/download paths are tenant-scoped.\n\nAcceptance:\n- Attachments are stored and served from org-specific paths.\n- No cross-org file access is possible.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:19:34.656060626+01:00","updated_at":"2025-12-21T00:04:02.174216633+01:00","closed_at":"2025-12-21T00:04:02.174218551+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.14","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:19:34.658287997+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.14","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:24:00.339412401+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.15","title":"Attachment encryption at rest (per-org keys)","description":"Background:\n- Org privacy expectations require encrypted attachments at rest.\n\nScope:\n- Encrypt file contents before writing to disk using per-org key.\n- Store per-org key reference in registry (encrypted by master key in env).\n- Decrypt on read/stream.\n\nConsiderations:\n- Use AES-GCM for authenticated encryption.\n- Avoid loading large files fully into memory if possible.\n\nAcceptance:\n- Attachments are encrypted at rest and decrypted for authorized access.\n- Keys are isolated per org.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:19:46.293552292+01:00","updated_at":"2025-12-21T00:15:49.91841682+01:00","closed_at":"2025-12-21T00:15:49.918418545+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.15","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:19:46.294306466+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.15","depends_on_id":"SafetySecretary-q5l.14","type":"blocks","created_at":"2025-12-20T22:24:09.248297329+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.15","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:24:17.495493797+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.16","title":"Session hardening: CSRF + cookie security","description":"Background:\n- Cookie sessions require CSRF protection or same-site strategy.\n\nScope:\n- Decide CSRF strategy (SameSite=Lax/Strict + token if needed).\n- Set secure cookie flags (HttpOnly, Secure in prod).\n- Configure session rotation on login.\n\nAcceptance:\n- CSRF risk mitigated for state-changing routes.\n- Cookies are configured safely for beta.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:20:00.342438351+01:00","updated_at":"2025-12-21T00:46:54.940025488+01:00","closed_at":"2025-12-21T00:46:54.940027395+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.16","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:20:00.343271908+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.16","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:24:26.042127394+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.17","title":"Tests: auth flows + tenant isolation","description":"Goal:\n- Ensure login, session expiry, and tenant isolation are reliable.\n\nScope:\n- Backend tests for login success/failure, lockout, and session TTL.\n- Tenant isolation tests verifying data cannot cross org DBs.\n\nAcceptance:\n- Tests cover core auth flows and isolation boundaries.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:20:11.735467091+01:00","updated_at":"2025-12-21T03:34:58.595554342+01:00","closed_at":"2025-12-21T03:34:58.595556288+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.17","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:20:11.736529856+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.17","depends_on_id":"SafetySecretary-q5l.4","type":"blocks","created_at":"2025-12-20T22:24:34.864890264+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.17","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:24:44.409398028+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.17","depends_on_id":"SafetySecretary-q5l.7","type":"blocks","created_at":"2025-12-20T22:24:53.175365122+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.18","title":"Tests: attachment encryption + storage isolation","description":"Goal:\n- Validate encryption-at-rest and per-org storage isolation.\n\nScope:\n- Upload/download tests across two orgs.\n- Verify ciphertext on disk (not plaintext).\n\nAcceptance:\n- Encrypted storage verified.\n- Cross-org file access blocked.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:20:22.840423462+01:00","updated_at":"2025-12-21T03:35:08.60492233+01:00","closed_at":"2025-12-21T03:35:08.60492413+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.18","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:20:22.841096703+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.18","depends_on_id":"SafetySecretary-q5l.14","type":"blocks","created_at":"2025-12-20T22:25:01.575329077+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.18","depends_on_id":"SafetySecretary-q5l.15","type":"blocks","created_at":"2025-12-20T22:25:09.767818697+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.19","title":"Beta rollout checklist (security + provisioning)","description":"Background:\n- Beta needs consistent, repeatable onboarding for new orgs.\n\nScope:\n- Checklist: create org DB, run migrations, set encryption key, create owner/admin, validate login, verify attachment access.\n- Document admin responsibilities and escalation path.\n\nAcceptance:\n- Checklist stored in repo docs.\n- Admin can follow checklist to onboard a new org.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T22:20:33.249616648+01:00","updated_at":"2025-12-21T03:35:18.66385334+01:00","closed_at":"2025-12-21T03:35:18.663855328+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.19","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:20:33.253485281+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.19","depends_on_id":"SafetySecretary-q5l.3","type":"blocks","created_at":"2025-12-20T22:25:20.107317636+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.19","depends_on_id":"SafetySecretary-q5l.15","type":"blocks","created_at":"2025-12-20T22:25:29.150548346+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.2","title":"Registry DB schema (orgs, users, memberships, sessions, audit)","description":"Background:\n- Org-per-DB isolation requires a control-plane registry to map org slug -\u003e tenant DB and manage users/roles.\n\nScope:\n- Organization: slug, name, status, storage root, encryption key reference.\n- User: username, email, password hash, status.\n- Membership/Role: owner/admin/member per org (supports sub-accounts).\n- Session store (server-side sessions).\n- Login audit log + failed attempt tracking for lockouts.\n- Optional placeholder for future org-level API key (encrypted), inactive in beta.\n\nConsiderations:\n- Keep registry minimal and secure; no assessment data stored here.\n- Prepare for future org-level API key storage (encrypted).\n\nAcceptance:\n- Prisma schema + migrations for registry DB.\n- Data model supports per-org routing, roles, sessions, and audit.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:17:21.075994412+01:00","updated_at":"2025-12-20T23:28:38.648803476+01:00","closed_at":"2025-12-20T23:28:38.648805385+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.2","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:17:21.079278426+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.2","depends_on_id":"SafetySecretary-q5l.1","type":"blocks","created_at":"2025-12-20T22:20:55.914037376+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.20","title":"Platform admin bootstrap + admin access control","description":"Background:\n- Admin UI/CLI must be protected to avoid accidental exposure of org provisioning or password resets.\n\nScope:\n- Define a platform-admin identity (global) and how it is authenticated.\n- Guard admin UI routes and admin API endpoints.\n- Ensure only platform admin can create orgs or manage users across orgs.\n\nConsiderations:\n- Access policy decided in SafetySecretary-q5l.1 (global admin vs IP allowlist).\n\nAcceptance:\n- Admin routes are inaccessible to non-platform admins.\n- Admin UI/CLI access path is clearly defined and tested.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:27:16.354348455+01:00","updated_at":"2025-12-21T00:04:21.227111532+01:00","closed_at":"2025-12-21T00:04:21.227113198+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.20","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:27:16.355015005+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.20","depends_on_id":"SafetySecretary-q5l.1","type":"blocks","created_at":"2025-12-20T22:27:45.406376497+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.20","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:27:53.39384461+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.21","title":"Authorization layer: role enforcement (owner/admin/member)","description":"Background:\n- Roles are required to keep admin capabilities and sensitive actions restricted.\n\nScope:\n- Middleware to enforce roles for admin routes and future settings.\n- Ensure org members can only access their org data (in addition to DB isolation).\n\nAcceptance:\n- Role checks are centralized and consistently applied.\n- Admin-only routes are inaccessible to members.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:27:26.295240737+01:00","updated_at":"2025-12-21T00:16:07.651012425+01:00","closed_at":"2025-12-21T00:16:07.651014172+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.21","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:27:26.29602941+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.21","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:28:01.200047594+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.21","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:28:09.255792452+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.22","title":"UX: session expiry + lockout messaging","description":"Background:\n- Users need clear feedback when sessions expire or accounts are locked.\n\nScope:\n- Login screen messages for lockout (contact admin) and remaining attempts.\n- In-app banner/redirect for session expiry with re-login prompt.\n\nAcceptance:\n- Users see clear guidance on lockout and session expiry.\n- UX avoids ambiguous failures.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:27:36.714110038+01:00","updated_at":"2025-12-21T03:35:27.606950546+01:00","closed_at":"2025-12-21T03:35:27.606952296+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.22","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:27:36.71481141+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.22","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:28:44.187082594+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.22","depends_on_id":"SafetySecretary-q5l.7","type":"blocks","created_at":"2025-12-20T22:28:53.107321609+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.23","title":"UX: tenant health + friendly errors","description":"Background:\n- If a tenant DB is down or misconfigured, users need a clear, non-technical message and guidance.\n\nScope:\n- Detect tenant resolution/connection failures.\n- Show friendly error page or banner (e.g., \"Service temporarily unavailable for your organization\").\n- Provide escalation guidance (contact admin).\n\nAcceptance:\n- Tenant connection failures surface a user-friendly message.\n- No raw stack traces or DB details leak to users.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:35:14.333098257+01:00","updated_at":"2025-12-21T03:35:36.789788451+01:00","closed_at":"2025-12-21T03:35:36.789790461+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.23","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:35:14.333811547+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.23","depends_on_id":"SafetySecretary-q5l.4","type":"blocks","created_at":"2025-12-20T22:35:34.408000988+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.23","depends_on_id":"SafetySecretary-q5l.12","type":"blocks","created_at":"2025-12-20T22:35:42.552689143+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.24","title":"Admin: logout everywhere (invalidate all sessions)","description":"Background:\n- Admins need the ability to quickly revoke access if a device is lost or an account is compromised.\n\nScope:\n- Admin action to invalidate all sessions for a user (and optionally an org).\n- Clear UI/CLI affordance and confirmation.\n\nAcceptance:\n- Admin can revoke all active sessions for a user.\n- Affected users must re-authenticate.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:35:26.07484225+01:00","updated_at":"2025-12-21T03:35:45.5143437+01:00","closed_at":"2025-12-21T03:35:45.514346084+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.24","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:35:26.075487998+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.24","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:35:51.517572729+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.24","depends_on_id":"SafetySecretary-q5l.20","type":"blocks","created_at":"2025-12-20T22:35:59.35591142+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.3","title":"Tenant DB provisioning + migrations (org-per-DB)","description":"Background:\n- Each org needs its own Postgres database initialized with the core schema.\n\nScope:\n- Create tenant DB on demand (admin UI + CLI).\n- Run Prisma migrations for tenant DBs.\n- Store tenant DB connection info in registry.\n\nConsiderations:\n- Use a dedicated DB user per tenant if feasible.\n- Avoid leaking tenant DB credentials in logs.\n\nAcceptance:\n- Admin can provision a new org DB via UI or CLI.\n- Migrations run reliably and repeatably for tenant DBs.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:17:32.551661235+01:00","updated_at":"2025-12-21T00:03:07.554110738+01:00","closed_at":"2025-12-21T00:03:07.554112583+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.3","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:17:32.552370546+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.3","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:21:04.80341873+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.4","title":"Tenant-aware routing + Prisma client selection","description":"Background:\n- All case data must be scoped to the org-specific database after login.\n\nScope:\n- Middleware resolves org from session -\u003e tenant DB.\n- Attach tenant Prisma client to request context.\n- Ensure all existing routes use tenant client (no fallback to global DB).\n\nConsiderations:\n- Connection pooling strategy for multiple tenant DBs.\n- Fail closed if tenant resolution fails.\n\nAcceptance:\n- All API routes use tenant-specific Prisma client.\n- Cross-org access is impossible at the DB level.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:17:43.256706646+01:00","updated_at":"2025-12-21T00:03:25.991757241+01:00","closed_at":"2025-12-21T00:03:25.991759037+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.4","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:17:43.259720579+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.4","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:21:12.7045494+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.5","title":"Auth backend: login/logout + session store","description":"Background:\n- Beta requires org slug + username + password login with server-side sessions.\n\nScope:\n- Login endpoint validates org+user in registry, checks password hash.\n- Create server-side session (cookie) with remember-me TTL.\n- Logout endpoint clears session.\n\nConsiderations:\n- HttpOnly/SameSite cookie settings.\n- Different TTLs for remember-me vs standard session.\n\nAcceptance:\n- Users can log in/out reliably.\n- Session cookie persists for remember-me (10 days) and shorter for standard.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:17:55.211122163+01:00","updated_at":"2025-12-21T00:06:03.99586888+01:00","closed_at":"2025-12-21T00:06:03.995870566+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.5","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:17:55.212457418+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.5","depends_on_id":"SafetySecretary-q5l.1","type":"blocks","created_at":"2025-12-20T22:21:30.635968434+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.5","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:21:39.844446995+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.5","depends_on_id":"SafetySecretary-q5l.6","type":"blocks","created_at":"2025-12-20T22:21:48.62632794+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.6","title":"Auth backend: password hashing + admin-set credentials","description":"Background:\n- Beta uses admin-set static passwords; no self-service yet.\n\nScope:\n- Password hashing (Argon2 or bcrypt) + verification.\n- Admin UI/CLI for creating users and setting/resetting passwords.\n- Secure password update flow for admin only.\n\nAcceptance:\n- Passwords stored hashed + salted.\n- Admin can set/reset passwords without exposing hashes.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:18:05.613638776+01:00","updated_at":"2025-12-21T00:03:43.2572785+01:00","closed_at":"2025-12-21T00:03:43.257280218+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.6","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:18:05.614438618+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.6","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:21:22.02445953+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.7","title":"Auth backend: rate limiting + lockout w/ remaining attempts","description":"Background:\n- Users should be informed of remaining attempts; lockout triggers after 5 failures.\n\nScope:\n- Track failed attempts per user+org.\n- Lockout policy (duration vs admin unlock) per decision log.\n- Return remaining attempts in login errors.\n\nAcceptance:\n- Lockout triggers after 5 failures.\n- User-facing error indicates remaining attempts.\n- Lockout policy enforced consistently.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:18:15.972411669+01:00","updated_at":"2025-12-21T00:06:22.07345308+01:00","closed_at":"2025-12-21T00:06:22.073454851+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.7","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:18:15.973660507+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.7","depends_on_id":"SafetySecretary-q5l.1","type":"blocks","created_at":"2025-12-20T22:21:56.528942378+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.7","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:22:04.928925173+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.8","title":"Auth backend: login audit log","description":"Background:\n- Basic audit trail helps admins verify access and detect abuse.\n\nScope:\n- Record login attempts (success/failure, timestamp, user/org, IP, user agent if available).\n- Expose to admin UI (read-only) or CLI.\n\nAcceptance:\n- Audit log entries are recorded for login attempts.\n- Admin can view recent audit events.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:18:26.103608436+01:00","updated_at":"2025-12-21T00:06:40.863131317+01:00","closed_at":"2025-12-21T00:06:40.863132997+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.8","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:18:26.104298229+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.8","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:22:14.674247926+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.8","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:22:23.466704589+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.9","title":"Admin UI: org + user management","description":"Background:\n- Beta requires admin-managed orgs and users.\n\nScope:\n- Admin-only UI for creating orgs, creating users, setting/resetting passwords, assigning roles.\n- Display tenant DB status and storage root.\n- Provide unlock action for locked users if lockout policy requires admin action.\n\nAcceptance:\n- Admin can create orgs/users via UI.\n- Admin can reset passwords and manage roles.\n- Admin can unlock accounts if needed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:18:36.924250325+01:00","updated_at":"2025-12-21T00:47:00.04349979+01:00","closed_at":"2025-12-21T00:47:00.043501535+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.9","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:18:36.924960454+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.9","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:22:32.280921294+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.9","depends_on_id":"SafetySecretary-q5l.3","type":"blocks","created_at":"2025-12-20T22:22:41.153181852+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.9","depends_on_id":"SafetySecretary-q5l.6","type":"blocks","created_at":"2025-12-20T22:22:49.372809695+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.9","depends_on_id":"SafetySecretary-q5l.20","type":"blocks","created_at":"2025-12-20T22:28:18.99099172+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-qt8","title":"Residual risk clearing + validation","description":"Background:\n- Residual risk ratings cannot be cleared once set.\n- UI shows \"Saving...\" even when no payload is sent.\n\nGoal:\n- Make clearing ratings intentional, supported, and correctly reflected in the UI.\n\nScope:\n- Baseline and residual ratings across phases and workspace.\n- Backend validation and persistence rules.\n\nAcceptance (epic-level):\n- Users can clear ratings when appropriate and see accurate status.\n- Backend supports the chosen clearing semantics.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-20T21:49:40.847733971+01:00","updated_at":"2025-12-21T03:36:32.496505292+01:00","closed_at":"2025-12-21T03:36:32.496507099+01:00"}
{"id":"SafetySecretary-qt8.1","title":"Define clearing semantics for baseline/residual ratings","description":"Background:\n- It is unclear whether ratings should be optional or required once set.\n\nGoal:\n- Decide clearing semantics for baseline/residual ratings.\n\nDecision points:\n- Are ratings optional at all phases, or required after a certain phase?\n- What does \"cleared\" look like in UI and data model?\n\nAcceptance:\n- Decision documented and agreed.\n- Clear guidance for frontend/back-end implementation.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T21:49:51.374578391+01:00","updated_at":"2025-12-20T23:22:45.223276376+01:00","closed_at":"2025-12-20T23:22:45.22327851+01:00","dependencies":[{"issue_id":"SafetySecretary-qt8.1","depends_on_id":"SafetySecretary-qt8","type":"parent-child","created_at":"2025-12-20T21:49:51.37537571+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-qt8.2","title":"Backend: support clearing ratings","description":"Background:\n- Current endpoints require severity+likelihood; no path to clear.\n\nGoal:\n- Implement backend support for clearing according to the defined policy.\n\nImplementation notes:\n- Option A: allow empty payload to remove assessment row.\n- Option B: add explicit clear endpoint or flag.\n\nAcceptance:\n- Clearing is supported and validated.\n- Tests cover clearing and error cases.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T21:50:01.030719405+01:00","updated_at":"2025-12-21T00:18:39.074888478+01:00","closed_at":"2025-12-21T00:18:39.074890213+01:00","dependencies":[{"issue_id":"SafetySecretary-qt8.2","depends_on_id":"SafetySecretary-qt8","type":"parent-child","created_at":"2025-12-20T21:50:01.031451692+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-qt8.2","depends_on_id":"SafetySecretary-qt8.1","type":"blocks","created_at":"2025-12-20T21:50:31.555162366+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-qt8.3","title":"Frontend: allow clearing ratings + accurate status","description":"Background:\n- UI cannot clear selections and may show misleading save status.\n\nGoal:\n- Allow clearing selections and only show \"Saving\" when a request is sent.\n\nScope:\n- Baseline (PhaseRiskRating) and residual (PhaseControls + workspace table) flows.\n- Status messaging and error handling.\n\nAcceptance:\n- Users can clear a rating and see it persist as empty.\n- Status messages reflect actual network activity.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T21:50:11.888148996+01:00","updated_at":"2025-12-21T00:47:15.343412011+01:00","closed_at":"2025-12-21T00:47:15.343413654+01:00","dependencies":[{"issue_id":"SafetySecretary-qt8.3","depends_on_id":"SafetySecretary-qt8","type":"parent-child","created_at":"2025-12-20T21:50:11.891575318+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-qt8.3","depends_on_id":"SafetySecretary-qt8.2","type":"blocks","created_at":"2025-12-20T21:50:39.738900869+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-qt8.4","title":"Tests: clearing ratings + UI feedback","description":"Goal:\n- Add regression coverage for clearing and re-setting ratings.\n\nScope:\n- Backend tests for clearing behavior.\n- Frontend tests for UI state and status messaging.\n\nAcceptance:\n- Tests pass and cover clear -\u003e set -\u003e clear sequences.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T21:50:20.996139034+01:00","updated_at":"2025-12-21T03:36:22.256578953+01:00","closed_at":"2025-12-21T03:36:22.256580598+01:00","dependencies":[{"issue_id":"SafetySecretary-qt8.4","depends_on_id":"SafetySecretary-qt8","type":"parent-child","created_at":"2025-12-20T21:50:20.996852055+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-qt8.4","depends_on_id":"SafetySecretary-qt8.2","type":"blocks","created_at":"2025-12-20T21:50:50.176246475+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-qt8.4","depends_on_id":"SafetySecretary-qt8.3","type":"blocks","created_at":"2025-12-20T21:50:58.870289356+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-r7y","title":"Fix","description":"```typescript","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.702454577+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-rjc","title":"Files to Audit","description":"- `frontend/src/components/IncidentEditor.tsx`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.703414567+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-rpk","title":"Solution Design","description":"Two-pronged approach:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.662006411+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-s0k","title":"Problem Statement","description":"**File:** `src/services/llmJobManager.ts:170`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.676981056+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-sax","title":"Code Review Remediation 2025-12","description":"# Comprehensive Code Review Remediation\n\nDeep code review of SafetySecretary revealed 80+ issues across security, reliability, type safety, and modularity. This epic tracks systematic remediation.\n\n## Background\n\nSafetySecretary is a multi-tenant safety management platform handling:\n- Hazard and Risk Assessments (HIRA)\n- Job Hazard Analyses (JHA)  \n- Incident Investigations\n\nSecurity/reliability issues could expose sensitive workplace safety data across tenants, cause data loss, or result in compliance violations (OSHA, ISO 45001).\n\n## Review Methodology\n\nThree parallel exploration agents examined:\n1. Backend Security \u0026 Auth - middleware, sessions, CSRF, multi-tenant isolation\n2. Backend Architecture - services, duplication, types, database patterns\n3. Frontend Quality - React patterns, memory leaks, state management\n\n## Issue Summary\n\n| Severity | Count | Examples |\n|----------|-------|----------|\n| Critical | 4 | Missing error handler, SQL injection, memory leaks |\n| High | 10 | Rate limiting, CORS, type safety, code duplication |\n| Medium | 6 | Logging, query optimization, component splitting |\n| Low | 5 | Minor polish, accessibility |\n\n## Acceptance Criteria\n\n- [ ] All critical issues resolved and verified\n- [ ] No `any` types remaining in modified code paths\n- [ ] Test coverage maintained or improved\n- [ ] No new security vulnerabilities introduced\n- [ ] Build and tests pass","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-21T21:12:15.608941593+01:00","updated_at":"2025-12-21T21:14:37.543362476+01:00","labels":["code-review","quality","reliability","security"],"deleted_at":"2025-12-21T21:14:37.543362476+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"SafetySecretary-sax.1","title":"Phase 1: Critical Security \u0026 Reliability Sweep","description":"# Critical Sweep - Fix Immediately\n\nContains 4 critical issues that must be fixed before any other work. These represent:\n- Server crash risks (unhandled errors)\n- Security vulnerabilities (SQL injection)\n- Memory leaks (unbounded connection pools, orphan timers)\n\n## Business Impact\n\nWithout these fixes:\n1. Production server crashes on any unhandled error → downtime\n2. Malicious actor could inject SQL via tenant provisioning → data breach\n3. Long-running servers OOM due to connection pool growth → instability\n4. Frontend memory leaks crash browser tabs → poor UX\n\n## Critical Issues\n\n1. **Missing Global Error Handler** (src/app.ts)\n   - Unhandled errors crash Node process\n   - No consistent error response format\n   \n2. **SQL Injection in Tenant Provisioner** (src/services/tenantProvisioner.ts:96)\n   - CREATE DATABASE uses string interpolation\n   - Only quote escaping, not parameterization\n   \n3. **Unbounded Connection Pool** (src/services/tenantDbManager.ts)\n   - lastUsedAt tracked but never used for cleanup\n   - No max pool size, grows forever\n   \n4. **Frontend setTimeout Leaks** (IncidentEditor.tsx, JhaEditor.tsx)\n   - 15+ setTimeout calls without cleanup\n   - State updates on unmounted components\n\n## Definition of Done\n\n- All 4 critical issues have PRs merged\n- No regressions in existing tests\n- Manual verification in staging environment","status":"tombstone","priority":0,"issue_type":"epic","created_at":"2025-12-21T21:12:59.76775964+01:00","updated_at":"2025-12-21T21:14:37.543362476+01:00","labels":["critical","phase-1","reliability","security"],"deleted_at":"2025-12-21T21:14:37.543362476+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"SafetySecretary-sd3","title":"Issue Categories by Severity","description":"| Severity | Count | Description |","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.655816709+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-sg6","title":"Redesign JHA PDF layout (professional document)","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T07:59:30.823651548+01:00","updated_at":"2025-12-21T08:26:15.636361665+01:00","closed_at":"2025-12-21T08:26:15.636364449+01:00","dependencies":[{"issue_id":"SafetySecretary-sg6","depends_on_id":"SafetySecretary-umg","type":"blocks","created_at":"2025-12-21T07:59:51.722125761+01:00","created_by":"oliver"}],"comments":[{"id":38,"issue_id":"SafetySecretary-sg6","author":"oliver","text":"Goal: make the JHA PDF export look like a formal document: header/title, metadata block (job/site/date/supervisor), table matching the JHA grid, footer with date and signature lines.\\n\\nReasoning: exports are often shared externally and must look polished and trustworthy. The output should match what users built in the staged flow.\\n\\nDeliverables: update ReportService PDF rendering; ensure table headings match UI; add pagination or row wrapping to avoid overlap.\\n\\nConsiderations: use consistent margins; keep header repeated on new pages; include localized labels via reportTranslations.","created_at":"2025-12-21T06:59:41Z"},{"id":51,"issue_id":"SafetySecretary-sg6","author":"oliver","text":"Revision: ensure header + table column titles repeat on every page, add page numbers, and keep signature block on the final page. This improves professionalism and avoids clipped tables.","created_at":"2025-12-21T07:07:20Z"}]}
{"id":"SafetySecretary-tna","title":"Solution Design","description":"Use `express-rate-limit` with different limits for different endpoints:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.672157089+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-umg","title":"JHA PDF labels + i18n keys","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T07:59:14.259512743+01:00","updated_at":"2025-12-21T08:14:02.176696452+01:00","closed_at":"2025-12-21T08:14:02.176698262+01:00","comments":[{"id":37,"issue_id":"SafetySecretary-umg","author":"oliver","text":"Goal: add/adjust translation keys needed for the redesigned JHA PDF (document header, metadata labels, footer/signature labels, table headers).\\n\\nReasoning: PDF export should be localized the same way as the UI and use the same EN/FR/DE wording.\\n\\nConsiderations: keep backend export-only strings in reportTranslations and mirror user-facing copy in frontend i18n as needed.","created_at":"2025-12-21T06:59:22Z"}]}
{"id":"SafetySecretary-v9t","title":"Incident assistant UI flow (narrative -\u003e review -\u003e apply)","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T07:57:06.608106224+01:00","updated_at":"2025-12-21T09:16:21.038956684+01:00","closed_at":"2025-12-21T09:16:21.038958562+01:00","dependencies":[{"issue_id":"SafetySecretary-v9t","depends_on_id":"SafetySecretary-27m","type":"blocks","created_at":"2025-12-21T07:57:29.548686529+01:00","created_by":"oliver"}],"comments":[{"id":32,"issue_id":"SafetySecretary-v9t","author":"oliver","text":"Goal: implement the natural-language incident assistant in the UI. Users paste a narrative, receive extracted facts + a draft timeline, answer clarification questions, and then explicitly apply changes to the case.\\n\\nUX intent: guide a layperson through a professional analysis without hiding the underlying data. The system suggests structure, the user confirms and edits.\\n\\nDeliverables: new panel in IncidentEditor using AssistantPanel-style input; a review section listing extracted facts/timeline with editable fields; a clarification Q/A panel; clear status indicators; and an ‘Apply to case’ action that writes to the canonical timeline/facts only when confirmed.\\n\\nConsiderations: keep existing manual editing features intact; do not overwrite user edits without confirmation; surface LLM uncertainty (confidence tags).","created_at":"2025-12-21T06:57:19Z"},{"id":48,"issue_id":"SafetySecretary-v9t","author":"oliver","text":"Revision: include a change review (diff) view before applying assistant output, so users can accept/edit each fact/timeline item and see what will be overwritten.","created_at":"2025-12-21T07:06:42Z"}]}
{"id":"SafetySecretary-wfy","title":"JHA controls: add 'Suggest additional controls' LLM action","description":"Controls stage needs a dedicated 'Suggest additional controls' action. The prompt should use current steps + hazards for context and return proposed controls for user review. Suggestions must not auto-apply; users accept/reject each control before saving. Do not overwrite existing controls unless explicitly selected.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T22:19:20.241879696+01:00","updated_at":"2025-12-21T22:23:47.303012442+01:00"}
{"id":"SafetySecretary-xg8","title":"UI harmonization + browser TUI experiment","description":"Unify interaction patterns across phases/views. In parallel, prototype a terminal-like spreadsheet UI in browser (feature-flagged) and converge on best UX.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-12T00:03:42.055095396+01:00","updated_at":"2025-12-18T23:03:17.30249341+01:00","closed_at":"2025-12-18T23:03:17.302494972+01:00"}
{"id":"SafetySecretary-xg8.1","title":"Audit current UI patterns","description":"Catalog how steps/hazards/actions are added/edited/reordered in each view; identify inconsistencies.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T00:04:41.189990426+01:00","updated_at":"2025-12-18T20:44:16.477102398+01:00","closed_at":"2025-12-18T20:44:16.477103863+01:00","dependencies":[{"issue_id":"SafetySecretary-xg8.1","depends_on_id":"SafetySecretary-xg8","type":"parent-child","created_at":"2025-12-12T00:04:41.190645717+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-xg8.2","title":"Design unified interaction model","description":"Define one consistent add/edit/delete/reorder pattern for all table entities. Specify keyboard-first flow + visible affordances.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T00:04:44.52270228+01:00","updated_at":"2025-12-18T20:46:27.818190801+01:00","closed_at":"2025-12-18T20:46:27.818192563+01:00","dependencies":[{"issue_id":"SafetySecretary-xg8.2","depends_on_id":"SafetySecretary-xg8","type":"parent-child","created_at":"2025-12-12T00:04:44.523384458+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-xg8.2","depends_on_id":"SafetySecretary-xg8.1","type":"blocks","created_at":"2025-12-12T00:05:35.623262081+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-xg8.3","title":"Refactor phases to shared sheet components","description":"Make Guided and Workspace views use same underlying sheet/row editors and command bar.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:04:47.594123717+01:00","updated_at":"2025-12-18T22:56:37.720927859+01:00","closed_at":"2025-12-18T22:56:37.720929345+01:00","dependencies":[{"issue_id":"SafetySecretary-xg8.3","depends_on_id":"SafetySecretary-xg8","type":"parent-child","created_at":"2025-12-12T00:04:47.594833407+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-xg8.3","depends_on_id":"SafetySecretary-xg8.2","type":"blocks","created_at":"2025-12-12T00:05:35.636220585+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-xg8.4","title":"Prototype browser TUI spreadsheet view","description":"Build an optional terminal-like, keyboard-driven table UI (feature-flagged). Compare usability with polished sheet UI.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:04:51.483927438+01:00","updated_at":"2025-12-18T23:00:53.819107792+01:00","closed_at":"2025-12-18T23:00:53.819109281+01:00","dependencies":[{"issue_id":"SafetySecretary-xg8.4","depends_on_id":"SafetySecretary-xg8","type":"parent-child","created_at":"2025-12-12T00:04:51.484686649+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-xg8.4","depends_on_id":"SafetySecretary-xg8.2","type":"blocks","created_at":"2025-12-12T00:05:35.648148411+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-xg8.5","title":"Converge on final UI and polish","description":"Pick best patterns from sheet/TUI prototypes, apply consistently, and do a style/spacing pass.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:04:54.616667089+01:00","updated_at":"2025-12-18T23:02:55.049845938+01:00","closed_at":"2025-12-18T23:02:55.049847402+01:00","dependencies":[{"issue_id":"SafetySecretary-xg8.5","depends_on_id":"SafetySecretary-xg8","type":"parent-child","created_at":"2025-12-12T00:04:54.617326667+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-xg8.5","depends_on_id":"SafetySecretary-xg8.3","type":"blocks","created_at":"2025-12-12T00:05:35.660825697+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-xg8.5","depends_on_id":"SafetySecretary-xg8.4","type":"blocks","created_at":"2025-12-12T00:05:35.672880127+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-xpj","title":"Testing","description":"1. Test that stale clients are pruned after threshold","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.667017493+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-y9f","title":"Problem Statement","description":"Several service methods execute queries in loops:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.695253365+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-z0d","title":"TUI fork: separate entry + WebTUI HIRA sample","description":"Create a separate TUI frontend entry powered by WebTUI while keeping the existing GUI and light/dark themes intact.\nScope in this phase is a sample: TUI Home + HIRA only, with a post-auth switch between GUl and TUI.\nThis establishes the architecture for later expansion to JHA/Incidents without global CSS collisions.","design":"Approach:\n- Separate HTML entry (tui.html) + boot file (src/tui/main.tsx) so WebTUI CSS only affects the TUI bundle.\n- Keep current ThemeContext and light/dark tokens for GUI; bridge theme to WebTUI using data-webtui-theme.\n- Provide a switch button after auth to navigate between / and /tui without duplicating auth flow.\n- Reuse existing data providers and API calls; re-skin UI in TUI-specific components.","acceptance_criteria":"- Normal UI continues to render unchanged with existing light/dark themes.\n- New TUI entry loads after auth and shows TUI Home + HIRA sample.\n- Switching between GUI and TUI works via links and preserves session.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-21T20:59:16.915379259+01:00","updated_at":"2025-12-21T21:04:57.095106866+01:00","labels":["architecture","frontend","tui"],"comments":[{"id":53,"issue_id":"SafetySecretary-z0d","author":"oliver","text":"Background/intent:\n- WebTUI's CSS applies to global elements (button, input, table, html/body). A single-SPA route would cause collisions.\n- A second entry point isolates CSS, preserves existing light/dark themes, and allows a radically different TUI layout.\n- Initial scope is HIRA only to validate UX + CSS approach before extending to other modules.\n\nConstraints:\n- Keep existing ThemeContext behavior for GUI.\n- Avoid modifying global GUI CSS for TUI layout.\n- Auth/session flow should be shared (no separate login for TUI).\n","created_at":"2025-12-21T20:00:19Z"}]}
{"id":"SafetySecretary-z0d.1","title":"Capture TUI fork decisions + scope","description":"Capture key architectural decisions and scope boundaries for the TUI fork to prevent rework.\nIncludes URL scheme, entrypoint strategy, and explicit non-goals for the first sample.","design":"Record decisions in the issue itself (and later in docs if needed):\n- Use multi-page Vite build with tui.html and a /tui route in production (served via rewrite).\n- Define TUI route map (/, /hira, /cases/:id) and BrowserRouter basename rules.\n- TUI Home + HIRA only in Phase 1.\n- Switch via links after auth, no additional auth screens.","acceptance_criteria":"- Decision notes captured in this issue and referenced by downstream tasks.\n- Dependencies and non-goals are explicit.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:00:53.70119691+01:00","updated_at":"2025-12-21T22:16:00.43241811+01:00","closed_at":"2025-12-21T22:16:00.432419944+01:00","labels":["planning","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.1","depends_on_id":"SafetySecretary-z0d","type":"parent-child","created_at":"2025-12-21T21:00:53.701909898+01:00","created_by":"oliver"}],"comments":[{"id":54,"issue_id":"SafetySecretary-z0d.1","author":"oliver","text":"Reasoning recap:\n- Separate entry avoids global CSS conflicts with WebTUI.\n- Phase 1 is deliberately small (TUI Home + HIRA) to validate UX and data reuse.\n- Later expansion to JHA/Incidents will follow once TUI styling and layout are proven.\n","created_at":"2025-12-21T20:00:58Z"}]}
{"id":"SafetySecretary-z0d.10","title":"Phase 2: TUI Incidents landing + shell","description":"Extend the TUI fork to cover Incidents (landing + case shell) after sample approval.","design":"- Mirror the HIRA TUI structure for Incidents while reusing IncidentProvider.","acceptance_criteria":"- Incident TUI entry loads and renders case data.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T21:09:45.471888893+01:00","updated_at":"2025-12-21T21:09:45.471888893+01:00","labels":["incident","phase2","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.10","depends_on_id":"SafetySecretary-z0d","type":"parent-child","created_at":"2025-12-21T21:09:45.473079858+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.10","depends_on_id":"SafetySecretary-z0d.8","type":"blocks","created_at":"2025-12-21T21:12:03.184552655+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.11","title":"Phase 2: TUI cross-module nav polish","description":"Polish cross-module navigation inside the TUI fork once JHA/Incidents are added.","design":"- Add a consistent TUI top-level nav (HIRA/JHA/Incidents) with WebTUI buttons.\n- Keep navigation consistent across TUI pages.","acceptance_criteria":"- Users can jump between TUI modules from a consistent nav.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T21:09:57.588400841+01:00","updated_at":"2025-12-21T21:09:57.588400841+01:00","labels":["phase2","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.11","depends_on_id":"SafetySecretary-z0d","type":"parent-child","created_at":"2025-12-21T21:09:57.58910039+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.11","depends_on_id":"SafetySecretary-z0d.9","type":"blocks","created_at":"2025-12-21T21:12:11.500989072+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.11","depends_on_id":"SafetySecretary-z0d.10","type":"blocks","created_at":"2025-12-21T21:12:16.609286157+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.2","title":"Add TUI entrypoint + multi-page build","description":"Add a new TUI HTML entry and boot sequence so the TUI has its own CSS stack.\nThis is the foundation for all TUI work and must not alter the existing GUI entry.","design":"Implementation notes:\n- Add frontend/tui.html with a root div and script to /src/tui/main.tsx.\n- Add a new boot file that wraps providers (Theme, I18n, Auth) and renders TuiApp.\n- Update Vite config to include both index.html and tui.html in build inputs.","acceptance_criteria":"- `npm run build --prefix frontend` outputs both entries.\n- GUI entry remains unchanged.\n- TUI entry loads and renders a basic shell component.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:01:03.886980052+01:00","updated_at":"2025-12-21T22:19:25.726519117+01:00","closed_at":"2025-12-21T22:19:25.726520767+01:00","labels":["build","frontend","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.2","depends_on_id":"SafetySecretary-z0d","type":"parent-child","created_at":"2025-12-21T21:01:03.887715588+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.2","depends_on_id":"SafetySecretary-z0d.1","type":"blocks","created_at":"2025-12-21T21:10:13.65115919+01:00","created_by":"oliver"}],"comments":[{"id":55,"issue_id":"SafetySecretary-z0d.2","author":"oliver","text":"Notes:\n- This task unblocks all other TUI work. Treat as a foundation layer.\n- Do not import WebTUI CSS into the main entry.\n","created_at":"2025-12-21T20:01:44Z"}]}
{"id":"SafetySecretary-z0d.2.1","title":"Create tui.html entry","description":"Create frontend/tui.html mirroring index.html but pointing to the TUI boot file.","design":"- Keep markup minimal: \u003cdiv id=\"root\"\u003e\u003c/div\u003e + \u003cscript type=\"module\" src=\"/src/tui/main.tsx\"\u003e\u003c/script\u003e.\n- Title can be \"SafetySecretary TUI\" to differentiate.","acceptance_criteria":"- tui.html exists and loads without console errors.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:05:31.697144486+01:00","updated_at":"2025-12-21T22:16:33.434706536+01:00","closed_at":"2025-12-21T22:16:33.434708275+01:00","labels":["frontend","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.2.1","depends_on_id":"SafetySecretary-z0d.2","type":"parent-child","created_at":"2025-12-21T21:05:31.697874336+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.2.2","title":"Add TUI boot + minimal TuiApp","description":"Create src/tui/main.tsx and a minimal TuiApp component.","design":"- Reuse existing providers (ThemeProvider, I18nProvider).\n- Ensure AuthGate works in TUI entry (include /login route or redirect to GUI login).\n- Set BrowserRouter basename to /tui if production routes are hosted under /tui.\n- New TuiApp should render a placeholder shell and route structure.","acceptance_criteria":"- TUI entry renders a basic page in dev and build.\n- Unauthenticated users are redirected to a valid login route.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:05:43.392413105+01:00","updated_at":"2025-12-21T22:18:07.02680907+01:00","closed_at":"2025-12-21T22:18:07.026810848+01:00","labels":["frontend","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.2.2","depends_on_id":"SafetySecretary-z0d.2","type":"parent-child","created_at":"2025-12-21T21:05:43.393493529+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.2.3","title":"Wire Vite multi-page inputs","description":"Update Vite config to build multi-page output (index.html + tui.html).","design":"- Set build.rollupOptions.input with both HTML files.\n- Ensure dev server can serve /tui.html.","acceptance_criteria":"- `vite build` produces both HTML outputs.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:05:54.733721049+01:00","updated_at":"2025-12-21T22:18:58.432210632+01:00","closed_at":"2025-12-21T22:18:58.43221234+01:00","labels":["build","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.2.3","depends_on_id":"SafetySecretary-z0d.2","type":"parent-child","created_at":"2025-12-21T21:05:54.734856593+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.2.3","depends_on_id":"SafetySecretary-z0d.2.1","type":"blocks","created_at":"2025-12-21T21:19:26.971673184+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.2.4","title":"Add dev rewrite for /tui","description":"Ensure /tui resolves to the TUI entry during local development.","design":"- Add a Vite dev server rewrite or middleware mapping /tui to /tui.html.\n- Keep the switch links pointing to /tui so the URL is consistent between dev/prod.","acceptance_criteria":"- Visiting /tui in dev loads the TUI entry without manual .html suffix.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:18:09.179010765+01:00","updated_at":"2025-12-21T22:19:16.910357081+01:00","closed_at":"2025-12-21T22:19:16.910358827+01:00","labels":["build","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.2.4","depends_on_id":"SafetySecretary-z0d.2","type":"parent-child","created_at":"2025-12-21T21:18:09.179770883+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.2.4","depends_on_id":"SafetySecretary-z0d.2.3","type":"blocks","created_at":"2025-12-21T21:19:32.07243696+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.2.4","depends_on_id":"SafetySecretary-z0d.2.1","type":"blocks","created_at":"2025-12-21T21:19:46.004083718+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.3","title":"Integrate WebTUI CSS + theme bridge","description":"Integrate WebTUI CSS into the TUI entry only and bridge ThemeContext to data-webtui-theme.\nKeeps GUI theming intact while enabling TUI theming.","design":"- Create src/tui/tui.css with WebTUI layer order + imports.\n- Ensure WebTUI CSS is only referenced by TUI boot file.\n- Add a small theme bridge that maps ThemeContext (light/dark) to data-webtui-theme.","acceptance_criteria":"- TUI entry uses WebTUI styles without impacting GUI entry.\n- Theme toggle updates WebTUI colors.","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-21T21:03:03.441915144+01:00","updated_at":"2025-12-21T22:19:35.22464059+01:00","labels":["frontend","tui","webtui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.3","depends_on_id":"SafetySecretary-z0d","type":"parent-child","created_at":"2025-12-21T21:03:03.442593626+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.3","depends_on_id":"SafetySecretary-z0d.2","type":"blocks","created_at":"2025-12-21T21:10:18.761109027+01:00","created_by":"oliver"}],"comments":[{"id":56,"issue_id":"SafetySecretary-z0d.3","author":"oliver","text":"Considerations:\n- WebTUI base styles apply to html/body and global elements; keep them isolated to the TUI entry.\n- Import only required modules (base, button, typography, table, input, box) to avoid CSS bloat.\n- Use data-webtui-theme on \u003chtml\u003e for clean theme switching without rewriting WebTUI vars.\n","created_at":"2025-12-21T20:03:08Z"}]}
{"id":"SafetySecretary-z0d.3.1","title":"Create tui.css with WebTUI imports","description":"Create tui.css with WebTUI layer ordering and selected component imports.","design":"- Declare @layer base, utils, components before imports.\n- Import base + selected components (button, typography, table, input, box).","acceptance_criteria":"- TUI entry renders with WebTUI base styling.","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-21T21:03:13.62469351+01:00","updated_at":"2025-12-21T22:25:16.731964112+01:00","labels":["tui","webtui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.3.1","depends_on_id":"SafetySecretary-z0d.3","type":"parent-child","created_at":"2025-12-21T21:03:13.625686203+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.3.1","depends_on_id":"SafetySecretary-z0d.3.4","type":"blocks","created_at":"2025-12-21T21:19:21.871665228+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.3.2","title":"Bridge ThemeContext to WebTUI theme attr","description":"Bridge ThemeContext to data-webtui-theme on \u003chtml\u003e.","design":"- Use a small TUI-only effect hook to set documentElement attribute.\n- Do not change ThemeContext logic itself.","acceptance_criteria":"- Theme toggle updates WebTUI theme attribute.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:06:05.027015387+01:00","updated_at":"2025-12-21T21:06:05.027015387+01:00","labels":["theme","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.3.2","depends_on_id":"SafetySecretary-z0d.3","type":"parent-child","created_at":"2025-12-21T21:06:05.02782897+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.3.3","title":"Add minimal TUI layout overrides","description":"Add minimal TUI layout overrides in tui.css.","design":"- Keep overrides scoped to .tui-shell or a TUI root wrapper.\n- Provide layout helpers (spacing, grid) without recreating GUI styles.","acceptance_criteria":"- TUI layout is usable without impacting GUI CSS.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:06:15.069491807+01:00","updated_at":"2025-12-21T21:06:15.069491807+01:00","labels":["css","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.3.3","depends_on_id":"SafetySecretary-z0d.3","type":"parent-child","created_at":"2025-12-21T21:06:15.070226427+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.3.4","title":"Add WebTUI CSS dependency","description":"Add the WebTUI CSS package dependency to the frontend.","design":"- Install @webtui/css in frontend/package.json.\n- Update package-lock.json accordingly.","acceptance_criteria":"- @webtui/css appears in frontend dependencies and lockfile.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T21:17:43.599686289+01:00","updated_at":"2025-12-21T22:25:06.358268691+01:00","closed_at":"2025-12-21T22:25:06.35827037+01:00","labels":["tui","webtui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.3.4","depends_on_id":"SafetySecretary-z0d.3","type":"parent-child","created_at":"2025-12-21T21:17:43.600445121+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.4","title":"Implement TUI Home + UI switch links","description":"Build the TUI Home screen and add a post-auth switch to normal UI.\nThis is the primary entry for the sample experience.","design":"- TUI Home shows app title, short intro, and CTA to HIRA TUI.\n- Add a \"Switch to GUI\" link pointing to /.\n- In the normal GUI, add a \"Switch to TUI\" link (after auth) pointing to /tui.","acceptance_criteria":"- Authenticated users can move between / and /tui via explicit buttons.\n- TUI Home uses WebTUI components (box-, typography, button styles).","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:06:27.173707346+01:00","updated_at":"2025-12-21T21:06:27.173707346+01:00","labels":["frontend","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.4","depends_on_id":"SafetySecretary-z0d","type":"parent-child","created_at":"2025-12-21T21:06:27.174931191+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.4","depends_on_id":"SafetySecretary-z0d.2","type":"blocks","created_at":"2025-12-21T21:10:23.877355657+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.4","depends_on_id":"SafetySecretary-z0d.3","type":"blocks","created_at":"2025-12-21T21:10:45.475424501+01:00","created_by":"oliver"}],"comments":[{"id":57,"issue_id":"SafetySecretary-z0d.4","author":"oliver","text":"UX notes:\n- Switch should be visible post-auth to avoid confusing unauthenticated users.\n- No deep-linking complexity: simple navigation to / or /tui is sufficient for the sample.\n","created_at":"2025-12-21T20:06:37Z"}]}
{"id":"SafetySecretary-z0d.4.1","title":"Build TUI Home screen","description":"Create a TUI Home page component with WebTUI layout.","design":"- Use WebTUI box- and typography to present a terminal-style hero.\\n- Include HIRA CTA button and short bullet list of features.\\n- Include ThemeToggle for light/dark parity.","acceptance_criteria":"- TUI Home renders consistently in light/dark WebTUI themes.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:06:48.363263498+01:00","updated_at":"2025-12-21T21:17:31.995457119+01:00","labels":["tui","ui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.4.1","depends_on_id":"SafetySecretary-z0d.4","type":"parent-child","created_at":"2025-12-21T21:06:48.364033994+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.4.2","title":"Add switch-to-GUI link in TUI","description":"Add a \"Switch to GUI\" link on TUI Home (and optionally TUI header).","design":"- Link to / with window.location or react-router link.\n- If viewing a specific HIRA case, map to the equivalent GUI route when possible.\n- Keep label explicit: \"Switch to GUI\" or similar.","acceptance_criteria":"- Users can return to the normal UI from TUI without logging in again.\n- Case-level switch preserves the case ID when possible.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:06:58.661229873+01:00","updated_at":"2025-12-21T21:16:19.634818537+01:00","labels":["tui","ui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.4.2","depends_on_id":"SafetySecretary-z0d.4","type":"parent-child","created_at":"2025-12-21T21:06:58.66235175+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.4.3","title":"Add switch-to-TUI link in GUI","description":"Add a \"Switch to TUI\" button in the GUI post-auth area (HomeLanding and/or topbar).","design":"- Place the button near Theme/User menu on HomeLanding.\n- If viewing a specific HIRA case, map to the equivalent TUI route when possible.\n- Consider also placing in workspace topbar for quick access.","acceptance_criteria":"- Authenticated GUI users can open /tui.\n- Case-level switch preserves the case ID when possible.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:07:08.743082913+01:00","updated_at":"2025-12-21T21:16:30.005707255+01:00","labels":["tui","ui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.4.3","depends_on_id":"SafetySecretary-z0d.4","type":"parent-child","created_at":"2025-12-21T21:07:08.744198771+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.5","title":"Implement TUI HIRA landing + shell","description":"Create the HIRA experience in TUI form (landing + case shell) using existing data providers.","design":"- Reuse RaProvider and existing API hooks.\n- Build a TUI-specific shell that uses WebTUI components instead of the GUI layout.\n- Keep interactions simple: primary goal is visual + structural sample, not full parity.","acceptance_criteria":"- TUI HIRA routes load and display data.\n- No regressions to GUI HIRA.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:07:19.750860562+01:00","updated_at":"2025-12-21T21:07:19.750860562+01:00","labels":["hira","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.5","depends_on_id":"SafetySecretary-z0d","type":"parent-child","created_at":"2025-12-21T21:07:19.751581222+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.5","depends_on_id":"SafetySecretary-z0d.2","type":"blocks","created_at":"2025-12-21T21:10:50.575425893+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.5","depends_on_id":"SafetySecretary-z0d.3","type":"blocks","created_at":"2025-12-21T21:10:55.676574031+01:00","created_by":"oliver"}],"comments":[{"id":58,"issue_id":"SafetySecretary-z0d.5","author":"oliver","text":"Scope reminder:\n- This phase targets HIRA only. JHA and Incidents are future tasks gated by the sample review.\n- Focus on layout + reuse of data flows, not feature parity.\n","created_at":"2025-12-21T20:07:28Z"}]}
{"id":"SafetySecretary-z0d.5.1","title":"Build TUI HIRA landing","description":"Create a TUI HIRA landing page that lists recent cases or provides a \"load/create\" path.","design":"- Reuse data from existing CaseLanding if possible, but present in WebTUI layout.\n- Provide CTA to open /tui/cases/:id (or equivalent).","acceptance_criteria":"- Users can navigate from TUI Home into TUI HIRA landing and into a case.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:07:39.308617338+01:00","updated_at":"2025-12-21T21:07:39.308617338+01:00","labels":["hira","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.5.1","depends_on_id":"SafetySecretary-z0d.5","type":"parent-child","created_at":"2025-12-21T21:07:39.309596247+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.5.2","title":"Build TUI HIRA case shell","description":"Create a TUI HIRA case shell that renders the RA editor inside a TUI layout.","design":"- Wrap RaEditor in a TUI shell that uses WebTUI components for top-level layout.\n- Avoid changing RaEditor internals in this phase unless necessary.","acceptance_criteria":"- Existing RA functionality remains available in the TUI shell.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:07:50.289191358+01:00","updated_at":"2025-12-21T21:07:50.289191358+01:00","labels":["hira","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.5.2","depends_on_id":"SafetySecretary-z0d.5","type":"parent-child","created_at":"2025-12-21T21:07:50.289986237+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.5.3","title":"Add minimal TUI HIRA navigation","description":"Add minimal TUI navigation between HIRA views (guided/table/matrix/actions) or keep a single view for the sample.","design":"- Use WebTUI button styles and monospace layout.\n- Keep scope small; the goal is to demonstrate feasibility, not full TUI UX.","acceptance_criteria":"- HIRA case view is usable for a light demo.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T21:08:01.461643011+01:00","updated_at":"2025-12-21T21:08:01.461643011+01:00","labels":["hira","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.5.3","depends_on_id":"SafetySecretary-z0d.5","type":"parent-child","created_at":"2025-12-21T21:08:01.462411974+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.5.3","depends_on_id":"SafetySecretary-z0d.5.2","type":"blocks","created_at":"2025-12-21T21:19:51.104847293+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.6","title":"Remove legacy in-app TUI view","description":"Remove the legacy browser TUI prototype and styles from the GUI now that the TUI fork exists and is approved.","design":"- Gate removal on the TUI sample signoff.\n- Remove BrowserTuiSpreadsheetView and its route/button in RaEditor.\n- Delete the .tui-* block in index.css.\n- Update translations/hotkeys if TUI view is removed from GUI.","acceptance_criteria":"- GUI no longer exposes the old TUI view after signoff.\n- No .tui-* styles remain in GUI CSS.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:08:12.032125104+01:00","updated_at":"2025-12-21T21:16:41.205360108+01:00","labels":["cleanup","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.6","depends_on_id":"SafetySecretary-z0d","type":"parent-child","created_at":"2025-12-21T21:08:12.032878647+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.6","depends_on_id":"SafetySecretary-z0d.8","type":"blocks","created_at":"2025-12-21T21:18:39.411660098+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.6.1","title":"Remove GUI TUI view route/button","description":"Remove the \"TUI\" view button and view option in RaEditor.","design":"- Remove workspaceView \"tui\" and any related hotkey mapping.","acceptance_criteria":"- GUI no longer routes to the TUI spreadsheet view.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:08:22.31599434+01:00","updated_at":"2025-12-21T21:08:22.31599434+01:00","labels":["cleanup","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.6.1","depends_on_id":"SafetySecretary-z0d.6","type":"parent-child","created_at":"2025-12-21T21:08:22.316741579+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.6.2","title":"Remove .tui-* styles from GUI CSS","description":"Delete the \"Browser TUI prototype\" CSS in frontend/src/index.css.","design":"- Remove .tui-* block only; leave other styles untouched.","acceptance_criteria":"- No unused .tui-* selectors in GUI CSS.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:08:32.27155179+01:00","updated_at":"2025-12-21T21:08:32.27155179+01:00","labels":["cleanup","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.6.2","depends_on_id":"SafetySecretary-z0d.6","type":"parent-child","created_at":"2025-12-21T21:08:32.272281358+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.6.3","title":"Clean up GUI TUI labels/hotkeys","description":"Update translations/hotkeys that reference the GUI TUI view.","design":"- Remove \"viewTui\" label and hotkey mapping if no longer used.","acceptance_criteria":"- No stale TUI text remains in GUI UI strings.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:08:43.515948413+01:00","updated_at":"2025-12-21T21:08:43.515948413+01:00","labels":["cleanup","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.6.3","depends_on_id":"SafetySecretary-z0d.6","type":"parent-child","created_at":"2025-12-21T21:08:43.516757391+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.7","title":"Document TUI entry + QA checklist","description":"Document how to access the TUI entry and validate basic flows.","design":"- Add a short note in README or quickstart about /tui.\n- Document hosting rewrite: /tui -\u003e tui.html (or equivalent for CDN/static host).\n- List manual checks: auth, switch links, HIRA load, theme toggle.","acceptance_criteria":"- Documentation covers TUI entry usage and hosting requirements.\n- QA checklist exists.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:08:55.117591163+01:00","updated_at":"2025-12-21T21:16:51.585501392+01:00","labels":["docs","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.7","depends_on_id":"SafetySecretary-z0d","type":"parent-child","created_at":"2025-12-21T21:08:55.118542297+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.7","depends_on_id":"SafetySecretary-z0d.4","type":"blocks","created_at":"2025-12-21T21:11:26.736421134+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.7","depends_on_id":"SafetySecretary-z0d.5","type":"blocks","created_at":"2025-12-21T21:11:31.844512896+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.7.1","title":"Document TUI entry URL","description":"Add README/quickstart notes for the TUI entry URL.","design":"- Mention /tui.html for dev and /tui for prod.\n- Call out the need for a rewrite (e.g., /tui -\u003e /tui.html).","acceptance_criteria":"- Docs mention the TUI entry and the rewrite requirement.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:09:04.835182434+01:00","updated_at":"2025-12-21T21:17:03.018299495+01:00","labels":["docs","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.7.1","depends_on_id":"SafetySecretary-z0d.7","type":"parent-child","created_at":"2025-12-21T21:09:04.835917248+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.7.2","title":"Write TUI sample QA checklist","description":"Create a manual QA checklist for the sample TUI.","design":"- Verify auth, switch to GUI, load HIRA case, and theme toggle.","acceptance_criteria":"- QA checklist captured in docs or in the issue.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:09:14.639560485+01:00","updated_at":"2025-12-21T21:09:14.639560485+01:00","labels":["qa","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.7.2","depends_on_id":"SafetySecretary-z0d.7","type":"parent-child","created_at":"2025-12-21T21:09:14.640281106+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.8","title":"TUI sample signoff checkpoint","description":"Checkpoint for reviewing the TUI sample before expanding to other modules.","design":"- Stakeholder review of TUI Home + HIRA layout, theme, and switching.\n- Capture follow-up UX or design requests.","acceptance_criteria":"- Decision recorded: proceed to Phase 2 or iterate on sample.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T21:09:24.684839823+01:00","updated_at":"2025-12-21T21:09:24.684839823+01:00","labels":["review","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.8","depends_on_id":"SafetySecretary-z0d","type":"parent-child","created_at":"2025-12-21T21:09:24.68557832+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.8","depends_on_id":"SafetySecretary-z0d.7","type":"blocks","created_at":"2025-12-21T21:11:49.476101898+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z0d.9","title":"Phase 2: TUI JHA landing + shell","description":"Extend the TUI fork to cover JHA (landing + case shell) after sample approval.","design":"- Mirror the HIRA TUI structure for JHA while reusing JhaProvider.\n- Keep WebTUI layout consistent with HIRA TUI.","acceptance_criteria":"- JHA TUI entry loads and renders case data.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T21:09:35.132730213+01:00","updated_at":"2025-12-21T21:09:35.132730213+01:00","labels":["jha","phase2","tui"],"dependencies":[{"issue_id":"SafetySecretary-z0d.9","depends_on_id":"SafetySecretary-z0d","type":"parent-child","created_at":"2025-12-21T21:09:35.133465645+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-z0d.9","depends_on_id":"SafetySecretary-z0d.8","type":"blocks","created_at":"2025-12-21T21:11:58.07657958+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-z7w","title":"Testing","description":"1. Test that production rejects when ALLOWED_ORIGINS is empty","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.676501993+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"SafetySecretary-za8","title":"Environment Configuration","description":"Document required environment variable:","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T20:57:58.675550157+01:00","updated_at":"2025-12-21T21:07:32.737148759+01:00","close_reason":"Closed","deleted_at":"2025-12-21T21:07:32.737148759+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
