{"id":"SafetySecretary-20z","title":"Finalize beads team workflow","description":"Decide whether to commit .beads config, set sync.branch, and run bd doctor --fix so all work stays in beads.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:05:17.906084634+01:00","updated_at":"2025-12-18T21:19:43.164911344+01:00","closed_at":"2025-12-18T21:19:43.164912826+01:00"}
{"id":"SafetySecretary-3zf","title":"Photo/attachment support per step","description":"Allow uploading pictures, associating them to steps/hazards, ordering, and showing in reports.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-12T00:03:45.094086047+01:00","updated_at":"2025-12-18T22:06:28.280385078+01:00","closed_at":"2025-12-18T22:06:28.280386683+01:00"}
{"id":"SafetySecretary-3zf.1","title":"Add Attachment model + migration","description":"Prisma model for images/attachments linked to case+optional step/hazard, with ordering.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:04:59.371626075+01:00","updated_at":"2025-12-18T20:39:16.348601112+01:00","closed_at":"2025-12-18T20:39:16.34860277+01:00","dependencies":[{"issue_id":"SafetySecretary-3zf.1","depends_on_id":"SafetySecretary-3zf","type":"parent-child","created_at":"2025-12-12T00:04:59.372259457+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-3zf.2","title":"Upload/download attachment API (local disk MVP)","description":"Implement POST /attachments with multer, serve /uploads, and endpoints to assign to steps/hazards.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:05:03.467479271+01:00","updated_at":"2025-12-18T21:07:58.552407834+01:00","closed_at":"2025-12-18T21:07:58.552409551+01:00","dependencies":[{"issue_id":"SafetySecretary-3zf.2","depends_on_id":"SafetySecretary-3zf","type":"parent-child","created_at":"2025-12-12T00:05:03.468294269+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-3zf.2","depends_on_id":"SafetySecretary-8u2.6","type":"blocks","created_at":"2025-12-18T19:17:51.798210106+01:00","created_by":"import"}]}
{"id":"SafetySecretary-3zf.3","title":"Frontend photos panel + drag assignment","description":"Per-step photo strip, upload button, drag/drop to steps, caption/order.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T00:05:07.252825288+01:00","updated_at":"2025-12-18T22:05:59.848129402+01:00","closed_at":"2025-12-18T22:05:59.848130952+01:00","dependencies":[{"issue_id":"SafetySecretary-3zf.3","depends_on_id":"SafetySecretary-3zf","type":"parent-child","created_at":"2025-12-12T00:05:07.253551149+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-41v","title":"Frontend tiles landing + routing updates","description":"","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T22:51:22.455270774+01:00","updated_at":"2025-12-20T22:51:22.455270774+01:00","comments":[{"id":3,"issue_id":"SafetySecretary-41v","author":"oliver","text":"Replace root landing with tile-based navigation (HIRA/JHA/II), keep HIRA landing at a new route, update routes and navigation targets.","created_at":"2025-12-20T21:51:30Z"}]}
{"id":"SafetySecretary-4uq","title":"Project memory: HIRA table-first vision + key decisions","description":"Use this issue as the living 'memory'/context log for the project so future sessions don't lose the north star. Update this bead when we make a structural decision.\\n\\nCurrent context (confirmed):\\n- The Excel HIRA template is the conceptual model: its column headers/structure drive the DB schema and UI views (not necessarily exporting back into the .xlsm).\\n- The product is a workflow to help users fill the HIRA table; the LLM assists with language processing (first typed, later voice/TTS), not a gatekeeper.\\n- Hazards are per-step rows (Teilprozess context). The same hazard family can appear in multiple steps, but each occurrence is a separate hazard row with its own controls/ratings/actions.\\n- Target relationships: 1 step → many hazards; 1 hazard(row) → many actions.\\n\\nHow we’ll use this:\\n- Add/append 'Decisions' with date + rationale.\\n- Add 'Open questions' that should become beads.\\n- Link to key docs/plan sections when relevant.","acceptance_criteria":"- This bead remains updated with major decisions\\n- New sessions can read it and regain context quickly","notes":"2025-12-12 — Ratings scales (from template):\\n\\nSeverity (5-level):\\n1) First aid\\n2) Medical treatment (no lost time)\\n3) Lost time injury\\n4) Irreversible injury\\n5) Death\\n\\nLikelihood (5-level, 1=highest likelihood → 5=lowest):\\n1) Certain to occur (common/repeating; occurs regularly)\\n2) Likely to occur (known to occur; happened \u003e1x)\\n3) Possible to occur (could occur; happened once)\\n4) Unlikely to occur (could occur but not likely; known in industry)\\n5) Extremely unlikely (practically impossible; exceptional; unknown locally but possible in industry)\\n\\nRisk evaluation uses template scheme for now, with acceptance bands and guidance:\\n- Extreme risk: Treat; approve Station Manager; stop immediately; mitigate now.\\n- High risk: Treat; approve Unit/Dpt Head/BL leader; mitigate 1–3 weeks.\\n- Moderate risk: Treat or tolerate based on review (ALARP); mitigate 1–3 months.\\n- Minor risk: Tolerate; approve Supervisors; monitor controls.\\n- Negligible risk: Tolerate; approve Supervisors; monitor controls.\\n\\nLikelihood estimation considerations: exposure, technique/environment, awareness/leadership.\n\n2025-12-18 — Decisions:\n- Hazards are step-scoped rows: DB uses `Hazard.stepId` + `Hazard.orderIndex` (legacy `HazardStep` removed); migration splits multi-step hazards into per-step rows. See `docs/hazard_row_model.md`.\n- Attachments MVP: `Attachment` model with local-disk storage (`SAFETYSECRETARY_ATTACHMENTS_DIR`, `SAFETYSECRETARY_ATTACHMENT_MAX_BYTES`); API under `/api/ra-cases/:id/attachments` and per-step photo upload + drag/reorder UI.\n- Exports: XLSX export better matches the template and includes a Photos sheet from attachments.\n- LLM UX: Global contextual input supports a clarification loop; voice dictation via Web Speech API.\n- Beads workflow: sync branch is `beads-sync`; `bd sync` requires network access.","status":"closed","priority":0,"issue_type":"chore","created_at":"2025-12-12T12:31:06.163726876+01:00","updated_at":"2025-12-18T22:09:06.969110485+01:00","closed_at":"2025-12-18T22:09:06.969112098+01:00"}
{"id":"SafetySecretary-4uq.1","title":"(Optional) Keep memory bead curated","description":"When major decisions occur, append to SafetySecretary-4uq. Convert open questions into beads.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T12:58:27.949665187+01:00","updated_at":"2025-12-18T22:08:56.834334756+01:00","closed_at":"2025-12-18T22:08:56.834336307+01:00","dependencies":[{"issue_id":"SafetySecretary-4uq.1","depends_on_id":"SafetySecretary-4uq","type":"parent-child","created_at":"2025-12-12T12:58:27.950221198+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-5rf","title":"JHA API routes + LLM extraction + exports + attachments","description":"","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T22:51:04.723012808+01:00","updated_at":"2025-12-20T22:51:04.723012808+01:00","dependencies":[{"issue_id":"SafetySecretary-5rf","depends_on_id":"SafetySecretary-8r4","type":"blocks","created_at":"2025-12-20T22:51:55.551101874+01:00","created_by":"oliver"}],"comments":[{"id":2,"issue_id":"SafetySecretary-5rf","author":"oliver","text":"Add /api/jha-cases router (CRUD, extract rows), hook into LLM service/job manager, add JHA PDF/XLSX export in ReportService, and JHA attachments router mirroring HIRA behavior.","created_at":"2025-12-20T21:51:14Z"}]}
{"id":"SafetySecretary-653","title":"UX polish + clarity sweep","description":"Background:\n- Several UX polish items remain: category editing, label consistency, matrix settings propagation, and copy clarity.\n\nGoal:\n- Improve clarity and premium feel by removing small inconsistencies.\n\nScope:\n- Hazard category affordances, risk matrix settings propagation, landing page copy.\n\nAcceptance (epic-level):\n- Small polish items addressed without breaking core workflows.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-20T21:51:08.299371275+01:00","updated_at":"2025-12-20T21:51:08.299371275+01:00"}
{"id":"SafetySecretary-653.1","title":"Hazard category UX: edit + label consistency","description":"Background:\n- Hazard identification phase shows category as read-only label.\n- Workspace table shows raw category codes instead of labels.\n\nGoal:\n- Allow category editing in hazard identification.\n- Display labels consistently across views.\n\nAcceptance:\n- Category is editable in hazard identification.\n- Workspace shows labels (optionally with code in tooltip).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T21:51:18.339082535+01:00","updated_at":"2025-12-20T21:51:18.339082535+01:00","dependencies":[{"issue_id":"SafetySecretary-653.1","depends_on_id":"SafetySecretary-653","type":"parent-child","created_at":"2025-12-20T21:51:18.339833451+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-653.2","title":"Risk matrix settings propagation to workspace","description":"Background:\n- Workspace risk pills read matrix settings once and do not react to changes.\n\nGoal:\n- Make workspace risk color pills respond to settings changes (e.g., storage events).\n\nAcceptance:\n- Updating matrix settings updates workspace risk colors without reload.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T21:51:28.170156022+01:00","updated_at":"2025-12-20T21:51:28.170156022+01:00","dependencies":[{"issue_id":"SafetySecretary-653.2","depends_on_id":"SafetySecretary-653","type":"parent-child","created_at":"2025-12-20T21:51:28.170935447+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-653.3","title":"Landing copy + recent cases semantics","description":"Background:\n- Landing page says \"These entries stay in your browser\" but data is server-backed.\n- Delete copy implies only local removal.\n\nGoal:\n- Clarify where cases are stored and what delete does.\n\nAcceptance:\n- Copy accurately reflects server-backed cases.\n- Delete confirmation warns about permanent removal.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T21:51:37.746661422+01:00","updated_at":"2025-12-20T21:51:37.746661422+01:00","dependencies":[{"issue_id":"SafetySecretary-653.3","depends_on_id":"SafetySecretary-653","type":"parent-child","created_at":"2025-12-20T21:51:37.748165335+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-653.4","title":"Terminology/label consistency pass","description":"Background:\n- Save/Continue/Autosave wording varies by phase, sometimes conflicting with actual behavior.\n\nGoal:\n- Standardize terminology after persistence policy is set.\n\nAcceptance:\n- Consistent labels and helper text across phases.\n- Wording matches actual persistence behavior.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T21:51:47.7818813+01:00","updated_at":"2025-12-20T21:51:47.7818813+01:00","dependencies":[{"issue_id":"SafetySecretary-653.4","depends_on_id":"SafetySecretary-653","type":"parent-child","created_at":"2025-12-20T21:51:47.782565083+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-653.4","depends_on_id":"SafetySecretary-hp8.1","type":"blocks","created_at":"2025-12-20T21:51:57.061136457+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-7ka","title":"JHA frontend landing + editor + attachments","description":"","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T22:51:38.442575119+01:00","updated_at":"2025-12-20T22:51:38.442575119+01:00","dependencies":[{"issue_id":"SafetySecretary-7ka","depends_on_id":"SafetySecretary-5rf","type":"blocks","created_at":"2025-12-20T22:52:03.739804925+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-7ka","depends_on_id":"SafetySecretary-41v","type":"blocks","created_at":"2025-12-20T22:52:11.495326444+01:00","created_by":"oliver"}],"comments":[{"id":4,"issue_id":"SafetySecretary-7ka","author":"oliver","text":"Build JHA create/load page, JHA editor with LLM-assisted row generation and editable table (step/hazard/consequence/controls), sign-off fields, and photo uploads tied to JHA steps/hazards.","created_at":"2025-12-20T21:51:47Z"}]}
{"id":"SafetySecretary-7zz","title":"Meeting-room LLM assistant (written + spoken)","description":"Make it possible for a group to think out loud and have the HIRA table fill iteratively via text and voice.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-12T00:03:37.960141309+01:00","updated_at":"2025-12-18T21:20:51.915401695+01:00","closed_at":"2025-12-18T21:20:51.915403212+01:00"}
{"id":"SafetySecretary-7zz.1","title":"Refine prompts \u0026 command schemas","description":"Tighten LLM prompts for steps/hazards/controls/actions + contextual updates; ensure deterministic JSON.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T00:04:26.704139793+01:00","updated_at":"2025-12-18T20:35:47.591114535+01:00","closed_at":"2025-12-18T20:35:47.591116284+01:00","dependencies":[{"issue_id":"SafetySecretary-7zz.1","depends_on_id":"SafetySecretary-7zz","type":"parent-child","created_at":"2025-12-12T00:04:26.704890089+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-7zz.1","depends_on_id":"SafetySecretary-8u2.2","type":"blocks","created_at":"2025-12-12T00:05:39.427609256+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-7zz.2","title":"Clarification loop UX","description":"If parse returns needsClarification, capture follow-up and re-parse/apply cleanly.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:04:30.004781248+01:00","updated_at":"2025-12-18T20:32:23.788953567+01:00","closed_at":"2025-12-18T20:32:23.788955139+01:00","dependencies":[{"issue_id":"SafetySecretary-7zz.2","depends_on_id":"SafetySecretary-7zz","type":"parent-child","created_at":"2025-12-12T00:04:30.005468673+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-7zz.3","title":"Voice input MVP → contextual updates","description":"Add mic controls using browser STT, stream transcript into GlobalLLMInput/phase notes, parse/apply iteratively.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:04:33.156399667+01:00","updated_at":"2025-12-18T20:52:10.695793238+01:00","closed_at":"2025-12-18T20:52:10.695810672+01:00","dependencies":[{"issue_id":"SafetySecretary-7zz.3","depends_on_id":"SafetySecretary-7zz","type":"parent-child","created_at":"2025-12-12T00:04:33.157108914+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-7zz.4","title":"Decide realtime multi-user scope","description":"Confirm whether v1 needs WebSocket multi-device editing or facilitator-only editing.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T00:04:36.436788141+01:00","updated_at":"2025-12-18T20:48:11.9697027+01:00","closed_at":"2025-12-18T20:48:11.969704295+01:00","dependencies":[{"issue_id":"SafetySecretary-7zz.4","depends_on_id":"SafetySecretary-7zz","type":"parent-child","created_at":"2025-12-12T00:04:36.437590354+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-8r4","title":"JHA data model + service foundation","description":"","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T22:50:43.808138879+01:00","updated_at":"2025-12-20T22:50:43.808138879+01:00","comments":[{"id":1,"issue_id":"SafetySecretary-8r4","author":"oliver","text":"Add Prisma models for JHA (case/step/hazard/attachment), migration SQL, backend types, and JhaService CRUD helpers. Keep schema separate from HIRA but reuse patterns (orderIndex, cascades).","created_at":"2025-12-20T21:50:57Z"}]}
{"id":"SafetySecretary-8u2","title":"Core stabilization \u0026 ratings correctness","description":"Stabilize DB/model and fix rating persistence/mapping before bigger features.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-12T00:03:33.518113166+01:00","updated_at":"2025-12-18T22:26:20.897002435+01:00","closed_at":"2025-12-18T22:26:20.897003835+01:00"}
{"id":"SafetySecretary-8u2.1","title":"Add strict severity/likelihood validation","description":"Enforce allowed values end-to-end. Prefer Prisma enums + migration, or Zod validation if migration risk is high.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T00:04:05.400955488+01:00","updated_at":"2025-12-12T11:48:11.094269945+01:00","closed_at":"2025-12-12T11:48:11.094273125+01:00","dependencies":[{"issue_id":"SafetySecretary-8u2.1","depends_on_id":"SafetySecretary-8u2","type":"parent-child","created_at":"2025-12-12T00:04:05.401593325+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-8u2.2","title":"Fix LLM contextual state to include ratings","description":"Frontend and backend tableState should include baseline/residual snapshots so updates like 'make that high' work.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T00:04:10.021655415+01:00","updated_at":"2025-12-12T11:48:15.818595029+01:00","closed_at":"2025-12-12T11:48:15.81859841+01:00","dependencies":[{"issue_id":"SafetySecretary-8u2.2","depends_on_id":"SafetySecretary-8u2","type":"parent-child","created_at":"2025-12-12T00:04:10.022310571+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-8u2.3","title":"Harden contextual apply endpoint","description":"Normalize/validate action status, category codes, step indices; return clear errors instead of silent no-ops.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T00:04:14.723537292+01:00","updated_at":"2025-12-12T11:48:15.792138266+01:00","closed_at":"2025-12-12T11:48:15.792140607+01:00","dependencies":[{"issue_id":"SafetySecretary-8u2.3","depends_on_id":"SafetySecretary-8u2","type":"parent-child","created_at":"2025-12-12T00:04:14.724333801+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-8u2.4","title":"Standardize baseline/residual naming","description":"Remove duplicate baselineAssessment/residualAssessment fields; keep one canonical name across backend+frontend.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:04:18.929065435+01:00","updated_at":"2025-12-18T20:28:25.937216656+01:00","closed_at":"2025-12-18T20:28:25.937218492+01:00","dependencies":[{"issue_id":"SafetySecretary-8u2.4","depends_on_id":"SafetySecretary-8u2","type":"parent-child","created_at":"2025-12-12T00:04:18.929985507+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-8u2.5","title":"Regression tests for ratings persistence","description":"Add backend+frontend tests to ensure severity/likelihood save/load and matrix counts match hazards.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:04:22.713917222+01:00","updated_at":"2025-12-18T19:50:44.857931992+01:00","closed_at":"2025-12-18T19:50:44.857933783+01:00","dependencies":[{"issue_id":"SafetySecretary-8u2.5","depends_on_id":"SafetySecretary-8u2","type":"parent-child","created_at":"2025-12-12T00:04:22.71460826+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-8u2.5","depends_on_id":"SafetySecretary-8u2.1","type":"blocks","created_at":"2025-12-12T00:05:39.414228607+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-8u2.6","title":"Backend: case-scoped write hardening","description":"Audit and fix backend write paths so every mutation is scoped to the case. Validate that step/hazard/control/action IDs belong to the case before updating/deleting; avoid cross-case updates via guessed IDs.","acceptance_criteria":"- All write operations verify case ownership for nested IDs\\n- Attempted cross-case mutations return 400/404\\n- Add/extend tests to cover at least one cross-case attempt","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T19:14:18.056570417+01:00","updated_at":"2025-12-18T20:22:24.918848461+01:00","closed_at":"2025-12-18T20:22:24.918850302+01:00","dependencies":[{"issue_id":"SafetySecretary-8u2.6","depends_on_id":"SafetySecretary-8u2","type":"parent-child","created_at":"2025-12-18T19:17:51.799702161+01:00","created_by":"import"}]}
{"id":"SafetySecretary-8u2.7","title":"Frontend: align LLM job typing with backend","description":"Update frontend LlmJobResponse typing to match backend job types (steps/hazards/controls/actions) and ensure polling code tolerates unknown types.","acceptance_criteria":"- frontend/src/lib/jobs.ts type union matches backend\\n- No TS type lies around controls/actions jobs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T19:14:18.08937659+01:00","updated_at":"2025-12-18T20:24:53.659147565+01:00","closed_at":"2025-12-18T20:24:53.659149025+01:00","dependencies":[{"issue_id":"SafetySecretary-8u2.7","depends_on_id":"SafetySecretary-8u2","type":"parent-child","created_at":"2025-12-18T19:17:51.80049166+01:00","created_by":"import"}]}
{"id":"SafetySecretary-8u2.8","title":"Backend: make LLM jobs durable (or explicitly ephemeral)","description":"Decide and implement a durable job strategy for LLM extractions. Options: persist job state/results in DB, or keep in-memory but make UI/UX explicitly resilient to restarts (clear messaging + retry).","acceptance_criteria":"- Behavior on server restart is defined and acceptable\\n- If durable: job state persists and /api/llm-jobs/:id survives restart\\n- If ephemeral: frontend handles missing jobs gracefully and can re-run","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T19:14:18.122189698+01:00","updated_at":"2025-12-18T22:25:57.127474702+01:00","closed_at":"2025-12-18T22:25:57.127476468+01:00","dependencies":[{"issue_id":"SafetySecretary-8u2.8","depends_on_id":"SafetySecretary-8u2","type":"parent-child","created_at":"2025-12-18T19:17:51.801276399+01:00","created_by":"import"},{"issue_id":"SafetySecretary-8u2.8","depends_on_id":"SafetySecretary-91x.5","type":"blocks","created_at":"2025-12-18T19:17:51.802039331+01:00","created_by":"import"}]}
{"id":"SafetySecretary-91x","title":"Model: hazards are per-step HIRA rows","description":"Decision: hazards are not global. Each hazard record represents one HIRA table row in a specific process step (Teilprozess). Same hazard family can appear in multiple steps, but those are separate hazard rows with different controls/ratings/actions.\\n\\nImplication: current multi-step hazard linking (HazardStep join + hazard.stepIds) is the wrong abstraction; controls/ratings should not be shared across steps.\\n\\nGoal: enforce 1 step → many hazards, and 1 hazard → many actions.\\n\\nOut of scope for this epic: global hazard taxonomy/entities beyond category codes.","acceptance_criteria":"- Data model enforces hazard belongs to exactly one step\\n- Existing controls and baseline/residual ratings are unambiguous per hazard row\\n- UI/LLM flows operate on hazard rows without cross-step coupling\\n- Exports reflect per-step hazard rows","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-12T12:27:09.499884224+01:00","updated_at":"2025-12-18T22:22:53.00557038+01:00","closed_at":"2025-12-18T22:22:53.005571835+01:00"}
{"id":"SafetySecretary-91x.1","title":"Exports: ensure table rows match step-scoped hazards","description":"Confirm PDF/XLSX export iterates hazards per step (row semantics) and includes correct controls/ratings/actions.","acceptance_criteria":"- Export output reflects per-step hazard rows","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T12:27:26.908706792+01:00","updated_at":"2025-12-18T22:22:44.224041172+01:00","closed_at":"2025-12-18T22:22:44.224042872+01:00","dependencies":[{"issue_id":"SafetySecretary-91x.1","depends_on_id":"SafetySecretary-91x","type":"parent-child","created_at":"2025-12-12T12:27:26.909462939+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-91x.2","title":"Schema design: hazard belongs to one step","description":"Propose Prisma schema changes to make hazards step-scoped rows. Likely remove HazardStep join and add hazard.stepId + hazard.orderIndex (within step) to support reorder. Clarify how actions link (remain action.hazardId).","acceptance_criteria":"- Chosen schema supports reorder within step\\n- No remaining way for a single hazard row to span multiple steps","notes":"Schema must support:\\n- hazard rows belong to exactly one step but can be moved/copied to another step\\n- hazard row stores: categoryCode (SUVA taxonomy), short label, hazard description, consequences, persons at risk\\n- separate fields for mandatory requirements vs other recommended measures vs effectiveness/contributing factors narrative\\n- baseline assessment separate from residual; residual optional until mitigations defined\\n- actions can be hazard-linked or global (hazardId nullable)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T12:27:26.957142556+01:00","updated_at":"2025-12-18T21:53:43.001432838+01:00","closed_at":"2025-12-18T21:53:43.001434399+01:00","dependencies":[{"issue_id":"SafetySecretary-91x.2","depends_on_id":"SafetySecretary-91x","type":"parent-child","created_at":"2025-12-12T12:27:26.957920005+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-91x.3","title":"Frontend updates: hazards per step (row model)","description":"Update UI state/types to treat hazards as step-scoped rows. Remove any UI paths that assign one hazard to multiple steps. Keep grouping-by-step behavior.","acceptance_criteria":"- UI can add multiple hazards per step\\n- No UI flow links one hazard to multiple steps","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:27:27.004681613+01:00","updated_at":"2025-12-18T22:22:06.728180441+01:00","closed_at":"2025-12-18T22:22:06.72818213+01:00","dependencies":[{"issue_id":"SafetySecretary-91x.3","depends_on_id":"SafetySecretary-91x","type":"parent-child","created_at":"2025-12-12T12:27:27.005334493+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-91x.4","title":"Migration plan: convert existing multi-step hazards","description":"Define data migration strategy for existing cases: if a hazard is linked to multiple steps, split into multiple hazard rows (one per step) copying label/description/category/existingControls and duplicating assessments/actions appropriately (or prompting user).","acceptance_criteria":"- Migration rules documented for splitting hazards\\n- No data loss or silent merging","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T12:27:27.060886888+01:00","updated_at":"2025-12-18T21:55:32.997658027+01:00","closed_at":"2025-12-18T21:55:32.997659513+01:00","dependencies":[{"issue_id":"SafetySecretary-91x.4","depends_on_id":"SafetySecretary-91x","type":"parent-child","created_at":"2025-12-12T12:27:27.061987298+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-91x.5","title":"Backend updates: services/routes to new hazard model","description":"Update RiskAssessmentService and API routes to create/update/delete/reorder hazards within a single step without hazard.stepIds/HazardStep. Ensure validation stays strict.","acceptance_criteria":"- API supports add/edit/delete/reorder hazards per step\\n- Ratings/actions still work","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:27:27.108029072+01:00","updated_at":"2025-12-18T22:21:57.901231647+01:00","closed_at":"2025-12-18T22:21:57.901233343+01:00","dependencies":[{"issue_id":"SafetySecretary-91x.5","depends_on_id":"SafetySecretary-91x","type":"parent-child","created_at":"2025-12-12T12:27:27.108802058+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-91x.5","depends_on_id":"SafetySecretary-8u2.6","type":"blocks","created_at":"2025-12-18T19:17:51.803041883+01:00","created_by":"import"}]}
{"id":"SafetySecretary-91x.6","title":"LLM/contextual update: operate on hazard rows","description":"Update contextual parse/apply schema and prompts so commands reference hazard rows (which already imply a step). Remove/ignore commands that try to set hazard.stepIds.","acceptance_criteria":"- Natural-language updates never reassign a hazard row across steps\\n- Commands can add hazard to a specified step","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:27:27.157127552+01:00","updated_at":"2025-12-18T22:22:22.723854651+01:00","closed_at":"2025-12-18T22:22:22.723860166+01:00","dependencies":[{"issue_id":"SafetySecretary-91x.6","depends_on_id":"SafetySecretary-91x","type":"parent-child","created_at":"2025-12-12T12:27:27.157803206+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-edg","title":"Action management parity across views","description":"Background:\n- Actions are split across Action Plan and Workspace views with different editing capabilities.\n- Action Plan shows description read-only; Workspace lacks due/status editing and delete.\n\nGoal:\n- Make action editing consistent and complete in at least one primary view.\n- Reduce confusion and make action maintenance fast and predictable.\n\nScope:\n- Editing description/owner/due/status, delete, reorder, add actions.\n- RaContext and API support for these edits.\n\nAcceptance (epic-level):\n- Users can fully manage actions in a single consistent pattern.\n- No essential field is locked in one view and editable in another.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-20T21:48:04.905503504+01:00","updated_at":"2025-12-20T21:48:04.905503504+01:00"}
{"id":"SafetySecretary-edg.1","title":"Define canonical action editing behavior","description":"Background:\n- Action fields are editable in different ways in different places.\n\nGoal:\n- Define a canonical action editing pattern (fields, autosave vs explicit, delete/reorder behavior).\n\nDeliverable:\n- A short spec that names the canonical view and the exact interaction model.\n\nAcceptance:\n- Spec published in repo (doc or issue comment).\n- Clear decisions on edit fields, autosave, delete confirmation/undo, and reorder.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T21:48:16.070765087+01:00","updated_at":"2025-12-20T21:48:16.070765087+01:00","dependencies":[{"issue_id":"SafetySecretary-edg.1","depends_on_id":"SafetySecretary-edg","type":"parent-child","created_at":"2025-12-20T21:48:16.071531944+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-edg.2","title":"RaContext/API support for action delete + field coverage","description":"Background:\n- UI cannot delete actions today; RaContext lacks a delete action.\n\nGoal:\n- Ensure RaContext and API support full CRUD for actions as per the canonical spec.\n\nScope:\n- Add delete action API usage if missing.\n- Confirm update supports status/owner/due/description across views.\n\nAcceptance:\n- RaContext exposes add/update/delete/reorder actions.\n- UI can call delete with proper confirmation and error handling.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T21:48:27.02399179+01:00","updated_at":"2025-12-20T21:48:27.02399179+01:00","dependencies":[{"issue_id":"SafetySecretary-edg.2","depends_on_id":"SafetySecretary-edg","type":"parent-child","created_at":"2025-12-20T21:48:27.024798209+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-edg.2","depends_on_id":"SafetySecretary-edg.1","type":"blocks","created_at":"2025-12-20T21:48:57.995293776+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-edg.3","title":"Action Plan view: full CRUD + reorder UX","description":"Background:\n- Action Plan view shows action description read-only and has no delete.\n\nGoal:\n- Enable full CRUD in the Action Plan view using the canonical editing pattern.\n\nScope:\n- Inline editing of description, owner, due date, status.\n- Delete with confirm/undo (per spec).\n- Reorder remains consistent with other views.\n\nAcceptance:\n- All action fields are editable in Action Plan.\n- Delete is available and safe.\n- Save/error feedback is consistent with the global pattern.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T21:48:37.988115369+01:00","updated_at":"2025-12-20T21:48:37.988115369+01:00","dependencies":[{"issue_id":"SafetySecretary-edg.3","depends_on_id":"SafetySecretary-edg","type":"parent-child","created_at":"2025-12-20T21:48:37.988892408+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-edg.3","depends_on_id":"SafetySecretary-edg.1","type":"blocks","created_at":"2025-12-20T21:49:06.140450303+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-edg.3","depends_on_id":"SafetySecretary-edg.2","type":"blocks","created_at":"2025-12-20T21:49:14.687021819+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-edg.4","title":"Workspace table: action editor parity","description":"Background:\n- Workspace table lacks due/status edits and delete for actions.\n\nGoal:\n- Bring Workspace action editing to parity with the canonical pattern.\n\nScope:\n- Edit description, owner, due date, status.\n- Delete with confirmation/undo.\n- Keep add-action flow consistent with the Action Plan view.\n\nAcceptance:\n- Workspace supports full action editing with clear feedback.\n- No action fields are locked only in one view.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T21:48:47.730041503+01:00","updated_at":"2025-12-20T21:48:47.730041503+01:00","dependencies":[{"issue_id":"SafetySecretary-edg.4","depends_on_id":"SafetySecretary-edg","type":"parent-child","created_at":"2025-12-20T21:48:47.730708088+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-edg.4","depends_on_id":"SafetySecretary-edg.1","type":"blocks","created_at":"2025-12-20T21:49:23.18758712+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-edg.4","depends_on_id":"SafetySecretary-edg.2","type":"blocks","created_at":"2025-12-20T21:49:30.971067871+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-edg.5","title":"Action Plan: show hazards without actions + inline add","description":"Background:\n- Action Plan currently hides hazards with zero actions and shows only a global add form, which obscures coverage gaps.\n\nGoal:\n- Make the Action Plan view reveal hazards with no actions and support quick, in-context add.\n\nScope:\n- Show empty hazards within step groups.\n- Provide inline \"Add action\" row per hazard (or equivalent shortcut) aligned with canonical editing behavior.\n\nAcceptance:\n- Users can see which hazards have no actions without switching views.\n- Adding an action from the hazard context requires minimal clicks and preserves hazard context.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T21:55:58.195202384+01:00","updated_at":"2025-12-20T21:55:58.195202384+01:00","dependencies":[{"issue_id":"SafetySecretary-edg.5","depends_on_id":"SafetySecretary-edg","type":"parent-child","created_at":"2025-12-20T21:55:58.195891028+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-edg.5","depends_on_id":"SafetySecretary-edg.3","type":"blocks","created_at":"2025-12-20T21:56:06.408041614+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-hp8","title":"Workflow save semantics + data integrity","description":"Background:\n- The workflow currently mixes draft-only editing (steps) with autosave (hazards/ratings), and the top-bar \"Save\" only refreshes.\n- This creates silent data-loss risk and breaks user trust in what is actually persisted.\n\nGoal:\n- Establish a single, explicit persistence policy and enforce it across phases.\n- Ensure users never lose edits when navigating or advancing phases.\n\nScope:\n- Steps, hazards, ratings, controls, actions.\n- Navigation/phase advance, view switching, and the top-bar Save/Refresh affordance.\n\nOut of scope:\n- Large UI re-skinning or new editor components.\n\nWhy this matters:\n- The product promise is \"premium and reliable\"; data loss and ambiguous save states undermine that.\n- Consistent persistence rules reduce cognitive load and support faster, keyboard-first work.\n\nAcceptance (epic-level):\n- Unified persistence policy defined and applied in the product.\n- No edits are lost when moving between phases or views.\n- Save/Refresh affordances match actual behavior.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-20T21:44:19.751012872+01:00","updated_at":"2025-12-20T21:44:19.751012872+01:00"}
{"id":"SafetySecretary-hp8.1","title":"Define unified persistence + dirty-state policy","description":"Background:\n- Steps are edited as drafts with a manual Save; other entities autosave on blur/change.\n- Users can advance phases or switch views without saving steps, losing edits.\n- The top-bar \"Save\" button performs a refresh, not a save.\n\nDecision points:\n- Autosave vs explicit Save/Cancel for steps (and any other remaining drafts).\n- Dirty state signals (global + per-row) and what counts as \"dirty\".\n- Navigation guards: when to block, warn, or allow discard.\n- How \"Save\" in the top bar should behave and be labeled.\n\nDeliverable:\n- A short written policy (1-2 pages) that maps each entity and phase to the chosen interaction model.\n- A checklist for UI updates to enforce the policy.\n\nConsiderations:\n- Align with docs/ui_interaction_model.md unless there is a deliberate reason to diverge.\n- Prefer consistency over per-view customization.\n\nAcceptance:\n- Policy written and shared in repo (doc or issue comment).\n- Clear decisions for steps, hazards, actions, ratings, controls, and navigation.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T21:45:14.058966845+01:00","updated_at":"2025-12-20T21:45:14.058966845+01:00","dependencies":[{"issue_id":"SafetySecretary-hp8.1","depends_on_id":"SafetySecretary-hp8","type":"parent-child","created_at":"2025-12-20T21:45:14.062020264+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-hp8.2","title":"Process steps persistence + navigation guard","description":"Background:\n- PhaseProcessSteps stores edits only in local state until \"Save steps\".\n- \"Continue\" does not persist, and view switching can drop edits.\n\nGoal:\n- Make step edits durable per the policy (autosave or explicit Save with guard).\n- Prevent silent loss when advancing or changing views.\n\nScope:\n- PhaseProcessSteps editing, reorder, and add/remove actions.\n- Step persistence endpoint usage and error handling.\n- Navigation guard behavior in this phase.\n\nAcceptance:\n- Step edits are persisted according to policy.\n- Reordering is persisted or clearly indicated as unsaved.\n- Users are warned or blocked from losing unsaved edits.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T21:45:19.169600683+01:00","updated_at":"2025-12-20T21:45:19.169600683+01:00","dependencies":[{"issue_id":"SafetySecretary-hp8.2","depends_on_id":"SafetySecretary-hp8","type":"parent-child","created_at":"2025-12-20T21:45:19.170294851+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-hp8.2","depends_on_id":"SafetySecretary-hp8.1","type":"blocks","created_at":"2025-12-20T21:46:50.35836068+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-hp8.2.1","title":"Steps: dirty tracking + navigation guard","description":"Background:\n- Steps are draft-only; no dirty-state indicator exists.\n\nGoal:\n- Add explicit dirty tracking for steps so the user sees unsaved edits.\n- Ensure navigation/phase change behavior matches the unified policy.\n\nImplementation notes:\n- Track dirty state at row and phase level.\n- Use confirm dialog or inline banner before leaving with unsaved changes.\n\nAcceptance:\n- Dirty indicator visible when step edits are pending.\n- Navigation/phase advance follows the policy (warn/block/auto-save).","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T21:45:24.271105391+01:00","updated_at":"2025-12-20T21:45:24.271105391+01:00","dependencies":[{"issue_id":"SafetySecretary-hp8.2.1","depends_on_id":"SafetySecretary-hp8.2","type":"parent-child","created_at":"2025-12-20T21:45:24.271929153+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-hp8.2.2","title":"Steps: persist edits + reorder","description":"Background:\n- Step edits are not persisted until manual Save.\n\nGoal:\n- Persist step edits and reorders per policy.\n\nImplementation notes:\n- Autosave: persist on blur/debounce and on reorder.\n- Explicit save: retain draft but ensure Save is required and visible.\n\nAcceptance:\n- Step create/edit/reorder persists per policy.\n- Errors surface to the user with a retry path.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T21:46:16.360880622+01:00","updated_at":"2025-12-20T21:46:16.360880622+01:00","dependencies":[{"issue_id":"SafetySecretary-hp8.2.2","depends_on_id":"SafetySecretary-hp8.2","type":"parent-child","created_at":"2025-12-20T21:46:16.362911558+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-hp8.3","title":"Top-bar Save semantics (refresh vs save-all)","description":"Background:\n- The top-bar \"Save\" button only calls refresh (GET), which is misleading.\n\nGoal:\n- Align label and behavior with the unified policy.\n\nOptions:\n- Rename to \"Refresh\" if autosave is the standard.\n- Or implement a true \"Save all drafts\" action if drafts remain.\n\nAcceptance:\n- Button label and behavior are consistent and unambiguous.\n- If any drafts exist, button reliably persists them.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T21:46:27.253958804+01:00","updated_at":"2025-12-20T21:46:27.253958804+01:00","dependencies":[{"issue_id":"SafetySecretary-hp8.3","depends_on_id":"SafetySecretary-hp8","type":"parent-child","created_at":"2025-12-20T21:46:27.254634632+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-hp8.3","depends_on_id":"SafetySecretary-hp8.1","type":"blocks","created_at":"2025-12-20T21:47:43.314225037+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-hp8.4","title":"Unified save/error feedback pattern","description":"Background:\n- Autosave status messaging is inconsistent across phases and sometimes missing error handling.\n- Some flows show \"Saving...\" even when no request is sent, and failures can be silent.\n\nGoal:\n- Provide a shared save/error indicator pattern and apply it consistently.\n\nScope:\n- Autosave/edit flows in PhaseHazardNarrative, PhaseRiskRating, PhaseControls, PhaseControlsActions, and WorkspaceTableView.\n- Status messaging (Saving/Saved/Error), retry affordances, and cancel/undo copy.\n\nAcceptance:\n- All autosave paths surface errors and never show \"Saved\" without a real request.\n- Status messaging is consistent across phases/views and uses shared UI pattern.\n- Users have a clear recovery path (retry/undo) on failure.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T21:46:38.472542418+01:00","updated_at":"2025-12-20T21:55:46.754608168+01:00","dependencies":[{"issue_id":"SafetySecretary-hp8.4","depends_on_id":"SafetySecretary-hp8","type":"parent-child","created_at":"2025-12-20T21:46:38.47423729+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-hp8.4","depends_on_id":"SafetySecretary-hp8.1","type":"blocks","created_at":"2025-12-20T21:47:52.434461035+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-hsc","title":"Exports polish toward 'good looks like' template","description":"Improve PDF/XLSX outputs to match the structure/clarity of HIRA Template SWP.xlsm (not exact ranges/macros).","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-12T00:03:49.433636781+01:00","updated_at":"2025-12-18T21:20:37.489178772+01:00","closed_at":"2025-12-18T21:20:37.489180549+01:00"}
{"id":"SafetySecretary-hsc.1","title":"Dissect HIRA template and map to data","description":"Review HIRA Template SWP.xlsm to lock target column/section structure and any missing fields.","notes":"Template column mapping extracted from user text (simplify Swissport/Airline wording, keep structure):\\n- Step: N°, Activity description (incl equipment/tools/materials/substances).\\n- Hazard ID: hazard code/category, hazard type/label, hazard description, potential consequences, person(s) at risk.\\n- Existing requirements \u0026 controls: mandatory H\u0026S requirements; other recommended preventive/control measures.\\n- Effectiveness (separate column): how effectively existing measures are implemented locally + frequent contributing factors.\\n- Baseline risk evaluation: likelihood, severity, risk level.\\n- Mitigation: action headlines / recommendations to mitigate (details live in Action Plan).\\n- Residual risk: likelihood, severity, risk level.\\n- Monitoring: measures to monitor/review residual risk + responsibility.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T00:05:11.247268008+01:00","updated_at":"2025-12-18T20:55:44.03160381+01:00","closed_at":"2025-12-18T20:55:44.031605342+01:00","dependencies":[{"issue_id":"SafetySecretary-hsc.1","depends_on_id":"SafetySecretary-hsc","type":"parent-child","created_at":"2025-12-12T00:05:11.247976855+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-hsc.2","title":"Improve XLSX/PDF outputs to match target structure","description":"Add missing columns/formatting, include photos when present, add UI Excel export button.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:05:14.638147711+01:00","updated_at":"2025-12-18T21:15:30.643909781+01:00","closed_at":"2025-12-18T21:15:30.643912336+01:00","dependencies":[{"issue_id":"SafetySecretary-hsc.2","depends_on_id":"SafetySecretary-hsc","type":"parent-child","created_at":"2025-12-12T00:05:14.638840595+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-ouu","title":"Align severity/likelihood scales + risk bands to HIRA template","description":"Replace current LOW/MEDIUM/HIGH/CRITICAL + RARE/UNLIKELY/... with the HIRA template's 5×5 severity/likelihood scales and risk acceptance bands (Extreme/High/Moderate/Minor/Negligible), including guidance metadata (treat/tolerate, approvals, timescales).","acceptance_criteria":"- UI dropdowns use template scales\\n- Backend validation/enums match template scales\\n- Risk band computed exactly per template\\n- Exports show the same labels as the template","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-12T12:58:28.008312196+01:00","updated_at":"2025-12-18T22:45:55.661469228+01:00","closed_at":"2025-12-18T22:45:55.661470853+01:00"}
{"id":"SafetySecretary-ouu.1","title":"Exports: show template risk bands + guidance","description":"Update PDF/XLSX outputs to show severity/likelihood labels and risk band, and optionally the treat/tolerate guidance.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T12:58:38.660943322+01:00","updated_at":"2025-12-18T22:45:50.567937211+01:00","closed_at":"2025-12-18T22:45:50.567938757+01:00","dependencies":[{"issue_id":"SafetySecretary-ouu.1","depends_on_id":"SafetySecretary-ouu","type":"parent-child","created_at":"2025-12-12T12:58:38.661418457+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-ouu.2","title":"Backend: update validation + types for new scales","description":"Update enums/types/validation so severity and likelihood values match the template scales, and store computed risk band. Keep baseline/residual separate.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:58:38.687416731+01:00","updated_at":"2025-12-18T22:45:40.383469148+01:00","closed_at":"2025-12-18T22:45:40.383470612+01:00","dependencies":[{"issue_id":"SafetySecretary-ouu.2","depends_on_id":"SafetySecretary-ouu","type":"parent-child","created_at":"2025-12-12T12:58:38.68790744+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-ouu.3","title":"Confirm risk matrix mapping (5x5)","description":"Extract or encode the exact mapping from (severity, likelihood) to risk band (Extreme/High/Moderate/Minor/Negligible) from the template. Decide whether it's a lookup table or formula + thresholds.","acceptance_criteria":"- Mapping is explicitly defined (table or formula)\\n- Unit tests cover all combinations or key thresholds","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T12:58:38.713519359+01:00","updated_at":"2025-12-18T22:12:19.43972485+01:00","closed_at":"2025-12-18T22:12:19.439726642+01:00","dependencies":[{"issue_id":"SafetySecretary-ouu.3","depends_on_id":"SafetySecretary-ouu","type":"parent-child","created_at":"2025-12-12T12:58:38.713985764+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-ouu.4","title":"Frontend: update risk rating UI to template scales","description":"Update dropdowns/labels and risk display (band + guidance) to use template scales. Ensure baseline can exist without residual.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:58:38.740755165+01:00","updated_at":"2025-12-18T22:45:45.473836946+01:00","closed_at":"2025-12-18T22:45:45.473838342+01:00","dependencies":[{"issue_id":"SafetySecretary-ouu.4","depends_on_id":"SafetySecretary-ouu","type":"parent-child","created_at":"2025-12-12T12:58:38.741232543+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-q5l","title":"Multi-tenant auth + user management (beta)","description":"Background:\n- SafetySecretary is moving from single-user MVP to multi-org beta tests.\n- Users must be isolated by organization with no cross-contamination of data or attachments.\n- Login is org slug + username + password; admin creates accounts; no self-serve password yet.\n\nGoal:\n- Deliver a secure, reliable beta user management system aligned with the product vision: privacy, trust, and operational clarity for safety teams.\n\nScope:\n- Separate Postgres DB per org (strict isolation).\n- Registry (control-plane) DB for orgs/users/roles/session/audit.\n- Auth middleware + login/logout + rate limiting/lockout.\n- Admin UI + CLI for org provisioning and account management.\n- Login page + user menu + settings stubs.\n- Attachment encryption + per-org storage root.\n\nOut of scope:\n- Self-serve password reset.\n- SSO or enterprise IdP integration.\n- Fine-grained RBAC beyond owner/admin/member.\n\nAcceptance (epic-level):\n- Org data and attachments are isolated at DB and storage layers.\n- Users can log in with org slug + username + password and remain logged in with remember-me.\n- Admin can provision orgs and users via UI or CLI.\n- UI exposes user menu and settings stubs without breaking existing workflows.","status":"open","priority":0,"issue_type":"epic","created_at":"2025-12-20T22:16:57.242072779+01:00","updated_at":"2025-12-20T22:16:57.242072779+01:00"}
{"id":"SafetySecretary-q5l.1","title":"Auth decision log (lockout TTL, session TTL, slug rules, admin access)","description":"Background:\n- Final auth behavior depends on a few policy choices that affect user experience and security posture.\n\nDecisions needed:\n- Lockout duration after 5 failed attempts (time-based vs admin-only unlock).\n- Session TTL for non-remember sessions.\n- Org slug format rules (case, allowed characters).\n- Admin UI access policy (global platform admin vs IP allowlist).\n\nWhy now:\n- These choices drive backend behavior, validation, and frontend messaging.\n\nAcceptance:\n- Documented decisions and defaults.\n- Linked to implementation tasks that need the choices.","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-20T22:17:08.825253249+01:00","updated_at":"2025-12-20T22:17:08.825253249+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.1","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:17:08.826809216+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.10","title":"Admin CLI: org provisioning + migrations","description":"Background:\n- Beta needs a reliable out-of-band provisioning path for org DBs.\n\nScope:\n- CLI command to create org in registry and provision tenant DB.\n- CLI command to run tenant migrations and report status.\n- CLI command to reset user passwords and unlock accounts.\n\nAcceptance:\n- CLI can create orgs, provision DBs, and run migrations.\n- CLI can reset passwords/unlock users.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T22:18:47.436708331+01:00","updated_at":"2025-12-20T22:18:47.436708331+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.10","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:18:47.437377007+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.10","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:22:57.256307842+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.10","depends_on_id":"SafetySecretary-q5l.3","type":"blocks","created_at":"2025-12-20T22:23:06.867242353+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.10","depends_on_id":"SafetySecretary-q5l.6","type":"blocks","created_at":"2025-12-20T22:23:15.689487459+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.10","depends_on_id":"SafetySecretary-q5l.20","type":"blocks","created_at":"2025-12-20T22:28:27.176175956+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.11","title":"Frontend: login page (org slug + username + password)","description":"Background:\n- Users require a dedicated login screen before accessing cases.\n\nScope:\n- Simple login page with org slug, username, password, remember-me checkbox.\n- Error messages for invalid credentials and remaining attempts.\n- Redirect to app after login.\n\nAcceptance:\n- Login page works end-to-end with backend auth.\n- Errors are user-friendly and include remaining attempts when relevant.","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-20T22:18:59.080223278+01:00","updated_at":"2025-12-20T22:18:59.080223278+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.11","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:18:59.081010685+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.11","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:23:26.965948194+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.11","depends_on_id":"SafetySecretary-q5l.7","type":"blocks","created_at":"2025-12-20T22:23:36.293543552+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.11","depends_on_id":"SafetySecretary-q5l.1","type":"blocks","created_at":"2025-12-20T22:28:36.103982912+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.12","title":"Frontend: route protection + auth bootstrap","description":"Background:\n- The app currently assumes unauthenticated access.\n\nScope:\n- Global auth check on app load.\n- Redirect unauthenticated users to login.\n- Store minimal user/org metadata for UI display.\n\nAcceptance:\n- All app routes require auth.\n- Users are redirected to login when session expires.","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-20T22:19:12.081025196+01:00","updated_at":"2025-12-20T22:19:12.081025196+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.12","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:19:12.081725678+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.12","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:23:44.473014798+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.12","depends_on_id":"SafetySecretary-q5l.4","type":"blocks","created_at":"2025-12-20T22:25:42.547215912+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.12","depends_on_id":"SafetySecretary-q5l.21","type":"blocks","created_at":"2025-12-20T22:29:03.039613143+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.13","title":"Frontend: user menu + settings stubs","description":"Background:\n- Users need a clear account entry point for settings and future features.\n\nScope:\n- User menu showing org + username + role.\n- Theme toggle (existing) surfaced here.\n- Stub sections for API key input and sub-accounts (disabled or informational).\n- Basic account info view (email, display name) with read-only fields for beta.\n- Guidance for contacting admin for account changes or lockouts.\n\nAcceptance:\n- User menu accessible on main app shell.\n- Settings stubs are visible but clearly marked as beta/inactive.\n- Users can find the correct escalation path (contact admin).","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T22:19:24.01858017+01:00","updated_at":"2025-12-20T22:29:27.233954274+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.13","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:19:24.019424251+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.13","depends_on_id":"SafetySecretary-q5l.12","type":"blocks","created_at":"2025-12-20T22:23:52.655385915+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.14","title":"Attachment isolation: per-org storage roots","description":"Background:\n- Photos must not be visible across orgs.\n\nScope:\n- Per-org storage root (directory) resolved from registry.\n- Ensure all attachment upload/download paths are tenant-scoped.\n\nAcceptance:\n- Attachments are stored and served from org-specific paths.\n- No cross-org file access is possible.","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-20T22:19:34.656060626+01:00","updated_at":"2025-12-20T22:19:34.656060626+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.14","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:19:34.658287997+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.14","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:24:00.339412401+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.15","title":"Attachment encryption at rest (per-org keys)","description":"Background:\n- Org privacy expectations require encrypted attachments at rest.\n\nScope:\n- Encrypt file contents before writing to disk using per-org key.\n- Store per-org key reference in registry (encrypted by master key in env).\n- Decrypt on read/stream.\n\nConsiderations:\n- Use AES-GCM for authenticated encryption.\n- Avoid loading large files fully into memory if possible.\n\nAcceptance:\n- Attachments are encrypted at rest and decrypted for authorized access.\n- Keys are isolated per org.","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-20T22:19:46.293552292+01:00","updated_at":"2025-12-20T22:19:46.293552292+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.15","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:19:46.294306466+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.15","depends_on_id":"SafetySecretary-q5l.14","type":"blocks","created_at":"2025-12-20T22:24:09.248297329+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.15","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:24:17.495493797+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.16","title":"Session hardening: CSRF + cookie security","description":"Background:\n- Cookie sessions require CSRF protection or same-site strategy.\n\nScope:\n- Decide CSRF strategy (SameSite=Lax/Strict + token if needed).\n- Set secure cookie flags (HttpOnly, Secure in prod).\n- Configure session rotation on login.\n\nAcceptance:\n- CSRF risk mitigated for state-changing routes.\n- Cookies are configured safely for beta.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T22:20:00.342438351+01:00","updated_at":"2025-12-20T22:20:00.342438351+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.16","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:20:00.343271908+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.16","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:24:26.042127394+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.17","title":"Tests: auth flows + tenant isolation","description":"Goal:\n- Ensure login, session expiry, and tenant isolation are reliable.\n\nScope:\n- Backend tests for login success/failure, lockout, and session TTL.\n- Tenant isolation tests verifying data cannot cross org DBs.\n\nAcceptance:\n- Tests cover core auth flows and isolation boundaries.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T22:20:11.735467091+01:00","updated_at":"2025-12-20T22:20:11.735467091+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.17","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:20:11.736529856+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.17","depends_on_id":"SafetySecretary-q5l.4","type":"blocks","created_at":"2025-12-20T22:24:34.864890264+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.17","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:24:44.409398028+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.17","depends_on_id":"SafetySecretary-q5l.7","type":"blocks","created_at":"2025-12-20T22:24:53.175365122+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.18","title":"Tests: attachment encryption + storage isolation","description":"Goal:\n- Validate encryption-at-rest and per-org storage isolation.\n\nScope:\n- Upload/download tests across two orgs.\n- Verify ciphertext on disk (not plaintext).\n\nAcceptance:\n- Encrypted storage verified.\n- Cross-org file access blocked.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T22:20:22.840423462+01:00","updated_at":"2025-12-20T22:20:22.840423462+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.18","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:20:22.841096703+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.18","depends_on_id":"SafetySecretary-q5l.14","type":"blocks","created_at":"2025-12-20T22:25:01.575329077+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.18","depends_on_id":"SafetySecretary-q5l.15","type":"blocks","created_at":"2025-12-20T22:25:09.767818697+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.19","title":"Beta rollout checklist (security + provisioning)","description":"Background:\n- Beta needs consistent, repeatable onboarding for new orgs.\n\nScope:\n- Checklist: create org DB, run migrations, set encryption key, create owner/admin, validate login, verify attachment access.\n- Document admin responsibilities and escalation path.\n\nAcceptance:\n- Checklist stored in repo docs.\n- Admin can follow checklist to onboard a new org.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T22:20:33.249616648+01:00","updated_at":"2025-12-20T22:20:33.249616648+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.19","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:20:33.253485281+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.19","depends_on_id":"SafetySecretary-q5l.3","type":"blocks","created_at":"2025-12-20T22:25:20.107317636+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.19","depends_on_id":"SafetySecretary-q5l.15","type":"blocks","created_at":"2025-12-20T22:25:29.150548346+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.2","title":"Registry DB schema (orgs, users, memberships, sessions, audit)","description":"Background:\n- Org-per-DB isolation requires a control-plane registry to map org slug -\u003e tenant DB and manage users/roles.\n\nScope:\n- Organization: slug, name, status, storage root, encryption key reference.\n- User: username, email, password hash, status.\n- Membership/Role: owner/admin/member per org (supports sub-accounts).\n- Session store (server-side sessions).\n- Login audit log + failed attempt tracking for lockouts.\n- Optional placeholder for future org-level API key (encrypted), inactive in beta.\n\nConsiderations:\n- Keep registry minimal and secure; no assessment data stored here.\n- Prepare for future org-level API key storage (encrypted).\n\nAcceptance:\n- Prisma schema + migrations for registry DB.\n- Data model supports per-org routing, roles, sessions, and audit.","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-20T22:17:21.075994412+01:00","updated_at":"2025-12-20T22:29:14.842883093+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.2","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:17:21.079278426+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.2","depends_on_id":"SafetySecretary-q5l.1","type":"blocks","created_at":"2025-12-20T22:20:55.914037376+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.20","title":"Platform admin bootstrap + admin access control","description":"Background:\n- Admin UI/CLI must be protected to avoid accidental exposure of org provisioning or password resets.\n\nScope:\n- Define a platform-admin identity (global) and how it is authenticated.\n- Guard admin UI routes and admin API endpoints.\n- Ensure only platform admin can create orgs or manage users across orgs.\n\nConsiderations:\n- Access policy decided in SafetySecretary-q5l.1 (global admin vs IP allowlist).\n\nAcceptance:\n- Admin routes are inaccessible to non-platform admins.\n- Admin UI/CLI access path is clearly defined and tested.","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-20T22:27:16.354348455+01:00","updated_at":"2025-12-20T22:27:16.354348455+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.20","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:27:16.355015005+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.20","depends_on_id":"SafetySecretary-q5l.1","type":"blocks","created_at":"2025-12-20T22:27:45.406376497+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.20","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:27:53.39384461+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.21","title":"Authorization layer: role enforcement (owner/admin/member)","description":"Background:\n- Roles are required to keep admin capabilities and sensitive actions restricted.\n\nScope:\n- Middleware to enforce roles for admin routes and future settings.\n- Ensure org members can only access their org data (in addition to DB isolation).\n\nAcceptance:\n- Role checks are centralized and consistently applied.\n- Admin-only routes are inaccessible to members.","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-20T22:27:26.295240737+01:00","updated_at":"2025-12-20T22:27:26.295240737+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.21","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:27:26.29602941+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.21","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:28:01.200047594+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.21","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:28:09.255792452+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.22","title":"UX: session expiry + lockout messaging","description":"Background:\n- Users need clear feedback when sessions expire or accounts are locked.\n\nScope:\n- Login screen messages for lockout (contact admin) and remaining attempts.\n- In-app banner/redirect for session expiry with re-login prompt.\n\nAcceptance:\n- Users see clear guidance on lockout and session expiry.\n- UX avoids ambiguous failures.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T22:27:36.714110038+01:00","updated_at":"2025-12-20T22:27:36.714110038+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.22","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:27:36.71481141+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.22","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:28:44.187082594+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.22","depends_on_id":"SafetySecretary-q5l.7","type":"blocks","created_at":"2025-12-20T22:28:53.107321609+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.23","title":"UX: tenant health + friendly errors","description":"Background:\n- If a tenant DB is down or misconfigured, users need a clear, non-technical message and guidance.\n\nScope:\n- Detect tenant resolution/connection failures.\n- Show friendly error page or banner (e.g., \"Service temporarily unavailable for your organization\").\n- Provide escalation guidance (contact admin).\n\nAcceptance:\n- Tenant connection failures surface a user-friendly message.\n- No raw stack traces or DB details leak to users.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T22:35:14.333098257+01:00","updated_at":"2025-12-20T22:35:14.333098257+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.23","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:35:14.333811547+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.23","depends_on_id":"SafetySecretary-q5l.4","type":"blocks","created_at":"2025-12-20T22:35:34.408000988+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.23","depends_on_id":"SafetySecretary-q5l.12","type":"blocks","created_at":"2025-12-20T22:35:42.552689143+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.24","title":"Admin: logout everywhere (invalidate all sessions)","description":"Background:\n- Admins need the ability to quickly revoke access if a device is lost or an account is compromised.\n\nScope:\n- Admin action to invalidate all sessions for a user (and optionally an org).\n- Clear UI/CLI affordance and confirmation.\n\nAcceptance:\n- Admin can revoke all active sessions for a user.\n- Affected users must re-authenticate.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T22:35:26.07484225+01:00","updated_at":"2025-12-20T22:35:26.07484225+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.24","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:35:26.075487998+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.24","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:35:51.517572729+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.24","depends_on_id":"SafetySecretary-q5l.20","type":"blocks","created_at":"2025-12-20T22:35:59.35591142+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.3","title":"Tenant DB provisioning + migrations (org-per-DB)","description":"Background:\n- Each org needs its own Postgres database initialized with the core schema.\n\nScope:\n- Create tenant DB on demand (admin UI + CLI).\n- Run Prisma migrations for tenant DBs.\n- Store tenant DB connection info in registry.\n\nConsiderations:\n- Use a dedicated DB user per tenant if feasible.\n- Avoid leaking tenant DB credentials in logs.\n\nAcceptance:\n- Admin can provision a new org DB via UI or CLI.\n- Migrations run reliably and repeatably for tenant DBs.","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-20T22:17:32.551661235+01:00","updated_at":"2025-12-20T22:17:32.551661235+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.3","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:17:32.552370546+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.3","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:21:04.80341873+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.4","title":"Tenant-aware routing + Prisma client selection","description":"Background:\n- All case data must be scoped to the org-specific database after login.\n\nScope:\n- Middleware resolves org from session -\u003e tenant DB.\n- Attach tenant Prisma client to request context.\n- Ensure all existing routes use tenant client (no fallback to global DB).\n\nConsiderations:\n- Connection pooling strategy for multiple tenant DBs.\n- Fail closed if tenant resolution fails.\n\nAcceptance:\n- All API routes use tenant-specific Prisma client.\n- Cross-org access is impossible at the DB level.","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-20T22:17:43.256706646+01:00","updated_at":"2025-12-20T22:17:43.256706646+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.4","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:17:43.259720579+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.4","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:21:12.7045494+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.5","title":"Auth backend: login/logout + session store","description":"Background:\n- Beta requires org slug + username + password login with server-side sessions.\n\nScope:\n- Login endpoint validates org+user in registry, checks password hash.\n- Create server-side session (cookie) with remember-me TTL.\n- Logout endpoint clears session.\n\nConsiderations:\n- HttpOnly/SameSite cookie settings.\n- Different TTLs for remember-me vs standard session.\n\nAcceptance:\n- Users can log in/out reliably.\n- Session cookie persists for remember-me (10 days) and shorter for standard.","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-20T22:17:55.211122163+01:00","updated_at":"2025-12-20T22:17:55.211122163+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.5","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:17:55.212457418+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.5","depends_on_id":"SafetySecretary-q5l.1","type":"blocks","created_at":"2025-12-20T22:21:30.635968434+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.5","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:21:39.844446995+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.5","depends_on_id":"SafetySecretary-q5l.6","type":"blocks","created_at":"2025-12-20T22:21:48.62632794+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.6","title":"Auth backend: password hashing + admin-set credentials","description":"Background:\n- Beta uses admin-set static passwords; no self-service yet.\n\nScope:\n- Password hashing (Argon2 or bcrypt) + verification.\n- Admin UI/CLI for creating users and setting/resetting passwords.\n- Secure password update flow for admin only.\n\nAcceptance:\n- Passwords stored hashed + salted.\n- Admin can set/reset passwords without exposing hashes.","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-20T22:18:05.613638776+01:00","updated_at":"2025-12-20T22:18:05.613638776+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.6","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:18:05.614438618+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.6","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:21:22.02445953+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.7","title":"Auth backend: rate limiting + lockout w/ remaining attempts","description":"Background:\n- Users should be informed of remaining attempts; lockout triggers after 5 failures.\n\nScope:\n- Track failed attempts per user+org.\n- Lockout policy (duration vs admin unlock) per decision log.\n- Return remaining attempts in login errors.\n\nAcceptance:\n- Lockout triggers after 5 failures.\n- User-facing error indicates remaining attempts.\n- Lockout policy enforced consistently.","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-20T22:18:15.972411669+01:00","updated_at":"2025-12-20T22:18:15.972411669+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.7","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:18:15.973660507+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.7","depends_on_id":"SafetySecretary-q5l.1","type":"blocks","created_at":"2025-12-20T22:21:56.528942378+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.7","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:22:04.928925173+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.8","title":"Auth backend: login audit log","description":"Background:\n- Basic audit trail helps admins verify access and detect abuse.\n\nScope:\n- Record login attempts (success/failure, timestamp, user/org, IP, user agent if available).\n- Expose to admin UI (read-only) or CLI.\n\nAcceptance:\n- Audit log entries are recorded for login attempts.\n- Admin can view recent audit events.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T22:18:26.103608436+01:00","updated_at":"2025-12-20T22:18:26.103608436+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.8","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:18:26.104298229+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.8","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:22:14.674247926+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.8","depends_on_id":"SafetySecretary-q5l.5","type":"blocks","created_at":"2025-12-20T22:22:23.466704589+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-q5l.9","title":"Admin UI: org + user management","description":"Background:\n- Beta requires admin-managed orgs and users.\n\nScope:\n- Admin-only UI for creating orgs, creating users, setting/resetting passwords, assigning roles.\n- Display tenant DB status and storage root.\n- Provide unlock action for locked users if lockout policy requires admin action.\n\nAcceptance:\n- Admin can create orgs/users via UI.\n- Admin can reset passwords and manage roles.\n- Admin can unlock accounts if needed.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T22:18:36.924250325+01:00","updated_at":"2025-12-20T22:18:36.924250325+01:00","dependencies":[{"issue_id":"SafetySecretary-q5l.9","depends_on_id":"SafetySecretary-q5l","type":"parent-child","created_at":"2025-12-20T22:18:36.924960454+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.9","depends_on_id":"SafetySecretary-q5l.2","type":"blocks","created_at":"2025-12-20T22:22:32.280921294+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.9","depends_on_id":"SafetySecretary-q5l.3","type":"blocks","created_at":"2025-12-20T22:22:41.153181852+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.9","depends_on_id":"SafetySecretary-q5l.6","type":"blocks","created_at":"2025-12-20T22:22:49.372809695+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-q5l.9","depends_on_id":"SafetySecretary-q5l.20","type":"blocks","created_at":"2025-12-20T22:28:18.99099172+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-qt8","title":"Residual risk clearing + validation","description":"Background:\n- Residual risk ratings cannot be cleared once set.\n- UI shows \"Saving...\" even when no payload is sent.\n\nGoal:\n- Make clearing ratings intentional, supported, and correctly reflected in the UI.\n\nScope:\n- Baseline and residual ratings across phases and workspace.\n- Backend validation and persistence rules.\n\nAcceptance (epic-level):\n- Users can clear ratings when appropriate and see accurate status.\n- Backend supports the chosen clearing semantics.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-20T21:49:40.847733971+01:00","updated_at":"2025-12-20T21:49:40.847733971+01:00"}
{"id":"SafetySecretary-qt8.1","title":"Define clearing semantics for baseline/residual ratings","description":"Background:\n- It is unclear whether ratings should be optional or required once set.\n\nGoal:\n- Decide clearing semantics for baseline/residual ratings.\n\nDecision points:\n- Are ratings optional at all phases, or required after a certain phase?\n- What does \"cleared\" look like in UI and data model?\n\nAcceptance:\n- Decision documented and agreed.\n- Clear guidance for frontend/back-end implementation.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T21:49:51.374578391+01:00","updated_at":"2025-12-20T21:49:51.374578391+01:00","dependencies":[{"issue_id":"SafetySecretary-qt8.1","depends_on_id":"SafetySecretary-qt8","type":"parent-child","created_at":"2025-12-20T21:49:51.37537571+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-qt8.2","title":"Backend: support clearing ratings","description":"Background:\n- Current endpoints require severity+likelihood; no path to clear.\n\nGoal:\n- Implement backend support for clearing according to the defined policy.\n\nImplementation notes:\n- Option A: allow empty payload to remove assessment row.\n- Option B: add explicit clear endpoint or flag.\n\nAcceptance:\n- Clearing is supported and validated.\n- Tests cover clearing and error cases.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T21:50:01.030719405+01:00","updated_at":"2025-12-20T21:50:01.030719405+01:00","dependencies":[{"issue_id":"SafetySecretary-qt8.2","depends_on_id":"SafetySecretary-qt8","type":"parent-child","created_at":"2025-12-20T21:50:01.031451692+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-qt8.2","depends_on_id":"SafetySecretary-qt8.1","type":"blocks","created_at":"2025-12-20T21:50:31.555162366+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-qt8.3","title":"Frontend: allow clearing ratings + accurate status","description":"Background:\n- UI cannot clear selections and may show misleading save status.\n\nGoal:\n- Allow clearing selections and only show \"Saving\" when a request is sent.\n\nScope:\n- Baseline (PhaseRiskRating) and residual (PhaseControls + workspace table) flows.\n- Status messaging and error handling.\n\nAcceptance:\n- Users can clear a rating and see it persist as empty.\n- Status messages reflect actual network activity.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-20T21:50:11.888148996+01:00","updated_at":"2025-12-20T21:50:11.888148996+01:00","dependencies":[{"issue_id":"SafetySecretary-qt8.3","depends_on_id":"SafetySecretary-qt8","type":"parent-child","created_at":"2025-12-20T21:50:11.891575318+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-qt8.3","depends_on_id":"SafetySecretary-qt8.2","type":"blocks","created_at":"2025-12-20T21:50:39.738900869+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-qt8.4","title":"Tests: clearing ratings + UI feedback","description":"Goal:\n- Add regression coverage for clearing and re-setting ratings.\n\nScope:\n- Backend tests for clearing behavior.\n- Frontend tests for UI state and status messaging.\n\nAcceptance:\n- Tests pass and cover clear -\u003e set -\u003e clear sequences.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T21:50:20.996139034+01:00","updated_at":"2025-12-20T21:50:20.996139034+01:00","dependencies":[{"issue_id":"SafetySecretary-qt8.4","depends_on_id":"SafetySecretary-qt8","type":"parent-child","created_at":"2025-12-20T21:50:20.996852055+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-qt8.4","depends_on_id":"SafetySecretary-qt8.2","type":"blocks","created_at":"2025-12-20T21:50:50.176246475+01:00","created_by":"oliver"},{"issue_id":"SafetySecretary-qt8.4","depends_on_id":"SafetySecretary-qt8.3","type":"blocks","created_at":"2025-12-20T21:50:58.870289356+01:00","created_by":"oliver"}]}
{"id":"SafetySecretary-xg8","title":"UI harmonization + browser TUI experiment","description":"Unify interaction patterns across phases/views. In parallel, prototype a terminal-like spreadsheet UI in browser (feature-flagged) and converge on best UX.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-12T00:03:42.055095396+01:00","updated_at":"2025-12-18T23:03:17.30249341+01:00","closed_at":"2025-12-18T23:03:17.302494972+01:00"}
{"id":"SafetySecretary-xg8.1","title":"Audit current UI patterns","description":"Catalog how steps/hazards/actions are added/edited/reordered in each view; identify inconsistencies.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T00:04:41.189990426+01:00","updated_at":"2025-12-18T20:44:16.477102398+01:00","closed_at":"2025-12-18T20:44:16.477103863+01:00","dependencies":[{"issue_id":"SafetySecretary-xg8.1","depends_on_id":"SafetySecretary-xg8","type":"parent-child","created_at":"2025-12-12T00:04:41.190645717+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-xg8.2","title":"Design unified interaction model","description":"Define one consistent add/edit/delete/reorder pattern for all table entities. Specify keyboard-first flow + visible affordances.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T00:04:44.52270228+01:00","updated_at":"2025-12-18T20:46:27.818190801+01:00","closed_at":"2025-12-18T20:46:27.818192563+01:00","dependencies":[{"issue_id":"SafetySecretary-xg8.2","depends_on_id":"SafetySecretary-xg8","type":"parent-child","created_at":"2025-12-12T00:04:44.523384458+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-xg8.2","depends_on_id":"SafetySecretary-xg8.1","type":"blocks","created_at":"2025-12-12T00:05:35.623262081+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-xg8.3","title":"Refactor phases to shared sheet components","description":"Make Guided and Workspace views use same underlying sheet/row editors and command bar.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:04:47.594123717+01:00","updated_at":"2025-12-18T22:56:37.720927859+01:00","closed_at":"2025-12-18T22:56:37.720929345+01:00","dependencies":[{"issue_id":"SafetySecretary-xg8.3","depends_on_id":"SafetySecretary-xg8","type":"parent-child","created_at":"2025-12-12T00:04:47.594833407+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-xg8.3","depends_on_id":"SafetySecretary-xg8.2","type":"blocks","created_at":"2025-12-12T00:05:35.636220585+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-xg8.4","title":"Prototype browser TUI spreadsheet view","description":"Build an optional terminal-like, keyboard-driven table UI (feature-flagged). Compare usability with polished sheet UI.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:04:51.483927438+01:00","updated_at":"2025-12-18T23:00:53.819107792+01:00","closed_at":"2025-12-18T23:00:53.819109281+01:00","dependencies":[{"issue_id":"SafetySecretary-xg8.4","depends_on_id":"SafetySecretary-xg8","type":"parent-child","created_at":"2025-12-12T00:04:51.484686649+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-xg8.4","depends_on_id":"SafetySecretary-xg8.2","type":"blocks","created_at":"2025-12-12T00:05:35.648148411+01:00","created_by":"daemon"}]}
{"id":"SafetySecretary-xg8.5","title":"Converge on final UI and polish","description":"Pick best patterns from sheet/TUI prototypes, apply consistently, and do a style/spacing pass.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T00:04:54.616667089+01:00","updated_at":"2025-12-18T23:02:55.049845938+01:00","closed_at":"2025-12-18T23:02:55.049847402+01:00","dependencies":[{"issue_id":"SafetySecretary-xg8.5","depends_on_id":"SafetySecretary-xg8","type":"parent-child","created_at":"2025-12-12T00:04:54.617326667+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-xg8.5","depends_on_id":"SafetySecretary-xg8.3","type":"blocks","created_at":"2025-12-12T00:05:35.660825697+01:00","created_by":"daemon"},{"issue_id":"SafetySecretary-xg8.5","depends_on_id":"SafetySecretary-xg8.4","type":"blocks","created_at":"2025-12-12T00:05:35.672880127+01:00","created_by":"daemon"}]}
